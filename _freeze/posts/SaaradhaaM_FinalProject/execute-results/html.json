{
  "hash": "e1085170f97d8f846e8e0af550e1af0f",
  "result": {
    "markdown": "---\ntitle: \"Final Project [WIP] Update 3\"\nauthor: \"Saaradhaa M\"\ndescription: \"Crime, Drug Usage and Demographics\"\ndate: \"08/31/2022\"\nformat:\n  html:\n    df-print: paged\n    toc: true\n    code-copy: true\n    code-tools: true\n    css: \"styles.css\"\ncategories:\n  - final_project\n  - tidyverse\n  - ggplot2\n  - summarytools\n  - lubridate\n  - sf\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(summarytools)\nlibrary(lubridate)\nlibrary(sf)\nlibrary(chisq.posthoc.test)\nlibrary(forcats)\nlibrary(mapview)\n\nknitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)\n```\n:::\n\n\n## Introduction\n\n\\*adding a new sentence here and resubmitting this to see if it works on the blog.\n\nBrooklyn Nine-Nine, which is about a police precinct in New York City, is one of my favourite TV shows. It made me want to learn more about actual crime statistics in the city.\n\nSpecifically, this project examines how crime intersects with other social issues. The disparities in arrest rates across demographic groups have been well-documented (Jahn et al., 2022; Schleiden et al., 2020). Past research has also revealed a positive association between crime and drug usage (Pierce et al., 2017).\n\n::: callout-tip\n## Research Questions\n\n1.  What is the demographic profile of those arrested for drug-related crimes? Does it differ from that of general offenders?\n2.  Suppose you were walking through a borough in New York City, and you see syringe litter. Does this necessarily mean that the borough in question is unsafe -- or is this merely a bias that we have? *In simpler terms: where are syringes likely to be found? Is there an overlap with where crimes (especially drug-related crimes) occur?*\n:::\n\nCrime is operationalized as [arrest](https://data.cityofnewyork.us/Public-Safety/NYPD-Arrest-Data-Year-to-Date-/uip8-fykc) [data](https://data.cityofnewyork.us/Public-Safety/NYPD-Arrests-Data-Historic-/8h9b-rp9u) (New York Police Department, 2022a; New York Police Department, 2022b), and drug usage as [syringe litter data](https://data.cityofnewyork.us/Public-Safety/Summary-of-Syringe-Data-in-NYC-Parks/t8xi-d5wb) (NYC Parks, 2022a). The data spans from 2017 to 2022. Codebooks are provided [here](https://data.cityofnewyork.us/Public-Safety/NYPD-Arrest-Data-Year-to-Date-/uip8-fykc) (New York Police Department, 2022a) and [here](https://docs.google.com/spreadsheets/d/1VSUqd1peSc-4D2XnBZNiLdxa0Jg4z62D/edit#gid=150342678) (NYC Parks, 2022b).\n\n## Read In Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read in 3 main datasets.\narrest_historic <- read_csv(\"~/Desktop/umass/601final/historic.csv\", \n                   show_col_types = FALSE, \n                   col_names = c(\"del\", \"date\", \"del\", \"del\", \"del\", \"a_desc\", \"del\", \"a_offenselevel\", \"a_boro\", \"del\", \"del\", \"a_age\", \"a_sex\", \"a_race\", \"del\", \"del\", \"a_lat\", \"a_long\", \"del\"), skip=1) %>% \n  select(!starts_with(\"del\"))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError: '~/Desktop/umass/601final/historic.csv' does not exist.\n```\n:::\n\n```{.r .cell-code}\narrest_ytd <- read_csv(\"~/Desktop/umass/601final/ytd.csv\", \n                   show_col_types = FALSE, \n                   col_names = c(\"del\", \"date\", \"del\", \"del\", \"del\", \"a_desc\", \"del\", \"a_offenselevel\", \"a_boro\", \"del\", \"del\", \"a_age\", \"a_sex\", \"a_race\", \"del\", \"del\", \"a_lat\", \"a_long\", \"del\"), skip=1) %>% \n  select(!starts_with(\"del\"))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError: '~/Desktop/umass/601final/ytd.csv' does not exist.\n```\n:::\n\n```{.r .cell-code}\narrest_ytd$a_offenselevel <- na_if(arrest_ytd$a_offenselevel, \"9\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in length_x %in% c(1L, n): object 'arrest_ytd' not found\n```\n:::\n\n```{.r .cell-code}\nsyringe <- read_csv(\"~/Desktop/umass/601final/syringe.csv\", show_col_types = FALSE, col_names = c(\"del\", \"gispropnum\", \"del\", \"date\", \"del\", \"del\", \"del\", \"del\", \"del\", \"del\", \"s_location\", \"s_groundsyringes\", \"s_kiosksyringes\", \"s_totalsyringes\", \"del\", \"s_kiosktype\", \"del\", \"s_boro\", \"del\", \"del\", \"s_kioskavailable\", \"del\", \"del\"), skip=1) %>% \n  select(!starts_with(\"del\")) %>%\n  filter(s_totalsyringes > 0)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError: '~/Desktop/umass/601final/syringe.csv' does not exist.\n```\n:::\n\n```{.r .cell-code}\n# make any implicit missing values explicit.\narrest_historic <- complete(arrest_historic)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in complete(arrest_historic): object 'arrest_historic' not found\n```\n:::\n\n```{.r .cell-code}\narrest_ytd <- complete(arrest_ytd)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in complete(arrest_ytd): object 'arrest_ytd' not found\n```\n:::\n\n```{.r .cell-code}\nsyringe <- complete(syringe)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in complete(syringe): object 'syringe' not found\n```\n:::\n\n```{.r .cell-code}\n# summarise the 3 datasets.\nprint(dfSummary(arrest_historic, varnumbers = FALSE, plain.ascii = FALSE, graph.magnif = 0.30, style = \"grid\", valid.col = FALSE), \n      method = 'render', table.classes = 'table-condensed')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in dfSummary(arrest_historic, varnumbers = FALSE, plain.ascii = FALSE, : object 'arrest_historic' not found\n```\n:::\n\n```{.r .cell-code}\nprint(dfSummary(arrest_ytd, varnumbers = FALSE, plain.ascii = FALSE, graph.magnif = 0.30, style = \"grid\", valid.col = FALSE), \n      method = 'render', table.classes = 'table-condensed')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in dfSummary(arrest_ytd, varnumbers = FALSE, plain.ascii = FALSE, : object 'arrest_ytd' not found\n```\n:::\n\n```{.r .cell-code}\nprint(dfSummary(syringe, varnumbers = FALSE, plain.ascii = FALSE, graph.magnif = 0.30, style = \"grid\", valid.col = FALSE), \n      method = 'render', table.classes = 'table-condensed')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in dfSummary(syringe, varnumbers = FALSE, plain.ascii = FALSE, graph.magnif = 0.3, : object 'syringe' not found\n```\n:::\n\n```{.r .cell-code}\n#read in shapefile for syringe dataset.\npark <- st_read(\"_data/ParksProperties\", quiet = TRUE) %>% select(\"gispropnum\", \"geometry\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError: Cannot open \"_data/ParksProperties\"; The file doesn't seem to exist.\n```\n:::\n:::\n\n\nIn the code chunk above, all datasets have been loaded, unnecessary columns removed, columns renamed where needed and all missing values labelled NA. Some missing values were labelled \"9\" in **arrest_ytd** and have also been converted to NA.\n\n**arrest_historic** contains 5,308,876 rows, while **arrest_ytd** contains 93,238 rows. Each row represents a single arrest and associated information (e.g., description of crime, arrest location, demographic profile of suspect). Both have the same 9 columns and only differ in time frame - **arrest_historic** contains data from Jan 2006 to Dec 2021, while **arrest_ytd** contains data from Jan to Jun 2022.\n\nI will interpret their descriptive statistics again after combining them, but these are some initial observations:\n\n-   Dangerous drugs are in the list of top 5 offenses in both datasets, highlighting the importance of our research question.\n\n-   Arrests seem to occur the least often in Staten Island - it would be interesting to see if this is where the least number of syringes are collected as well.\n\n-   Black individuals represent \\~50% of all arrests in both datasets, despite only being \\~20% of the population in NYC (U.S. Census Bureau, 2022).\n\nMeanwhile, **syringe** contains 17,531 rows and 9 columns. Rows where **s_totalsyringes** were 0 were removed in the read-in step, as they do not contain meaningful information for analysis. The dataset ranges from Jan 2017 to Jul 2022. It contains information on syringe collection, including date, location and number of syringes. Each row does not yet represent a single date/location combination where syringes were collected, so it needs to be tidied before descriptives can be interpreted. The one thing that stands out to me is that [no syringes were collected in Brooklyn]{.underline} - hopefully the analysis later can unpack why this might be the case.\n\nI have also loaded the [**park**](https://data.cityofnewyork.us/Recreation/Parks-Properties/enfh-gkve) shapefile (Department of Parks and Recreation, 2022), which will be used derive location coordinates for **syringe**.\n\n## Tidy Data\n\n[Steps to tidy **arrest_historic** and **arrest_ytd**:]{.underline}\n\n1.  Convert *date* to \"date\" column type.\n\n2.  Create a separate column, *year*.\n\n3.  Remove rows before 2017 in **arrest_historic**.\n\n4.  Join both datasets into **arrest** dataset (93,238 + 1,043,535 = 1,136,773 rows; 9 + 1 = 10 columns).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# change 'date' to date column type.\narrest_historic <- arrest_historic %>% mutate(date = as_date(parse_date_time(date, c('mdy'))))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in mutate(., date = as_date(parse_date_time(date, c(\"mdy\")))): object 'arrest_historic' not found\n```\n:::\n\n```{.r .cell-code}\narrest_ytd <- arrest_ytd %>% mutate(date = as_date(parse_date_time(date, c('mdy'))))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in mutate(., date = as_date(parse_date_time(date, c(\"mdy\")))): object 'arrest_ytd' not found\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# create 'year'.\narrest_historic$\"year\" <- year(arrest_historic$date)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in year(arrest_historic$date): object 'arrest_historic' not found\n```\n:::\n\n```{.r .cell-code}\narrest_ytd$\"year\" <- year(arrest_ytd$date)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in year(arrest_ytd$date): object 'arrest_ytd' not found\n```\n:::\n\n```{.r .cell-code}\n# remove rows before 2017 in arrest_historic.\narrest_historic <- arrest_historic %>% filter(year > 2016)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., year > 2016): object 'arrest_historic' not found\n```\n:::\n\n```{.r .cell-code}\n# join datasets.\narrest <- rbind(arrest_historic, arrest_ytd)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in rbind(arrest_historic, arrest_ytd): object 'arrest_historic' not found\n```\n:::\n\n```{.r .cell-code}\n# spell out borough names in full.\narrest$a_boro <- recode(arrest$a_boro, B = 'Bronx', S = 'Staten Island', K = 'Brooklyn', M = 'Manhattan', Q = 'Queens')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in recode(arrest$a_boro, B = \"Bronx\", S = \"Staten Island\", K = \"Brooklyn\", : object 'arrest' not found\n```\n:::\n\n```{.r .cell-code}\n# sanity check.\nprint(dfSummary(arrest, varnumbers = FALSE, plain.ascii = FALSE, graph.magnif = 0.30, style = \"grid\", valid.col = FALSE), \n      method = 'render', table.classes = 'table-condensed')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in dfSummary(arrest, varnumbers = FALSE, plain.ascii = FALSE, graph.magnif = 0.3, : object 'arrest' not found\n```\n:::\n:::\n\n\nThe sanity check demonstrates that steps 1 to 4 are complete.\n\n[Steps to tidy **syringe**:]{.underline}\n\n1.  Convert *date* to \"date\" type.\n\n2.  Sum syringe count values in **syringe** into 1 row per date/location combination.\n\n3.  Extract latitude and longitude columns from **park** shapefile and convert them into a dataframe.\n\n4.  Combine that dataframe with **syringe**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# remove timestamp from 'date'.\nsyringe$date <- str_remove(syringe$date, \"12:00:00 AM\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in stri_replace_first_regex(string, pattern, fix_replacement(replacement), : object 'syringe' not found\n```\n:::\n\n```{.r .cell-code}\n# convert 'date' to date column type.\nsyringe <- syringe %>% mutate(date = as_date(parse_date_time(date, c('mdy'))))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in mutate(., date = as_date(parse_date_time(date, c(\"mdy\")))): object 'syringe' not found\n```\n:::\n\n```{.r .cell-code}\n# sum values into 1 row per date/location combo.\nsyringe <- syringe %>% \n  group_by(s_location, date, gispropnum, s_kiosktype, s_boro, s_kioskavailable) %>%\nsummarise(across(contains(\"syringes\"), ~sum(.x, na.rm = TRUE)))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in group_by(., s_location, date, gispropnum, s_kiosktype, s_boro, : object 'syringe' not found\n```\n:::\n\n```{.r .cell-code}\n# extract latitude and longitude from park shapefile into park_ll.\nsf_use_s2(FALSE)\npark_ll <- st_coordinates(st_centroid(park$geometry))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in st_centroid(park$geometry): object 'park' not found\n```\n:::\n\n```{.r .cell-code}\n# convert park and park_ll to dataframes.\npark_ll <- as_tibble(park_ll)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in as_tibble(park_ll): object 'park_ll' not found\n```\n:::\n\n```{.r .cell-code}\npark <- as_tibble(park)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in as_tibble(park): object 'park' not found\n```\n:::\n\n```{.r .cell-code}\n# remove multipolygon column from park.\npark <- select(park, -2)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in select(park, -2): object 'park' not found\n```\n:::\n\n```{.r .cell-code}\n# combine park and park_ll.\npark <- cbind(park, park_ll)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in cbind(park, park_ll): object 'park' not found\n```\n:::\n\n```{.r .cell-code}\n# rename long and lat columns in park.\npark <- rename(park, \"s_long\" = \"X\", \"s_lat\" = \"Y\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in rename(park, s_long = \"X\", s_lat = \"Y\"): object 'park' not found\n```\n:::\n\n```{.r .cell-code}\n# combine park and syringe.\nsyringe <- syringe %>%\n  left_join(park, by = \"gispropnum\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in left_join(., park, by = \"gispropnum\"): object 'syringe' not found\n```\n:::\n\n```{.r .cell-code}\n# sanity check.\nhead(syringe)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in head(syringe): object 'syringe' not found\n```\n:::\n:::\n\n\nThe sanity check shows that steps 1 to 3 are complete. For now, the basic tidying is complete. Further transformations may be required for each visualization as we go along.\n\n## Analysis: Question 1\n\nTo recap, this is my first research question:\n\n::: callout-tip\n## Question 1\n\nWhat is the demographic profile of those arrested for drug-related crimes? Does it differ from that of general offenders?\n:::\n\nAge, sex and race data are available in the **arrest** dataset. We can combine them together into 1 column to create demographic profiles, then make bar graphs.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# combine demographics into 1 column.\narrest <- arrest %>% unite(demo, a_race, a_sex, a_age, sep = \"_\", remove = FALSE, na.rm = TRUE)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in unite(., demo, a_race, a_sex, a_age, sep = \"_\", remove = FALSE, : object 'arrest' not found\n```\n:::\n\n```{.r .cell-code}\n# create bar graph for all arrests.\narrest %>% filter(!is.na(demo)) %>%\n  count(demo) %>%\n  slice_max(n, n = 5) %>%\n  ggplot(aes(x = reorder(demo,-n/1136773*100), y = n/1136773 * 100, fill = demo)) +\n  geom_col(stat=\"identity\") +\n  theme_minimal() + \n  labs(title = \"Top Demographic Profiles of All Offenders in NYC (Jan 2017 to Jun 2022)\", x = \"Profile\", y = \"Percent\") +\n  geom_text(aes(label=sprintf(\"%0.2f\", ..y..)), position=position_dodge(width=0.9), vjust=-0.25, size=3) +\n  theme(axis.text.x=element_text(angle=90,hjust=1))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., !is.na(demo)): object 'arrest' not found\n```\n:::\n\n```{.r .cell-code}\n# create bar graph for drug-related arrests.\narrest %>% filter(a_desc == \"DANGEROUS DRUGS\") %>% \n  filter(!is.na(demo)) %>%\n  count(demo) %>% \n  slice_max(n, n = 5) %>%\n  ggplot(aes(x = reorder(demo,-n/129285*100), y = n/129285 * 100, fill = demo)) +\n  geom_col(stat=\"identity\") +\n  theme_minimal() + \n  labs(title = \"Top Demographic Profiles of Drug Offenders in NYC (Jan 2017 to Jun 2022)\", x = \"Profile\", y = \"Percent\") +\n  geom_text(aes(label=sprintf(\"%0.2f\", ..y..)), position=position_dodge(width=0.9), vjust=-0.25, size=3) +\n  theme(axis.text.x=element_text(angle=90,hjust=1))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., a_desc == \"DANGEROUS DRUGS\"): object 'arrest' not found\n```\n:::\n:::\n\n\nIn the above graphs, each demographic profile is labelled with a different colour, so that we can see the differences in proportion clearly. In the duration of 5 years, the top 5 demographic profiles are the same for all arrests and drug-related arrests (except for a switch in order at the 3rd and 4th positions). This somewhat answers our research question:\n\n::: callout-tip\n## Question 1\n\nWhen comparing all arrests and drug-related arrests, the top five demographic profiles of offenders seem to be largely similar. They are all male. Age group varies based on ethnicity: black men aged 18 to 64 are all quite likely to be arrested, although this was greater for black men aged 25-44. For white Hispanic and white men, arrests are concentrated in the 25-44 age group.\n:::\n\nHowever, both bar graphs seem to show a stark difference between arrests of black males aged 25-44 and the other four groups. I am interested to see if this difference is significant.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create new dataset for chi-square test.\nchi_square <- arrest %>% filter(!is.na(demo)) %>% filter(demo ==  \"BLACK_M_18-24\" | demo == \"BLACK_M_25-44\" | demo == \"BLACK_M_45-64\" | demo == \"WHITE HISPANIC_M_25-44\" | demo == \"WHITE_M_25-44\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., !is.na(demo)): object 'arrest' not found\n```\n:::\n\n```{.r .cell-code}\n# run chi-square test.\nchisq.test(x = table(chi_square$demo))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in table(chi_square$demo): object 'chi_square' not found\n```\n:::\n\n```{.r .cell-code}\n# attempt post-hoc test - this is not working.\n# table_demo <- chi_square %>% count(demo)\n# chisq.posthoc.test(table_demo, method = \"bonferroni\")\n```\n:::\n\n\nThe chi-square test reveals significant differences between the top 5 demographic profiles for drug-related and non-drug-related arrests, ùúí^2^ (4) = 140432, *p* \\< .001. However, this doesn't tell us which groups had the differences. ***I downloaded a post-hoc package, but I can't get it to work.***\n\n## Additional Analysis: Question 1\n\n**Doing the above analysis also made me interested in exploring a few other questions:**\n\n-   How did the proportion of drug-related arrests change over time?\n\n-   Within drug-related arrests, how did the proportions of each demographic variable (age, sex, race) change over time?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# keep only top 3 levels of a_desc.\narrest$a_desc <- fct_lump_n(arrest$a_desc, 3, other_level=\"Other\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in check_factor(f): object 'arrest' not found\n```\n:::\n\n```{.r .cell-code}\n# change year to factor type so i can plot it.\narrest$year <- as.factor(arrest$year)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in is.factor(x): object 'arrest' not found\n```\n:::\n\n```{.r .cell-code}\n# stacked bar graph for offense type.\narrest %>% filter(!is.na(a_desc)) %>%\n  ggplot() +\n  geom_bar(mapping = aes(x = year, y=..count.., fill=a_desc), position=\"fill\") +\n  theme_minimal() + \n  labs(title = \"Proportion of Different Offences in NYC (Jan 2017 to Jun 2022)\", x = \"Year\", y = \"Percent\") +\n   scale_y_continuous(labels = scales::percent) +\n  theme(axis.text.x=element_text(angle=90,hjust=1)) \n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., !is.na(a_desc)): object 'arrest' not found\n```\n:::\n\n```{.r .cell-code}\n# stacked bar graph for age.\narrest %>% filter(a_desc == \"DANGEROUS DRUGS\") %>%\n  filter(!is.na(a_age)) %>%\n  ggplot() +\n  geom_bar(mapping = aes(x = year, fill=a_age), position=\"fill\") +\n  theme_minimal() + \n  labs(title = \"Change in Age Composition of Drug Offenders in NYC (Jan 2017 to Jun 2022)\", x = \"Year\", y = \"Percent\") +\n   scale_y_continuous(labels = scales::percent) +\n  theme(axis.text.x=element_text(angle=90,hjust=1))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., a_desc == \"DANGEROUS DRUGS\"): object 'arrest' not found\n```\n:::\n\n```{.r .cell-code}\n# stacked bar graph for race.\narrest %>% filter(a_desc == \"DANGEROUS DRUGS\") %>%\n  filter(!is.na(a_race)) %>%\n  ggplot() +\n  geom_bar(mapping = aes(x = year, fill=a_race), position=\"fill\") +\n  theme_minimal() + \n  labs(title = \"Change in Race Composition of Drug Offenders in NYC (Jan 2017 to Jun 2022)\", x = \"Year\", y = \"Percent\") +\n   scale_y_continuous(labels = scales::percent) +\n  theme(axis.text.x=element_text(angle=90,hjust=1)) \n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., a_desc == \"DANGEROUS DRUGS\"): object 'arrest' not found\n```\n:::\n\n```{.r .cell-code}\n# stacked bar graph for sex.\narrest %>% filter(a_desc == \"DANGEROUS DRUGS\") %>%\n  filter(!is.na(a_sex)) %>% ggplot() +\n  geom_bar(mapping = aes(x = year, fill=a_sex), position=\"fill\") +\n  theme_minimal() + \n  labs(title = \"Change in Sex Composition of Drug Offenders in NYC (Jan 2017 to Jun 2022)\", x = \"Year\", y = \"Percent\") +\n   scale_y_continuous(labels = scales::percent) +\n  theme(axis.text.x=element_text(angle=90,hjust=1))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., a_desc == \"DANGEROUS DRUGS\"): object 'arrest' not found\n```\n:::\n:::\n\n\nThis is what we can gather from the stacked bar graphs above. - The proportion of drug-related arrests has shrunk with time - this is a good thing! Although it is a part of the top 3 reasons for arrests, it is definitely on a downward trend. It will be useful to compare this with the change in syringes collected over time, to see if NYC's stricter policies on drug usage and offences are effective. - ***I need to add percent labels to the demographic graphs to interpret them.***\n\n## Analysis: Question 2\n\nTo recap, this is my second research question:\n\n::: callout-tip\n## Question 2\n\nSuppose you were walking through a borough in New York City, and you see syringe litter. Does this necessarily mean that the borough in question is unsafe -- or is this merely a bias that we have? *In simpler terms: where are syringes likely to be found? Is there an overlap with where crimes (especially drug-related crimes) occur?*\n:::\n\nThis question can be easily visualized via dot maps of NYC.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# creating subset of syringe for visualisation.\nsyringe_map <- syringe %>% filter(!is.na(s_long)) %>% filter(!is.na(s_lat)) %>% group_by(s_totalsyringes)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., !is.na(s_long)): object 'syringe' not found\n```\n:::\n\n```{.r .cell-code}\n# visualisation of syringe_map using mapview.\nsyringe %>% filter(!is.na(s_long)) %>% filter(!is.na(s_lat)) %>% group_by(s_totalsyringes) %>% mapview(xcol = \"s_long\", ycol = \"s_lat\", crs = 4326, grid = FALSE)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., !is.na(s_long)): object 'syringe' not found\n```\n:::\n\n```{.r .cell-code}\n# creating arrest_map.\narrest_map <- arrest %>% count(a_boro)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in count(., a_boro): object 'arrest' not found\n```\n:::\n\n```{.r .cell-code}\narrest_map$lat <-c(40.84567, 40.67908, 40.78322, 40.72955, 40.58098)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in arrest_map$lat <- c(40.84567, 40.67908, 40.78322, 40.72955, 40.58098): object 'arrest_map' not found\n```\n:::\n\n```{.r .cell-code}\narrest_map$long <- c(-73.86136, -73.94672, -73.97198, -73.79636, -74.15237)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in arrest_map$long <- c(-73.86136, -73.94672, -73.97198, -73.79636, : object 'arrest_map' not found\n```\n:::\n\n```{.r .cell-code}\n# visualisation of arrest_map using mapview.\narrest_map %>% mapview(xcol = \"long\", ycol = \"lat\", crs = 4326, grid = FALSE, cex = \"n\", legend = TRUE, layer.name = \"value\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(quote(list(...)), env): object 'arrest_map' not found\n```\n:::\n:::\n\n\nI tested the packages ggmap and mapview, and both worked great for the syringe dataset. However, the arrest dataset is simply too large for either package to load the map successfully. I decided to create a new dataframe with just the numbers of arrests in each borough and load that into mapview instead, which worked. I also like mapview better because you can zoom in and out.\n\nAdditionally, I would like to make a time series graph of how syringes collected have changed over time. ***We can remove outliers by finding the standard deviation of s_totalsyringes. We can also make another stacked bar graph to compare the number of kiosk and ground syringes collected.***\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# time graph of syringes collected.\nsyringe %>% filter(!is.na(date)) %>% filter(!is.na(s_totalsyringes)) %>% filter(s_totalsyringes < 2000) %>%\n  ggplot(aes(x=date, y=s_totalsyringes)) +\n  geom_line() + \n  geom_point() +\n  xlab(\"\") +\n  theme(axis.text.x=element_text(angle=60, hjust=1))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., !is.na(date)): object 'syringe' not found\n```\n:::\n:::\n\n\n***Just pushing this update to see if the rendering will work - I will clean up the text and code before my final submission.***\n\n***Planning to make 2 stacked bar graphs (proportion of syringes/arrests in different boroughs) to check if what I observe from the maps can be seen from those bar graphs too.***\n\n## Bibliography\n\nDepartment of Parks and Recreation. (2022). *Parks Properties*. NYC Open Data. Retrieved from https://data.cityofnewyork.us/Recreation/Parks-Properties/enfh-gkve.\n\nJahn, J., Simes, J., Cowger, T., & Davis, B. (2022). Racial Disparities in Neighborhood Arrest Rates during the COVID-19 Pandemic. *Journal Of Urban Health*, *99*(1), 67-76.\n\nNew York Police Department. (2022). *NYPD Arrest Data (Year to Date)*. NYC Open Data. Retrieved from https://data.cityofnewyork.us/Public-Safety/NYPD-Arrest-Data-Year-to-Date-/uip8-fykc.\n\nNew York Police Department. (2022). *NYPD Arrests Data (Historic)*. NYC Open Data. Retrieved from https://data.cityofnewyork.us/Public-Safety/NYPD-Arrests-Data-Historic-/8h9b-rp9u.\n\nNYC Parks. (2022). *NYC Parks Syringe Litter Data Dictionary and UserGuide*. Google Docs. Retrieved from https://docs.google.com/spreadsheets/d/1VSUqd1peSc-4D2XnBZNiLdxa0Jg4z62D/edit#gid=150342678.\n\nNYC Parks. (2022). *Summary of Syringe Data in NYC Parks*. NYC Open Data. Retrieved from https://data.cityofnewyork.us/Public-Safety/Summary-of-Syringe-Data-in-NYC-Parks/t8xi-d5wb.\n\nPierce, M., Hayhurst, K., Bird, S., Hickman, M., Seddon, T., Dunn, G., & Millar, T. (2017). Insights into the link between drug use and criminality: Lifetime offending of criminally-active opiate users. *Drug And Alcohol Dependence*, *179*, 309-316.\n\nR Core Team. (2022). *R: A language and environment for statistical computing*. R Foundation for Statistical Computing.\n\nSchleiden, C., Soloski, K., Milstead, K., & Rhynehart, A. (2020). Racial Disparities in Arrests: A Race Specific Model Explaining Arrest Rates Across Black and White Young Adults. *Child And Adolescent Social Work Journal*, *37*(1), 1-14.\n\nU.S. Census Bureau. (2022). *U.S. Census Bureau QuickFacts: New York City, New York*. Census Bureau QuickFacts. Retrieved from https://www.census.gov/quickfacts/newyorkcitynewyork.\n\nWickham, H., & Grolemund, G. (2017). *R for Data Science: Import, Tidy, Transform, Visualize, and Model Data* (1st ed.). O'Reilly Media.\n",
    "supporting": [
      "SaaradhaaM_FinalProject_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}