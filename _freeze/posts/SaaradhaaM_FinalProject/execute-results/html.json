{
  "hash": "66d68180eb235d577b83f4ac1e284e99",
  "result": {
    "markdown": "---\ntitle: \"Final Project [WIP]\"\nauthor: \"Saaradhaa M\"\ndescription: \"Crime and Drug Usage\"\ndate: \"08/28/2022\"\nformat:\n  html:\n    df-print: paged\n    toc: true\n    code-copy: true\n    code-tools: true\n    css: \"styles.css\"\ncategories:\n  - final_project\n  - tidyverse\n  - ggplot2\n  - summarytools\n  - lubridate\n  - sf\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(summarytools)\nlibrary(lubridate)\nlibrary(sf)\n\nknitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)\n```\n:::\n\n\n## Introduction\n\nBrooklyn Nine-Nine, which is about a police precinct in New York City, is one of my favourite TV shows. It made me want to learn more about actual crime statistics in the city.\n\nSpecifically, this project examines how crime intersects with other social issues. Past research has revealed an association between crime and drug usage (Pierce et al., 2017). This is crucial given the ongoing opioid crisis in the US, with a rise in fatalities due to drug overdoses in recent years (Young, 2022).\n\n::: callout-tip\n## Research Question\n\nSuppose you were walking through a borough in New York City, and you see syringe litter. Does this necessarily mean that the borough in question is unsafe -- or is this merely a bias that we have?\n\n*In simpler terms, where are syringes likely to be found? Is there an overlap with where crimes (especially drug-related crimes) occur?*\n:::\n\nCrime is operationalized as [arrest](https://data.cityofnewyork.us/Public-Safety/NYPD-Arrest-Data-Year-to-Date-/uip8-fykc) [data](https://data.cityofnewyork.us/Public-Safety/NYPD-Arrests-Data-Historic-/8h9b-rp9u) (New York Police Department, 2022a; New York Police Department, 2022b), and drug usage as [syringe litter data](https://data.cityofnewyork.us/Public-Safety/Summary-of-Syringe-Data-in-NYC-Parks/t8xi-d5wb) (NYC Parks, 2022a). The data spans from 2017 to 2022. Codebooks are provided [here](https://data.cityofnewyork.us/Public-Safety/NYPD-Arrest-Data-Year-to-Date-/uip8-fykc) (New York Police Department, 2022a) and [here](https://docs.google.com/spreadsheets/d/1VSUqd1peSc-4D2XnBZNiLdxa0Jg4z62D/edit#gid=150342678) (NYC Parks, 2022b).\n\nIf time permits, I will attempt an additional question: What is the demographic profile of those arrested for drug-related crimes? Does it differ from that of general arrestees?\n\n## Read In Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read in 3 main datasets.\narrest_historic <- read_csv(\"~/Desktop/umass/2022_01_Summer/1. DACSS 601/Final Project/NYPD_Arrests_Data_Historic.csv\", \n                   show_col_types = FALSE, \n                   col_names = c(\"del\", \"date\", \"del\", \"del\", \"del\", \"a_desc\", \"del\", \"a_offenselevel\", \"a_boro\", \"del\", \"a_juriscode\", \"a_age\", \"a_sex\", \"a_race\", \"del\", \"del\", \"a_lat\", \"a_long\", \"del\"), skip=1) %>% \n  select(!starts_with(\"del\"))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError: '~/Desktop/umass/2022_01_Summer/1. DACSS 601/Final Project/NYPD_Arrests_Data_Historic.csv' does not exist.\n```\n:::\n\n```{.r .cell-code}\narrest_ytd <- read_csv(\"~/Desktop/umass/2022_01_Summer/1. DACSS 601/Final Project/NYPD_Arrest_Data_Year_to_Date.csv\", \n                   show_col_types = FALSE, \n                   col_names = c(\"del\", \"date\", \"del\", \"del\", \"del\", \"a_desc\", \"del\", \"a_offenselevel\", \"a_boro\", \"del\", \"a_juriscode\", \"a_age\", \"a_sex\", \"a_race\", \"del\", \"del\", \"a_lat\", \"a_long\", \"del\"), skip=1) %>% \n  select(!starts_with(\"del\"))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError: '~/Desktop/umass/2022_01_Summer/1. DACSS 601/Final Project/NYPD_Arrest_Data_Year_to_Date.csv' does not exist.\n```\n:::\n\n```{.r .cell-code}\nsyringe <- read_csv(\"~/Desktop/umass/2022_01_Summer/1. DACSS 601/Final Project/Summary_of_Syringe_Data_in_NYC_Parks.csv\", show_col_types = FALSE, col_names = c(\"del\", \"gispropnum\", \"del\", \"date\", \"del\", \"del\", \"del\", \"del\", \"del\", \"del\", \"s_location\", \"s_groundsyringes\", \"s_kiosksyringes\", \"s_totalsyringes\", \"del\", \"s_kiosktype\", \"del\", \"s_boro\", \"del\", \"s_propertytype\", \"s_kioskavailable\", \"del\", \"del\"), skip=1) %>%\n  select(!starts_with(\"del\"))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError: '~/Desktop/umass/2022_01_Summer/1. DACSS 601/Final Project/Summary_of_Syringe_Data_in_NYC_Parks.csv' does not exist.\n```\n:::\n\n```{.r .cell-code}\n# make any implicit missing values explicit.\narrest_historic <- complete(arrest_historic)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in complete(arrest_historic): object 'arrest_historic' not found\n```\n:::\n\n```{.r .cell-code}\narrest_ytd <- complete(arrest_ytd)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in complete(arrest_ytd): object 'arrest_ytd' not found\n```\n:::\n\n```{.r .cell-code}\nsyringe <- complete(syringe)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in complete(syringe): object 'syringe' not found\n```\n:::\n\n```{.r .cell-code}\n# summarise the 3 datasets.\ndim(arrest_historic)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): object 'arrest_historic' not found\n```\n:::\n\n```{.r .cell-code}\ndim(arrest_ytd)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): object 'arrest_ytd' not found\n```\n:::\n\n```{.r .cell-code}\nprint(dfSummary(syringe, varnumbers = FALSE, plain.ascii = FALSE, graph.magnif = 0.30, style = \"grid\", valid.col = FALSE), \n      method = 'render', table.classes = 'table-condensed')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in dfSummary(syringe, varnumbers = FALSE, plain.ascii = FALSE, graph.magnif = 0.3, : object 'syringe' not found\n```\n:::\n\n```{.r .cell-code}\n#read in shapefile for syringe dataset.\npark <- st_read(\"~/Desktop/umass/2022_01_Summer/1. DACSS 601/Final Project/Parks_Properties\", quiet = TRUE) %>% select(\"gispropnum\", \"geometry\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError: Cannot open \"~/Desktop/umass/2022_01_Summer/1. DACSS 601/Final Project/Parks_Properties\"; The file doesn't seem to exist.\n```\n:::\n:::\n\n\nIn the code chunk above, all datasets have been loaded, unnecessary columns removed, columns renamed where needed and all missing values labelled \"NA\".\n\n**arrest_historic** contains 5,308,876 rows, while **arrest_ytd** contains 93,238 rows. Each row represents a single arrest and associated information (e.g., description of crime, arrest location, demographic profile of suspect). Both have the same 10 columns and only differ in time frame: **arrest_historic** contains data from Jan 2006 to Dec 2021, while **arrest_ytd** contains data from Jan to Jun 2022. I will interpret their descriptive statistics after combining them.\n\nMeanwhile, **syringe** contains 19,778 rows and 10 columns. Each row represents a date when syringes were collected and information on where they were found. It ranges from Jan 2017 to Jul 2022. I have also loaded the [**park**](https://data.cityofnewyork.us/Recreation/Parks-Properties/enfh-gkve) shapefile (Department of Parks and Recreation, 2022), which will be used derive location coordinates for **syringe**.\n\n*I haven't written the descriptive statistics for the syringe dataset yet because i realise that i need to sum up the values for each date - there are some dates/locations that are the same but have been split up. would this best be done in the read-in step?*\n\n## Tidy Data\n\n[Steps to tidy **arrest_historic** and **arrest_ytd**:]{.underline}\n\n1.  Convert *date* to \"date\" column type.\n\n2.  Create a separate column, *year*.\n\n3.  Remove rows before 2017 in **arrest_historic**.\n\n4.  Join both datasets into **arrest** dataset (93,238 + 1,043,535 = 1,136,773 rows; 10 + 1 = 11 columns).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# change 'date' to date column type.\narrest_historic <- arrest_historic %>% mutate(date = as_date(parse_date_time(date, c('mdy'))))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in mutate(., date = as_date(parse_date_time(date, c(\"mdy\")))): object 'arrest_historic' not found\n```\n:::\n\n```{.r .cell-code}\narrest_ytd <- arrest_ytd %>% mutate(date = as_date(parse_date_time(date, c('mdy'))))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in mutate(., date = as_date(parse_date_time(date, c(\"mdy\")))): object 'arrest_ytd' not found\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# create 'year'.\narrest_historic$\"year\" <- year(arrest_historic$date)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in year(arrest_historic$date): object 'arrest_historic' not found\n```\n:::\n\n```{.r .cell-code}\narrest_ytd$\"year\" <- year(arrest_ytd$date)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in year(arrest_ytd$date): object 'arrest_ytd' not found\n```\n:::\n\n```{.r .cell-code}\n# remove rows before 2017 in arrest_historic.\narrest_historic <- arrest_historic %>% filter(year > 2016)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., year > 2016): object 'arrest_historic' not found\n```\n:::\n\n```{.r .cell-code}\n# join datasets.\narrest <- rbind(arrest_historic, arrest_ytd)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in rbind(arrest_historic, arrest_ytd): object 'arrest_historic' not found\n```\n:::\n\n```{.r .cell-code}\n# spell out borough names in full.\narrest$a_boro <- recode(arrest$a_boro, B = 'Bronx', S = 'Staten Island', K = 'Brooklyn', M = 'Manhattan', Q = 'Queens')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in recode(arrest$a_boro, B = \"Bronx\", S = \"Staten Island\", K = \"Brooklyn\", : object 'arrest' not found\n```\n:::\n\n```{.r .cell-code}\n# sanity check.\nprint(dfSummary(arrest, varnumbers = FALSE, plain.ascii = FALSE, graph.magnif = 0.30, style = \"grid\", valid.col = FALSE), \n      method = 'render', table.classes = 'table-condensed')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in dfSummary(arrest, varnumbers = FALSE, plain.ascii = FALSE, graph.magnif = 0.3, : object 'arrest' not found\n```\n:::\n:::\n\n\nThe sanity check demonstrates that steps 1 to 4 are complete.\n\n[Steps to tidy **syringe**:]{.underline}\n\n1.  Convert *date* to \"date\" type.\n\n2.  Extract latitude and longitude columns from **park** shapefile and convert them into a dataframe.\n\n3.  Combine that dataframe with **syringe**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# remove timestamp from 'date'.\nsyringe$date <- str_remove(syringe$date, \"12:00:00 AM\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in stri_replace_first_regex(string, pattern, fix_replacement(replacement), : object 'syringe' not found\n```\n:::\n\n```{.r .cell-code}\n# convert 'date' to date column type.\nsyringe <- syringe %>% mutate(date = as_date(parse_date_time(date, c('mdy'))))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in mutate(., date = as_date(parse_date_time(date, c(\"mdy\")))): object 'syringe' not found\n```\n:::\n\n```{.r .cell-code}\n# extract latitude and longitude from park shapefile into park_ll.\nsf_use_s2(FALSE)\npark_ll <- st_coordinates(st_centroid(park$geometry))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in st_centroid(park$geometry): object 'park' not found\n```\n:::\n\n```{.r .cell-code}\n# convert park and park_ll to dataframes.\npark_ll <- as_tibble(park_ll)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in as_tibble(park_ll): object 'park_ll' not found\n```\n:::\n\n```{.r .cell-code}\npark <- as_tibble(park)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in as_tibble(park): object 'park' not found\n```\n:::\n\n```{.r .cell-code}\n# remove multipolygon column from park.\npark <- select(park, -2)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in select(park, -2): object 'park' not found\n```\n:::\n\n```{.r .cell-code}\n# combine park and park_ll.\npark <- cbind(park, park_ll)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in cbind(park, park_ll): object 'park' not found\n```\n:::\n\n```{.r .cell-code}\n# rename long and lat columns in park.\npark <- rename(park, \"s_long\" = \"X\", \"s_lat\" = \"Y\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in rename(park, s_long = \"X\", s_lat = \"Y\"): object 'park' not found\n```\n:::\n\n```{.r .cell-code}\n# combine park and syringe.\nsyringe <- syringe %>%\n  left_join(park, by = \"gispropnum\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in left_join(., park, by = \"gispropnum\"): object 'syringe' not found\n```\n:::\n\n```{.r .cell-code}\n# sanity check.\nhead(syringe)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in head(syringe): object 'syringe' not found\n```\n:::\n:::\n\n\nThe sanity check shows that steps 1 to 3 are complete. I will now combine **syringe** with **arrest** by doing a full_join using the *date* column.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# perform join.\nmega <- full_join(syringe, arrest, by = \"date\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in full_join(syringe, arrest, by = \"date\"): object 'syringe' not found\n```\n:::\n\n```{.r .cell-code}\n# sanity check.\ndim(mega)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): object 'mega' not found\n```\n:::\n:::\n\n\nAs expected, there are 22 columns (11 + 12 - 1 = 22).\n\n## Analysis\n\n*TBD. Planning to make stacked bar graphs (proportion of syringes/arrests in different boroughs) and heatmap.*\n\n## Bibliography\n\nDepartment of Parks and Recreation. (2022). *Parks Properties*. NYC Open Data. Retrieved from https://data.cityofnewyork.us/Recreation/Parks-Properties/enfh-gkve.\n\nNew York Police Department. (2022). *NYPD Arrest Data (Year to Date)*. NYC Open Data. Retrieved from https://data.cityofnewyork.us/Public-Safety/NYPD-Arrest-Data-Year-to-Date-/uip8-fykc.\n\nNew York Police Department. (2022). *NYPD Arrests Data (Historic)*. NYC Open Data. Retrieved from https://data.cityofnewyork.us/Public-Safety/NYPD-Arrests-Data-Historic-/8h9b-rp9u.\n\nNYC Parks. (2022). *NYC Parks Syringe Litter Data Dictionary and UserGuide*. Google Docs. Retrieved from https://docs.google.com/spreadsheets/d/1VSUqd1peSc-4D2XnBZNiLdxa0Jg4z62D/edit#gid=150342678.\n\nNYC Parks. (2022). *Summary of Syringe Data in NYC Parks*. NYC Open Data. Retrieved from https://data.cityofnewyork.us/Public-Safety/Summary-of-Syringe-Data-in-NYC-Parks/t8xi-d5wb.\n\nPierce, M., Hayhurst, K., Bird, S., Hickman, M., Seddon, T., Dunn, G., & Millar, T. (2017). Insights into the link between drug use and criminality: Lifetime offending of criminally-active opiate users. *Drug And Alcohol Dependence*, *179*, 309-316.\n\nR Core Team. (2022). *R: A language and environment for statistical computing*. R Foundation for Statistical Computing.\n\nWickham, H., & Grolemund, G. (2017). *R for Data Science: Import, Tidy, Transform, Visualize, and Model Data* (1st ed.). O'Reilly Media.\n\nYoung, S. (2022). *New York experiment with government-approved drug use could become a national model*. POLITICO. Retrieved from https://www.politico.com/news/2022/05/14/new-york-experiment-drug-use-national-model-00031876.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}