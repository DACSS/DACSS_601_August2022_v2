{
  "hash": "d47cb5c1d52c7c2306b791d9598f3144",
  "result": {
    "markdown": "---\ntitle: \"FinalProject\"\nauthor: \"Emma Rasmussen\"\ndescription: \"FinalProjectDRAFT1\"\ndate: \"08/26/2022\"\nformat:\n  html:\n    toc: true\n    code-copy: true\n    code-tools: true\ncategories:\n  - final project\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(googlesheets4)\nlibrary(lubridate)\nlibrary(stringr)\nlibrary(scales)\nlibrary(dplyr)\n\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\nReading In the Data\n\n::: {.cell}\n\n```{.r .cell-code}\ngs4_deauth()\n\n#creating a vector of new column names\nmass_names<- c(\"incident_id\", \"incident_date\", \"state\", \"city_or_county\", \"address\", \"number_killed\", \"number_injured\", \"delete\")\n\n#creating a function to read in the data sets with new column names, skip the first row, and remove the \"operation\" column which contains links to news articles in original data source, and creating a \"Year\" column for ease of analysis\nread_shootings<-function(sheet_name){read_sheet(\"https://docs.google.com/spreadsheets/d/1rCnIYPQSkcZDCulp5KXAxmZUBad4QtrERi4_7tUMXqs/edit?usp=sharing\", \n                                                sheet=sheet_name,\n                                                col_names=mass_names, \n                                                skip=1) %>%\n    mutate(\"YearSheet\"=sheet_name) %>% \n    mutate(Year=recode(YearSheet, \"MassShootings2014\"=\"2014\", \"MassShootings2015\"=\"2015\", \"MassShootings2016\"=\"2016\", \"MassShootings2017\"=\"2017\", \"MassShootings2018\"=\"2018\", \"MassShootings2019\"=\"2019\", \"MassShootings2020\"=\"2020\", \"MassShootings2021\"=\"2021\", \"MassShootings2022\"=\"2022\")) %>% \n  select(-delete, -YearSheet)\n           }\n\n#using purrr/map_dfr to join data sheets for 2014 through 2021, applying the function read_shootings for consistent formatting\nmass_shootings_all <- map_dfr(\n  sheet_names(\"https://docs.google.com/spreadsheets/d/1rCnIYPQSkcZDCulp5KXAxmZUBad4QtrERi4_7tUMXqs/edit?usp=sharing\")[1:9],\n  read_shootings)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#converting incident_date from \"POSIXct\" to \"date\" format\nmass_shootings_all\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3,835 × 8\n   incident_id incident_date       state   city_…¹ address numbe…² numbe…³ Year \n         <dbl> <dttm>              <chr>   <chr>   <chr>     <dbl>   <dbl> <chr>\n 1      271363 2014-12-29 00:00:00 Louisi… New Or… Poydra…       0       4 2014 \n 2      269679 2014-12-27 00:00:00 Califo… Los An… 8800 b…       1       3 2014 \n 3      270036 2014-12-27 00:00:00 Califo… Sacram… 4000 b…       0       4 2014 \n 4      269167 2014-12-26 00:00:00 Illino… East S… 2500 b…       1       3 2014 \n 5      268598 2014-12-24 00:00:00 Missou… Saint … 18th a…       1       3 2014 \n 6      267792 2014-12-23 00:00:00 Kentuc… Winche… 260 Ox…       1       3 2014 \n 7      268282 2014-12-22 00:00:00 Michig… Detroit Charle…       1       3 2014 \n 8      282186 2014-12-22 00:00:00 New Yo… Webster 191 La…       4       2 2014 \n 9      267721 2014-12-22 00:00:00 Illino… Chicago 5700 b…       0       5 2014 \n10      266570 2014-12-21 00:00:00 Florida Saraso… 4034 N…       2       2 2014 \n# … with 3,825 more rows, and abbreviated variable names ¹​city_or_county,\n#   ²​number_killed, ³​number_injured\n# ℹ Use `print(n = ...)` to see more rows\n```\n:::\n\n```{.r .cell-code}\nmass_shootings_all$incident_date<-as.Date(mass_shootings_all$incident_date)\n\n#creating a month column and converting to factors\nmass_shootings_all<-mass_shootings_all%>% \n  mutate(month=as.factor(month(incident_date))) %>% \n    mutate(month=recode(month, `1`=\"Jan\", `2`=\"Feb\", `3`=\"Mar\", `4`=\"Apr\", `5`=\"May\", `6`=\"Jun\", `7`=\"Jul\", `8`=\"Aug\", `9`=\"Sept\", `10`=\"Oct\", `11`=\"Nov\", `12`=\"Dec\"))\n\n#sanity check\nmass_shootings_all\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3,835 × 9\n   incident_id incident_date state   city_…¹ address numbe…² numbe…³ Year  month\n         <dbl> <date>        <chr>   <chr>   <chr>     <dbl>   <dbl> <chr> <fct>\n 1      271363 2014-12-29    Louisi… New Or… Poydra…       0       4 2014  Dec  \n 2      269679 2014-12-27    Califo… Los An… 8800 b…       1       3 2014  Dec  \n 3      270036 2014-12-27    Califo… Sacram… 4000 b…       0       4 2014  Dec  \n 4      269167 2014-12-26    Illino… East S… 2500 b…       1       3 2014  Dec  \n 5      268598 2014-12-24    Missou… Saint … 18th a…       1       3 2014  Dec  \n 6      267792 2014-12-23    Kentuc… Winche… 260 Ox…       1       3 2014  Dec  \n 7      268282 2014-12-22    Michig… Detroit Charle…       1       3 2014  Dec  \n 8      282186 2014-12-22    New Yo… Webster 191 La…       4       2 2014  Dec  \n 9      267721 2014-12-22    Illino… Chicago 5700 b…       0       5 2014  Dec  \n10      266570 2014-12-21    Florida Saraso… 4034 N…       2       2 2014  Dec  \n# … with 3,825 more rows, and abbreviated variable names ¹​city_or_county,\n#   ²​number_killed, ³​number_injured\n# ℹ Use `print(n = ...)` to see more rows\n```\n:::\n:::\n\n\nThe number of rows in the df is equal to the sum of the rows from the original google sheets data (-9 for column names in google sheets)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Can now use \"year\" column to easily analyze data by year\nfilter(mass_shootings_all, Year==\"2014\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 272 × 9\n   incident_id incident_date state   city_…¹ address numbe…² numbe…³ Year  month\n         <dbl> <date>        <chr>   <chr>   <chr>     <dbl>   <dbl> <chr> <fct>\n 1      271363 2014-12-29    Louisi… New Or… Poydra…       0       4 2014  Dec  \n 2      269679 2014-12-27    Califo… Los An… 8800 b…       1       3 2014  Dec  \n 3      270036 2014-12-27    Califo… Sacram… 4000 b…       0       4 2014  Dec  \n 4      269167 2014-12-26    Illino… East S… 2500 b…       1       3 2014  Dec  \n 5      268598 2014-12-24    Missou… Saint … 18th a…       1       3 2014  Dec  \n 6      267792 2014-12-23    Kentuc… Winche… 260 Ox…       1       3 2014  Dec  \n 7      268282 2014-12-22    Michig… Detroit Charle…       1       3 2014  Dec  \n 8      282186 2014-12-22    New Yo… Webster 191 La…       4       2 2014  Dec  \n 9      267721 2014-12-22    Illino… Chicago 5700 b…       0       5 2014  Dec  \n10      266570 2014-12-21    Florida Saraso… 4034 N…       2       2 2014  Dec  \n# … with 262 more rows, and abbreviated variable names ¹​city_or_county,\n#   ²​number_killed, ³​number_injured\n# ℹ Use `print(n = ...)` to see more rows\n```\n:::\n\n```{.r .cell-code}\n#creating plot of shootings/year\nggplot(mass_shootings_all, aes(Year))+\n  geom_bar(stat=\"Count\")+\n  labs(title=\"Mass Shootings 2014-2022*\", caption=\"*2022 data goes up to August 27, 2022\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#creating plot by month\nggplot(mass_shootings_all, aes(x=month))+\n  geom_point(stat=\"count\")+geom_line(stat=\"count\", group=1)+\n  labs(title=\"Mass Shootings 2014-2022 By Month\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\n#creating line plot by year and month\nggplot(mass_shootings_all, aes(x=month, group=Year, color=Year))+\n  geom_line(stat=\"count\")+\n  geom_point(stat=\"count\")+\n  labs(title=\"Mass Shootings by Month 2014-2022*\", caption=\"*2022 data is only up until August 27, 2022\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-4-3.png){width=672}\n:::\n:::\n\nGraph appears to jump to new heights/monthly max in May 2020. The two lines that generally trend above it are 2021 and 2022.\n\nIn addition to mass shootings increasing over time, it appears that shootings could be correlated with temperature/season given the data set when filtered by month is highest in summer months an lowest in winter months.\n\nI am curious if a less seasonally varying state would have the same distribution. Below I create the same plot for FL and MA\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Distribution of shootings by month in FL\nfilter(mass_shootings_all, state==\"Florida\") %>% \n    ggplot(aes(month))+geom_point(stat=\"Count\")+geom_line(stat=\"count\", group=1) +labs(title=\"Mass Shootings 2014-2022 By Month in Florida\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#Distribution of shootings by month in mA\nfilter(mass_shootings_all, state==\"Massachusetts\") %>% \n    ggplot(aes(month))+geom_point(stat=\"Count\")+geom_line(stat=\"count\", group=1)+labs(title=\"Mass Shootings 2014-2022 By Month in Massachusetts\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n\n```{.r .cell-code}\n#Mass has some months where count=0, which is omitted from the histogram when filtering out mass. Below I created a table and then created a bar graph from this to preserve the months where count=0\nmass_shootings_all_mass<-filter(mass_shootings_all, state==\"Massachusetts\") %>% \n    group_by(month, .drop=FALSE) %>%\n    summarise(Count = n())\nmass_shootings_all_mass\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 12 × 2\n   month Count\n   <fct> <int>\n 1 Jan       2\n 2 Feb       0\n 3 Mar       1\n 4 Apr       2\n 5 May       4\n 6 Jun       5\n 7 Jul       8\n 8 Aug       6\n 9 Sept      0\n10 Oct       3\n11 Nov       0\n12 Dec       2\n```\n:::\n\n```{.r .cell-code}\nggplot(mass_shootings_all_mass, aes(x=month, y=Count))+geom_point(stat=\"identity\")+geom_line(stat=\"identity\", group=1)\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-5-3.png){width=672}\n:::\n\n```{.r .cell-code}\n#creating month distribution by state. This table DOES preserve the months where the count=0, I think histogram makes more sense here?\nggplot(mass_shootings_all, aes(month))+geom_histogram(stat=\"count\")+ facet_wrap(~state, scales = \"free_y\")+theme(strip.text = element_text(size=6))+labs(title=\"Mass Shootings 2014-2022 by Month Across U.S. States\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-5-4.png){width=672}\n:::\n\n```{.r .cell-code}\n#creating month distribution by state. This table DOES NOT preserve the months where the count=0 but easier to visualize patterns than with histogram\nggplot(mass_shootings_all, aes(month))+geom_line(stat=\"count\", group=1)+ facet_wrap(~state, scales = \"free_y\")+theme(strip.text = element_text(size=6))+labs(title=\"Mass Shootings 2014-2022 by Month Across U.S. States\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-5-5.png){width=672}\n:::\n:::\n\n\nGoing forward, I think I will try to create these plots for different states to see if this trend holds true across different states. I am also curious if i can find a dataset with typical temp ranges/state and seeing if there is correlation between temp variation and mass shootings.Am also curious to figure out what kind of distribution best describes the graph with all states.\n\nWhats going on??? rant: There are a number of confounding factors that could explain the apparent correlation with season/temp- people more/less likely to leave the house based on weather, more public gatherings during seasons with higher temps... also wondering if covid affects this. I could create the same graph by state and year (but there probaly isnt enough events to see a correlation, but maybe for a state with a high population?) And wondering if the average number killed also increases with higher temperatures as there may be more opportunities/gatherings of people\n\nBelow, looking into how many people on average are shot during incidents\n\n::: {.cell}\n\n```{.r .cell-code}\n#Looking at distinct values for number killed\ndistinct(mass_shootings_all, number_killed) %>% \n  arrange(number_killed)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 20 × 1\n   number_killed\n           <dbl>\n 1             0\n 2             1\n 3             2\n 4             3\n 5             4\n 6             5\n 7             6\n 8             7\n 9             8\n10             9\n11            10\n12            11\n13            13\n14            16\n15            17\n16            22\n17            23\n18            27\n19            50\n20            59\n```\n:::\n\n```{.r .cell-code}\n#Looking at distinct values for number injured\ndistinct(mass_shootings_all, number_injured) %>% \n  arrange(number_injured)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 28 × 1\n   number_injured\n            <dbl>\n 1              0\n 2              1\n 3              2\n 4              3\n 5              4\n 6              5\n 7              6\n 8              7\n 9              8\n10              9\n# … with 18 more rows\n# ℹ Use `print(n = ...)` to see more rows\n```\n:::\n\n```{.r .cell-code}\n#creating a new column/variable to measure severity based on above variables, number shot= number killed+number injured\nmass_shootings_all<-mass_shootings_all %>% \n  mutate(number_shot= number_injured+number_killed)\n\n#Looking at distinct values for new variable\ndistinct(mass_shootings_all, number_shot) %>% \n  arrange(number_shot)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 31 × 1\n   number_shot\n         <dbl>\n 1           4\n 2           5\n 3           6\n 4           7\n 5           8\n 6           9\n 7          10\n 8          11\n 9          12\n10          13\n# … with 21 more rows\n# ℹ Use `print(n = ...)` to see more rows\n```\n:::\n\n```{.r .cell-code}\n#Graphing distribution of number shot (killed or injured) in mass shootings\n#filtering out where number shot>30\nmass_shootings_all %>% \n  filter(number_shot<30) %>% \n  ggplot(aes(number_shot))+geom_histogram(binwidth = 1)\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#creating a new variable, severity, by categorizing the number shot into low, mid, high\nmass_shootings_all<-mass_shootings_all %>% \n  mutate(severity= case_when(number_shot <= 9 ~ \"low\", number_shot >= 10 & number_shot <= 29 ~ \"mid\",\n    number_shot >= 30 ~ \"high\"))\nmass_shootings_all\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3,835 × 11\n   incide…¹ incident…² state city_…³ address numbe…⁴ numbe…⁵ Year  month numbe…⁶\n      <dbl> <date>     <chr> <chr>   <chr>     <dbl>   <dbl> <chr> <fct>   <dbl>\n 1   271363 2014-12-29 Loui… New Or… Poydra…       0       4 2014  Dec         4\n 2   269679 2014-12-27 Cali… Los An… 8800 b…       1       3 2014  Dec         4\n 3   270036 2014-12-27 Cali… Sacram… 4000 b…       0       4 2014  Dec         4\n 4   269167 2014-12-26 Illi… East S… 2500 b…       1       3 2014  Dec         4\n 5   268598 2014-12-24 Miss… Saint … 18th a…       1       3 2014  Dec         4\n 6   267792 2014-12-23 Kent… Winche… 260 Ox…       1       3 2014  Dec         4\n 7   268282 2014-12-22 Mich… Detroit Charle…       1       3 2014  Dec         4\n 8   282186 2014-12-22 New … Webster 191 La…       4       2 2014  Dec         6\n 9   267721 2014-12-22 Illi… Chicago 5700 b…       0       5 2014  Dec         5\n10   266570 2014-12-21 Flor… Saraso… 4034 N…       2       2 2014  Dec         4\n# … with 3,825 more rows, 1 more variable: severity <chr>, and abbreviated\n#   variable names ¹​incident_id, ²​incident_date, ³​city_or_county,\n#   ⁴​number_killed, ⁵​number_injured, ⁶​number_shot\n# ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names\n```\n:::\n\n```{.r .cell-code}\n#2D histogram, depicting incidents by year based on number killed, and a count for how many incidents in a particular year\nmass_shootings_all %>% \n  filter(number_shot<100) %>% \n  ggplot(aes(Year, number_shot))+geom_bin2d()+labs(title=\"Mass Shootings by Number of People Killed or Injured (2014-2022)*\", caption=\"*Shootings with over 100 killed/injured are exluded for readability\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n\n```{.r .cell-code}\n#boxplot with number_shot by year\nmass_shootings_all %>% \n  filter(number_shot<100) %>% \n  ggplot(aes(Year, number_shot))+geom_boxplot()+labs(title=\"Mass Shootings by Number of People Killed or Injured (2014-2022)\", caption=\"*Shootings with over 100 killed/injured are exluded for readability\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-6-3.png){width=672}\n:::\n\n```{.r .cell-code}\n#violin plot with number_shot by year\nmass_shootings_all %>% \n  filter(number_shot<100) %>% \n  ggplot(aes(Year, number_shot))+geom_violin()+labs(title=\"Mass Shootings by Number of People Killed or Injured (2014-2022)\", caption=\"*Shootings with over 100 killed/injured are exluded for readability\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-6-4.png){width=672}\n:::\n\n```{.r .cell-code}\n#scatterplot\nfilter(mass_shootings_all, number_shot<100) %>% \n  ggplot(aes(x=incident_date, y=number_shot))+geom_point()+labs(title=\"Shootings 2014-2022\", caption=\"*Shootings with over 100 killed/injured are exluded for readability\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-6-5.png){width=672}\n:::\n\n```{.r .cell-code}\n#stacked bar chart with severity by year\nggplot(mass_shootings_all, aes(Year, fill=severity))+geom_bar(stat=\"count\")+labs(title=\"Severity of Shootings by Year\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-6-6.png){width=672}\n:::\n\n```{.r .cell-code}\n#high severity shootings by year\nfilter(mass_shootings_all, severity==\"high\") %>% \n  ggplot(aes(Year))+geom_histogram(stat=\"count\")+labs(title=\"High Severity Shootings by Year\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-6-7.png){width=672}\n:::\n\n```{.r .cell-code}\n#mid severity shootings by year\nfilter(mass_shootings_all, severity==\"mid\") %>% \n  ggplot(aes(Year))+geom_histogram(stat=\"count\")+labs(title=\"Mid Severity Shootings by Year\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-6-8.png){width=672}\n:::\n\n```{.r .cell-code}\n#mid severity shootings by month\nfilter(mass_shootings_all, severity==\"mid\") %>% \n  ggplot(aes(month))+geom_histogram(stat=\"count\")+labs(title=\"Mid Severity Shootings by Month\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-6-9.png){width=672}\n:::\n\n```{.r .cell-code}\n#mid severity shootings by month line plot\nfilter(mass_shootings_all, severity==\"mid\") %>% \n  ggplot(aes(month))+geom_line(stat=\"count\", group=1)+geom_point(stat=\"count\")+labs(title=\"Mid Severity Shootings by Month\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-6-10.png){width=672}\n:::\n\n```{.r .cell-code}\n#high severity shootings by month\nfilter(mass_shootings_all, severity==\"high\") %>% \n  ggplot(aes(month))+geom_histogram(stat=\"count\")+labs(title=\"High Severity Shootings by Month\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-6-11.png){width=672}\n:::\n\n```{.r .cell-code}\n#Scatterplot of the mid/highest severity shootings\nfilter(mass_shootings_all, severity==\"mid\" | severity==\"high\") %>% \n  ggplot(aes(x=incident_date, y=number_shot))+geom_point()+labs(title=\"Mid Severity Shootings 2014-2022\")\n```\n\n::: {.cell-output-display}\n![](FinalProjectDraft2_EmmaRasmussen_files/figure-html/unnamed-chunk-6-12.png){width=672}\n:::\n:::\n\nFrom these graphs, it looks like mass shootings are increasing in number over time, and \"mid\" severity shootings are also increasing slightly",
    "supporting": [
      "FinalProjectDraft2_EmmaRasmussen_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}