<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Meredith Rolfe">
<meta name="dcterms.date" content="2022-08-26">
<meta name="description" content="Data wrangling: joining data">

<title>- Challenge 8 Solutions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/DACSS_Round_Network.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<link rel="stylesheet" href="styles.css">
<meta name="twitter:title" content="- Challenge 8 Solutions">
<meta name="twitter:description" content="Data wrangling: joining data">
<meta name="twitter:creator" content="@UMassDACSS">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../index.html">
    <img src="../images/UMass White Wordmark Horiz.png" alt="">
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://dacss.github.io/DACSS_601_August2022_v2">August 2022 Posts</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../featured_posts.html">Featured Posts</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">Contributors</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://umass.edu/sbs/dacss">DACSS</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/DACSS/DACSS_601_August2022_v2"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 </a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Challenge 8 Solutions</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">challenge_8</div>
    <div class="quarto-category">activeduty</div>
    <div class="quarto-category">snl</div>
    <div class="quarto-category">faostat</div>
  </div>
  </div>

<div>
  <div class="description">
    Data wrangling: joining data
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Meredith Rolfe </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 26, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">message=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="challenge-overview" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="challenge-overview">Challenge Overview</h2>
<ol type="1">
<li>read in multiple data sets, and describe the data set using both words and any supporting information (e.g., tables, etc)</li>
<li>tidy data (as needed, including sanity checks)</li>
<li>mutate variables as needed (including sanity checks)</li>
<li>join two or more data sets and analyze some aspect of the joined data</li>
</ol>
<div class="panel-tabset page-columns page-full">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Military Marriages</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">FAOstat Regions</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">FAOstat: Regions</a></li></ul>
<div class="tab-content page-columns page-full">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>The excel workbook “ActiveDuty_MaritalStatus.xls” contains tabulations of total number of active duty military members classified by marital and family status, for each of the branches of military as well as the military overall. The sheet is a typical government table, so lets figure out what information is actually available! After that, we will clean a single sheet from the workbook, and use that effort to create a generic function that can be used to iterate through all sheets in the workbook to read them and then join them together into a single dataset.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Find Information available</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Read in single sheet</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Create data reading function</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Purrr to join</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Lets first look at an example sheet from the workbook.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="solution_images/dod_marital.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Total DOD Active Duty Marital Sheet</figcaption><p></p>
</figure>
</div>
<p>We can see a few things from this example sheet. First, we will need to skip 8 or 9 rows - the data first appears in row 10. Second, the tabular cells represent count <em>values</em> that capture the number of employees falling into subcategories created by 6 distinct grouping values: 1) Pay Grade Type: Enlisted/Officer/Warrant Officer 2) Pay Grade Level: 1-10 (fewer for non-Enlisted) 3) Marital status: Married/Single 4) Parent: Kids/noKids (Single only) 5) Spouse affiliation: Civilian/Military (Married only) 6) Gender: Male/Female</p>
<p>Our goal is to recover cases that have these 6 (or really 5, if we collapse parent and spouse variables as we don’t have complete information) grouping variables to identify the <em>case</em> and the single value (count of active duty employees who fall into each of the resulting subcategories.)</p>
<p>Looking back at the original excel sheet, we can see that we will need to not just skip the top rows, we will also need to delete several columns, and also rename variables in order to make it easy to separate out the three pieces of information contained in the column names. First, I create a vector with column names (to make it easier to reuse later when I pivot to tidy data) then I read in the data and inspect it to see if the columns worked as intended.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>marital_cols <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"d"</span>, <span class="st">"payGrade_payLevel"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">"single_nokids_male"</span>, <span class="st">"single_nokids_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"single_kids_male"</span>, <span class="st">"single_kids_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"married_military_male"</span>, <span class="st">"married_military_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">"married_civilian_male"</span>, <span class="st">"married_civilian_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="st">"d"</span>, <span class="dv">3</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="st">"_data/ActiveDuty_MaritalStatus.xls"</span>, </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">skip=</span><span class="dv">8</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">col_names =</span> marital_cols</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>           )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["d...1"],"name":[1],"type":["chr"],"align":["left"]},{"label":["payGrade_payLevel"],"name":[2],"type":["chr"],"align":["left"]},{"label":["single_nokids_male"],"name":[3],"type":["chr"],"align":["left"]},{"label":["single_nokids_female"],"name":[4],"type":["chr"],"align":["left"]},{"label":["d...5"],"name":[5],"type":["chr"],"align":["left"]},{"label":["single_kids_male"],"name":[6],"type":["chr"],"align":["left"]},{"label":["single_kids_female"],"name":[7],"type":["chr"],"align":["left"]},{"label":["d...8"],"name":[8],"type":["chr"],"align":["left"]},{"label":["married_military_male"],"name":[9],"type":["chr"],"align":["left"]},{"label":["married_military_female"],"name":[10],"type":["chr"],"align":["left"]},{"label":["d...11"],"name":[11],"type":["chr"],"align":["left"]},{"label":["married_civilian_male"],"name":[12],"type":["chr"],"align":["left"]},{"label":["married_civilian_female"],"name":[13],"type":["chr"],"align":["left"]},{"label":["d...14"],"name":[14],"type":["chr"],"align":["left"]},{"label":["d...15"],"name":[15],"type":["chr"],"align":["left"]},{"label":["d...16"],"name":[16],"type":["chr"],"align":["left"]},{"label":["d...17"],"name":[17],"type":["chr"],"align":["left"]}],"data":[{"1":"NA","2":"Pay Grade","3":"Male","4":"Female","5":"Total","6":"Male","7":"Female","8":"Total","9":"Male","10":"Female","11":"Total","12":"Male","13":"Female","14":"Total","15":"Male","16":"Female","17":"Total"},{"1":"NA","2":"E-1","3":"31229","4":"5717","5":"36946","6":"563","7":"122","8":"685","9":"139","10":"141","11":"280","12":"5060","13":"719","14":"5779","15":"36991","16":"6699","17":"43690"},{"1":"NA","2":"E-2","3":"53094","4":"8388","5":"61482","6":"1457","7":"275","8":"1732","9":"438","10":"579","11":"1017","12":"12483","13":"1682","14":"14165","15":"67472","16":"10924","17":"78396"},{"1":"NA","2":"E-3","3":"131091","4":"21019","5":"152110","6":"4264","7":"1920","8":"6184","9":"3579","10":"4902","11":"8481","12":"54795","13":"6641","14":"61436","15":"193729","16":"34482","17":"228211"},{"1":"NA","2":"E-4","3":"112710","4":"16381","5":"129091","6":"9491","7":"4662","8":"14153","9":"8661","10":"9778","11":"18439","12":"105556","13":"9961","14":"115517","15":"236418","16":"40782","17":"277200"},{"1":"NA","2":"E-5","3":"57989","4":"11021","5":"69010","6":"10937","7":"6576","8":"17513","9":"12459","10":"11117","11":"23576","12":"130944","13":"8592","14":"139536","15":"212329","16":"37306","17":"249635"},{"1":"NA","2":"E-6","3":"19125","4":"4654","5":"23779","6":"10369","7":"4962","8":"15331","9":"8474","10":"6961","11":"15435","12":"110322","13":"5827","14":"116149","15":"148290","16":"22404","17":"170694"},{"1":"NA","2":"E-7","3":"5446","4":"1913","5":"7359","6":"6530","7":"2585","8":"9115","9":"5065","10":"3291","11":"8356","12":"70001","13":"3206","14":"73207","15":"87042","16":"10995","17":"98037"},{"1":"NA","2":"E-8","3":"1009","4":"438","5":"1447","6":"1786","7":"513","8":"2299","9":"1423","10":"651","11":"2074","12":"21079","13":"820","14":"21899","15":"25297","16":"2422","17":"27719"},{"1":"NA","2":"E-9","3":"381","4":"202","5":"583","6":"579","7":"144","8":"723","9":"458","10":"150","11":"608","12":"8215","13":"291","14":"8506","15":"9633","16":"787","17":"10420"},{"1":"NA","2":"TOTAL ENLISTED","3":"412074","4":"69733","5":"481807","6":"45976","7":"21759","8":"67735","9":"40696","10":"37570","11":"78266","12":"518455","13":"37739","14":"556194","15":"1017201","16":"166801","17":"1184002"},{"1":"NA","2":"O-1","3":"13495","4":"3081","5":"16576","6":"402","7":"229","8":"631","9":"426","10":"669","11":"1095","12":"6959","13":"828","14":"7787","15":"21282","16":"4807","17":"26089"},{"1":"NA","2":"O-2","3":"11029","4":"2715","5":"13744","6":"426","7":"299","8":"725","9":"910","10":"1194","11":"2104","12":"10070","13":"1096","14":"11166","15":"22435","16":"5304","17":"27739"},{"1":"NA","2":"O-3","3":"14551","4":"5056","5":"19607","6":"1442","7":"940","8":"2382","9":"3017","10":"3174","11":"6191","12":"38963","13":"3886","14":"42849","15":"57973","16":"13056","17":"71029"},{"1":"NA","2":"O-4","3":"3480","4":"1720","5":"5200","6":"1190","7":"534","8":"1724","9":"1958","10":"1639","11":"3597","12":"31864","13":"2416","14":"34280","15":"38492","16":"6309","17":"44801"},{"1":"NA","2":"O-5","3":"1244","4":"810","5":"2054","6":"729","7":"267","8":"996","9":"1072","10":"806","11":"1878","12":"22296","13":"1578","14":"23874","15":"25341","16":"3461","17":"28802"},{"1":"NA","2":"O-6","3":"353","4":"349","5":"702","6":"261","7":"94","8":"355","9":"364","10":"182","11":"546","12":"10004","13":"715","14":"10719","15":"10982","16":"1340","17":"12322"},{"1":"NA","2":"O-7","3":"5","4":"7","5":"12","6":"7","7":"1","8":"8","9":"9","10":"6","11":"15","12":"410","13":"18","14":"428","15":"431","16":"32","17":"463"},{"1":"NA","2":"O-8","3":"4","4":"7","5":"11","6":"0","7":"0","8":"0","9":"7","10":"2","11":"9","12":"272","13":"16","14":"288","15":"283","16":"25","17":"308"},{"1":"NA","2":"O-9","3":"1","4":"1","5":"2","6":"1","7":"0","8":"1","9":"1","10":"1","11":"2","12":"144","13":"1","14":"145","15":"147","16":"3","17":"150"},{"1":"NA","2":"O-10","3":"1","4":"0","5":"1","6":"0","7":"0","8":"0","9":"1","10":"1","11":"2","12":"35","13":"0","14":"35","15":"37","16":"1","17":"38"},{"1":"NA","2":"TOTAL OFFICER","3":"44163","4":"13746","5":"57909","6":"4458","7":"2364","8":"6822","9":"7765","10":"7674","11":"15439","12":"121017","13":"10554","14":"131571","15":"177403","16":"34338","17":"211741"},{"1":"NA","2":"W-1","3":"354","4":"68","5":"422","6":"160","7":"81","8":"241","9":"113","10":"107","11":"220","12":"2371","13":"97","14":"2468","15":"2998","16":"353","17":"3351"},{"1":"NA","2":"W-2","3":"658","4":"151","5":"809","6":"358","7":"143","8":"501","9":"295","10":"204","11":"499","12":"5164","13":"134","14":"5298","15":"6475","16":"632","17":"7107"},{"1":"NA","2":"W-3","3":"221","4":"77","5":"298","6":"283","7":"88","8":"371","9":"178","10":"110","11":"288","12":"3790","13":"94","14":"3884","15":"4472","16":"369","17":"4841"},{"1":"NA","2":"W-4","3":"116","4":"47","5":"163","6":"169","7":"35","8":"204","9":"117","10":"45","11":"162","12":"2567","13":"71","14":"2638","15":"2969","16":"198","17":"3167"},{"1":"NA","2":"W-5","3":"25","4":"12","5":"37","6":"24","7":"2","8":"26","9":"11","10":"5","11":"16","12":"650","13":"13","14":"663","15":"710","16":"32","17":"742"},{"1":"NA","2":"TOTAL WARRANT","3":"1374","4":"355","5":"1729","6":"994","7":"349","8":"1343","9":"714","10":"471","11":"1185","12":"14542","13":"409","14":"14951","15":"17624","16":"1584","17":"19208"},{"1":"NA","2":"GRAND TOTAL","3":"457611","4":"83834","5":"541445","6":"51428","7":"24472","8":"75900","9":"49175","10":"45715","11":"94890","12":"654014","13":"48702","14":"702716","15":"1212228","16":"202723","17":"1414951"},{"1":"NA","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA"},{"1":"Top of Page","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>I can see that the variable names worked well, so this time I will read in the data and omit the original header row, and also filter out the various “TOTAL” rows that we don’t need to keep.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>military<span class="ot">&lt;-</span><span class="fu">read_excel</span>(<span class="st">"_data/ActiveDuty_MaritalStatus.xls"</span>, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">skip=</span><span class="dv">9</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">col_names =</span> marital_cols</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>           )<span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">"d"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(payGrade_payLevel, <span class="st">"TOTAL"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>military</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["payGrade_payLevel"],"name":[1],"type":["chr"],"align":["left"]},{"label":["single_nokids_male"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["single_nokids_female"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["single_kids_male"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["single_kids_female"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["married_military_male"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["married_military_female"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["married_civilian_male"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["married_civilian_female"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"E-1","2":"31229","3":"5717","4":"563","5":"122","6":"139","7":"141","8":"5060","9":"719"},{"1":"E-2","2":"53094","3":"8388","4":"1457","5":"275","6":"438","7":"579","8":"12483","9":"1682"},{"1":"E-3","2":"131091","3":"21019","4":"4264","5":"1920","6":"3579","7":"4902","8":"54795","9":"6641"},{"1":"E-4","2":"112710","3":"16381","4":"9491","5":"4662","6":"8661","7":"9778","8":"105556","9":"9961"},{"1":"E-5","2":"57989","3":"11021","4":"10937","5":"6576","6":"12459","7":"11117","8":"130944","9":"8592"},{"1":"E-6","2":"19125","3":"4654","4":"10369","5":"4962","6":"8474","7":"6961","8":"110322","9":"5827"},{"1":"E-7","2":"5446","3":"1913","4":"6530","5":"2585","6":"5065","7":"3291","8":"70001","9":"3206"},{"1":"E-8","2":"1009","3":"438","4":"1786","5":"513","6":"1423","7":"651","8":"21079","9":"820"},{"1":"E-9","2":"381","3":"202","4":"579","5":"144","6":"458","7":"150","8":"8215","9":"291"},{"1":"O-1","2":"13495","3":"3081","4":"402","5":"229","6":"426","7":"669","8":"6959","9":"828"},{"1":"O-2","2":"11029","3":"2715","4":"426","5":"299","6":"910","7":"1194","8":"10070","9":"1096"},{"1":"O-3","2":"14551","3":"5056","4":"1442","5":"940","6":"3017","7":"3174","8":"38963","9":"3886"},{"1":"O-4","2":"3480","3":"1720","4":"1190","5":"534","6":"1958","7":"1639","8":"31864","9":"2416"},{"1":"O-5","2":"1244","3":"810","4":"729","5":"267","6":"1072","7":"806","8":"22296","9":"1578"},{"1":"O-6","2":"353","3":"349","4":"261","5":"94","6":"364","7":"182","8":"10004","9":"715"},{"1":"O-7","2":"5","3":"7","4":"7","5":"1","6":"9","7":"6","8":"410","9":"18"},{"1":"O-8","2":"4","3":"7","4":"0","5":"0","6":"7","7":"2","8":"272","9":"16"},{"1":"O-9","2":"1","3":"1","4":"1","5":"0","6":"1","7":"1","8":"144","9":"1"},{"1":"O-10","2":"1","3":"0","4":"0","5":"0","6":"1","7":"1","8":"35","9":"0"},{"1":"W-1","2":"354","3":"68","4":"160","5":"81","6":"113","7":"107","8":"2371","9":"97"},{"1":"W-2","2":"658","3":"151","4":"358","5":"143","6":"295","7":"204","8":"5164","9":"134"},{"1":"W-3","2":"221","3":"77","4":"283","5":"88","6":"178","7":"110","8":"3790","9":"94"},{"1":"W-4","2":"116","3":"47","4":"169","5":"35","6":"117","7":"45","8":"2567","9":"71"},{"1":"W-5","2":"25","3":"12","4":"24","5":"2","6":"11","7":"5","8":"650","9":"13"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>It looks like this worked well! Now we just need to pivot_longer with 3 columns, then separate out the information in the <code>payGrade_payLevel</code> variable and do a quick mutate to make paygrade easier to remember.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>military_long <span class="ot">&lt;-</span>military <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"Marital"</span>, <span class="st">"Other"</span>, <span class="st">"Gender"</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"count"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(payGrade_payLevel, </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"payGrade"</span>, <span class="st">"payLevel"</span>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep=</span><span class="st">"-"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">payGrade =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"Enlisted"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"O"</span> <span class="sc">~</span> <span class="st">"Officer"</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"Warrant Officer"</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>military_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["payGrade"],"name":[1],"type":["chr"],"align":["left"]},{"label":["payLevel"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Marital"],"name":[3],"type":["chr"],"align":["left"]},{"label":["Other"],"name":[4],"type":["chr"],"align":["left"]},{"label":["Gender"],"name":[5],"type":["chr"],"align":["left"]},{"label":["count"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"Enlisted","2":"1","3":"single","4":"nokids","5":"male","6":"31229"},{"1":"Enlisted","2":"1","3":"single","4":"nokids","5":"female","6":"5717"},{"1":"Enlisted","2":"1","3":"single","4":"kids","5":"male","6":"563"},{"1":"Enlisted","2":"1","3":"single","4":"kids","5":"female","6":"122"},{"1":"Enlisted","2":"1","3":"married","4":"military","5":"male","6":"139"},{"1":"Enlisted","2":"1","3":"married","4":"military","5":"female","6":"141"},{"1":"Enlisted","2":"1","3":"married","4":"civilian","5":"male","6":"5060"},{"1":"Enlisted","2":"1","3":"married","4":"civilian","5":"female","6":"719"},{"1":"Enlisted","2":"2","3":"single","4":"nokids","5":"male","6":"53094"},{"1":"Enlisted","2":"2","3":"single","4":"nokids","5":"female","6":"8388"},{"1":"Enlisted","2":"2","3":"single","4":"kids","5":"male","6":"1457"},{"1":"Enlisted","2":"2","3":"single","4":"kids","5":"female","6":"275"},{"1":"Enlisted","2":"2","3":"married","4":"military","5":"male","6":"438"},{"1":"Enlisted","2":"2","3":"married","4":"military","5":"female","6":"579"},{"1":"Enlisted","2":"2","3":"married","4":"civilian","5":"male","6":"12483"},{"1":"Enlisted","2":"2","3":"married","4":"civilian","5":"female","6":"1682"},{"1":"Enlisted","2":"3","3":"single","4":"nokids","5":"male","6":"131091"},{"1":"Enlisted","2":"3","3":"single","4":"nokids","5":"female","6":"21019"},{"1":"Enlisted","2":"3","3":"single","4":"kids","5":"male","6":"4264"},{"1":"Enlisted","2":"3","3":"single","4":"kids","5":"female","6":"1920"},{"1":"Enlisted","2":"3","3":"married","4":"military","5":"male","6":"3579"},{"1":"Enlisted","2":"3","3":"married","4":"military","5":"female","6":"4902"},{"1":"Enlisted","2":"3","3":"married","4":"civilian","5":"male","6":"54795"},{"1":"Enlisted","2":"3","3":"married","4":"civilian","5":"female","6":"6641"},{"1":"Enlisted","2":"4","3":"single","4":"nokids","5":"male","6":"112710"},{"1":"Enlisted","2":"4","3":"single","4":"nokids","5":"female","6":"16381"},{"1":"Enlisted","2":"4","3":"single","4":"kids","5":"male","6":"9491"},{"1":"Enlisted","2":"4","3":"single","4":"kids","5":"female","6":"4662"},{"1":"Enlisted","2":"4","3":"married","4":"military","5":"male","6":"8661"},{"1":"Enlisted","2":"4","3":"married","4":"military","5":"female","6":"9778"},{"1":"Enlisted","2":"4","3":"married","4":"civilian","5":"male","6":"105556"},{"1":"Enlisted","2":"4","3":"married","4":"civilian","5":"female","6":"9961"},{"1":"Enlisted","2":"5","3":"single","4":"nokids","5":"male","6":"57989"},{"1":"Enlisted","2":"5","3":"single","4":"nokids","5":"female","6":"11021"},{"1":"Enlisted","2":"5","3":"single","4":"kids","5":"male","6":"10937"},{"1":"Enlisted","2":"5","3":"single","4":"kids","5":"female","6":"6576"},{"1":"Enlisted","2":"5","3":"married","4":"military","5":"male","6":"12459"},{"1":"Enlisted","2":"5","3":"married","4":"military","5":"female","6":"11117"},{"1":"Enlisted","2":"5","3":"married","4":"civilian","5":"male","6":"130944"},{"1":"Enlisted","2":"5","3":"married","4":"civilian","5":"female","6":"8592"},{"1":"Enlisted","2":"6","3":"single","4":"nokids","5":"male","6":"19125"},{"1":"Enlisted","2":"6","3":"single","4":"nokids","5":"female","6":"4654"},{"1":"Enlisted","2":"6","3":"single","4":"kids","5":"male","6":"10369"},{"1":"Enlisted","2":"6","3":"single","4":"kids","5":"female","6":"4962"},{"1":"Enlisted","2":"6","3":"married","4":"military","5":"male","6":"8474"},{"1":"Enlisted","2":"6","3":"married","4":"military","5":"female","6":"6961"},{"1":"Enlisted","2":"6","3":"married","4":"civilian","5":"male","6":"110322"},{"1":"Enlisted","2":"6","3":"married","4":"civilian","5":"female","6":"5827"},{"1":"Enlisted","2":"7","3":"single","4":"nokids","5":"male","6":"5446"},{"1":"Enlisted","2":"7","3":"single","4":"nokids","5":"female","6":"1913"},{"1":"Enlisted","2":"7","3":"single","4":"kids","5":"male","6":"6530"},{"1":"Enlisted","2":"7","3":"single","4":"kids","5":"female","6":"2585"},{"1":"Enlisted","2":"7","3":"married","4":"military","5":"male","6":"5065"},{"1":"Enlisted","2":"7","3":"married","4":"military","5":"female","6":"3291"},{"1":"Enlisted","2":"7","3":"married","4":"civilian","5":"male","6":"70001"},{"1":"Enlisted","2":"7","3":"married","4":"civilian","5":"female","6":"3206"},{"1":"Enlisted","2":"8","3":"single","4":"nokids","5":"male","6":"1009"},{"1":"Enlisted","2":"8","3":"single","4":"nokids","5":"female","6":"438"},{"1":"Enlisted","2":"8","3":"single","4":"kids","5":"male","6":"1786"},{"1":"Enlisted","2":"8","3":"single","4":"kids","5":"female","6":"513"},{"1":"Enlisted","2":"8","3":"married","4":"military","5":"male","6":"1423"},{"1":"Enlisted","2":"8","3":"married","4":"military","5":"female","6":"651"},{"1":"Enlisted","2":"8","3":"married","4":"civilian","5":"male","6":"21079"},{"1":"Enlisted","2":"8","3":"married","4":"civilian","5":"female","6":"820"},{"1":"Enlisted","2":"9","3":"single","4":"nokids","5":"male","6":"381"},{"1":"Enlisted","2":"9","3":"single","4":"nokids","5":"female","6":"202"},{"1":"Enlisted","2":"9","3":"single","4":"kids","5":"male","6":"579"},{"1":"Enlisted","2":"9","3":"single","4":"kids","5":"female","6":"144"},{"1":"Enlisted","2":"9","3":"married","4":"military","5":"male","6":"458"},{"1":"Enlisted","2":"9","3":"married","4":"military","5":"female","6":"150"},{"1":"Enlisted","2":"9","3":"married","4":"civilian","5":"male","6":"8215"},{"1":"Enlisted","2":"9","3":"married","4":"civilian","5":"female","6":"291"},{"1":"Officer","2":"1","3":"single","4":"nokids","5":"male","6":"13495"},{"1":"Officer","2":"1","3":"single","4":"nokids","5":"female","6":"3081"},{"1":"Officer","2":"1","3":"single","4":"kids","5":"male","6":"402"},{"1":"Officer","2":"1","3":"single","4":"kids","5":"female","6":"229"},{"1":"Officer","2":"1","3":"married","4":"military","5":"male","6":"426"},{"1":"Officer","2":"1","3":"married","4":"military","5":"female","6":"669"},{"1":"Officer","2":"1","3":"married","4":"civilian","5":"male","6":"6959"},{"1":"Officer","2":"1","3":"married","4":"civilian","5":"female","6":"828"},{"1":"Officer","2":"2","3":"single","4":"nokids","5":"male","6":"11029"},{"1":"Officer","2":"2","3":"single","4":"nokids","5":"female","6":"2715"},{"1":"Officer","2":"2","3":"single","4":"kids","5":"male","6":"426"},{"1":"Officer","2":"2","3":"single","4":"kids","5":"female","6":"299"},{"1":"Officer","2":"2","3":"married","4":"military","5":"male","6":"910"},{"1":"Officer","2":"2","3":"married","4":"military","5":"female","6":"1194"},{"1":"Officer","2":"2","3":"married","4":"civilian","5":"male","6":"10070"},{"1":"Officer","2":"2","3":"married","4":"civilian","5":"female","6":"1096"},{"1":"Officer","2":"3","3":"single","4":"nokids","5":"male","6":"14551"},{"1":"Officer","2":"3","3":"single","4":"nokids","5":"female","6":"5056"},{"1":"Officer","2":"3","3":"single","4":"kids","5":"male","6":"1442"},{"1":"Officer","2":"3","3":"single","4":"kids","5":"female","6":"940"},{"1":"Officer","2":"3","3":"married","4":"military","5":"male","6":"3017"},{"1":"Officer","2":"3","3":"married","4":"military","5":"female","6":"3174"},{"1":"Officer","2":"3","3":"married","4":"civilian","5":"male","6":"38963"},{"1":"Officer","2":"3","3":"married","4":"civilian","5":"female","6":"3886"},{"1":"Officer","2":"4","3":"single","4":"nokids","5":"male","6":"3480"},{"1":"Officer","2":"4","3":"single","4":"nokids","5":"female","6":"1720"},{"1":"Officer","2":"4","3":"single","4":"kids","5":"male","6":"1190"},{"1":"Officer","2":"4","3":"single","4":"kids","5":"female","6":"534"},{"1":"Officer","2":"4","3":"married","4":"military","5":"male","6":"1958"},{"1":"Officer","2":"4","3":"married","4":"military","5":"female","6":"1639"},{"1":"Officer","2":"4","3":"married","4":"civilian","5":"male","6":"31864"},{"1":"Officer","2":"4","3":"married","4":"civilian","5":"female","6":"2416"},{"1":"Officer","2":"5","3":"single","4":"nokids","5":"male","6":"1244"},{"1":"Officer","2":"5","3":"single","4":"nokids","5":"female","6":"810"},{"1":"Officer","2":"5","3":"single","4":"kids","5":"male","6":"729"},{"1":"Officer","2":"5","3":"single","4":"kids","5":"female","6":"267"},{"1":"Officer","2":"5","3":"married","4":"military","5":"male","6":"1072"},{"1":"Officer","2":"5","3":"married","4":"military","5":"female","6":"806"},{"1":"Officer","2":"5","3":"married","4":"civilian","5":"male","6":"22296"},{"1":"Officer","2":"5","3":"married","4":"civilian","5":"female","6":"1578"},{"1":"Officer","2":"6","3":"single","4":"nokids","5":"male","6":"353"},{"1":"Officer","2":"6","3":"single","4":"nokids","5":"female","6":"349"},{"1":"Officer","2":"6","3":"single","4":"kids","5":"male","6":"261"},{"1":"Officer","2":"6","3":"single","4":"kids","5":"female","6":"94"},{"1":"Officer","2":"6","3":"married","4":"military","5":"male","6":"364"},{"1":"Officer","2":"6","3":"married","4":"military","5":"female","6":"182"},{"1":"Officer","2":"6","3":"married","4":"civilian","5":"male","6":"10004"},{"1":"Officer","2":"6","3":"married","4":"civilian","5":"female","6":"715"},{"1":"Officer","2":"7","3":"single","4":"nokids","5":"male","6":"5"},{"1":"Officer","2":"7","3":"single","4":"nokids","5":"female","6":"7"},{"1":"Officer","2":"7","3":"single","4":"kids","5":"male","6":"7"},{"1":"Officer","2":"7","3":"single","4":"kids","5":"female","6":"1"},{"1":"Officer","2":"7","3":"married","4":"military","5":"male","6":"9"},{"1":"Officer","2":"7","3":"married","4":"military","5":"female","6":"6"},{"1":"Officer","2":"7","3":"married","4":"civilian","5":"male","6":"410"},{"1":"Officer","2":"7","3":"married","4":"civilian","5":"female","6":"18"},{"1":"Officer","2":"8","3":"single","4":"nokids","5":"male","6":"4"},{"1":"Officer","2":"8","3":"single","4":"nokids","5":"female","6":"7"},{"1":"Officer","2":"8","3":"single","4":"kids","5":"male","6":"0"},{"1":"Officer","2":"8","3":"single","4":"kids","5":"female","6":"0"},{"1":"Officer","2":"8","3":"married","4":"military","5":"male","6":"7"},{"1":"Officer","2":"8","3":"married","4":"military","5":"female","6":"2"},{"1":"Officer","2":"8","3":"married","4":"civilian","5":"male","6":"272"},{"1":"Officer","2":"8","3":"married","4":"civilian","5":"female","6":"16"},{"1":"Officer","2":"9","3":"single","4":"nokids","5":"male","6":"1"},{"1":"Officer","2":"9","3":"single","4":"nokids","5":"female","6":"1"},{"1":"Officer","2":"9","3":"single","4":"kids","5":"male","6":"1"},{"1":"Officer","2":"9","3":"single","4":"kids","5":"female","6":"0"},{"1":"Officer","2":"9","3":"married","4":"military","5":"male","6":"1"},{"1":"Officer","2":"9","3":"married","4":"military","5":"female","6":"1"},{"1":"Officer","2":"9","3":"married","4":"civilian","5":"male","6":"144"},{"1":"Officer","2":"9","3":"married","4":"civilian","5":"female","6":"1"},{"1":"Officer","2":"10","3":"single","4":"nokids","5":"male","6":"1"},{"1":"Officer","2":"10","3":"single","4":"nokids","5":"female","6":"0"},{"1":"Officer","2":"10","3":"single","4":"kids","5":"male","6":"0"},{"1":"Officer","2":"10","3":"single","4":"kids","5":"female","6":"0"},{"1":"Officer","2":"10","3":"married","4":"military","5":"male","6":"1"},{"1":"Officer","2":"10","3":"married","4":"military","5":"female","6":"1"},{"1":"Officer","2":"10","3":"married","4":"civilian","5":"male","6":"35"},{"1":"Officer","2":"10","3":"married","4":"civilian","5":"female","6":"0"},{"1":"Warrant Officer","2":"1","3":"single","4":"nokids","5":"male","6":"354"},{"1":"Warrant Officer","2":"1","3":"single","4":"nokids","5":"female","6":"68"},{"1":"Warrant Officer","2":"1","3":"single","4":"kids","5":"male","6":"160"},{"1":"Warrant Officer","2":"1","3":"single","4":"kids","5":"female","6":"81"},{"1":"Warrant Officer","2":"1","3":"married","4":"military","5":"male","6":"113"},{"1":"Warrant Officer","2":"1","3":"married","4":"military","5":"female","6":"107"},{"1":"Warrant Officer","2":"1","3":"married","4":"civilian","5":"male","6":"2371"},{"1":"Warrant Officer","2":"1","3":"married","4":"civilian","5":"female","6":"97"},{"1":"Warrant Officer","2":"2","3":"single","4":"nokids","5":"male","6":"658"},{"1":"Warrant Officer","2":"2","3":"single","4":"nokids","5":"female","6":"151"},{"1":"Warrant Officer","2":"2","3":"single","4":"kids","5":"male","6":"358"},{"1":"Warrant Officer","2":"2","3":"single","4":"kids","5":"female","6":"143"},{"1":"Warrant Officer","2":"2","3":"married","4":"military","5":"male","6":"295"},{"1":"Warrant Officer","2":"2","3":"married","4":"military","5":"female","6":"204"},{"1":"Warrant Officer","2":"2","3":"married","4":"civilian","5":"male","6":"5164"},{"1":"Warrant Officer","2":"2","3":"married","4":"civilian","5":"female","6":"134"},{"1":"Warrant Officer","2":"3","3":"single","4":"nokids","5":"male","6":"221"},{"1":"Warrant Officer","2":"3","3":"single","4":"nokids","5":"female","6":"77"},{"1":"Warrant Officer","2":"3","3":"single","4":"kids","5":"male","6":"283"},{"1":"Warrant Officer","2":"3","3":"single","4":"kids","5":"female","6":"88"},{"1":"Warrant Officer","2":"3","3":"married","4":"military","5":"male","6":"178"},{"1":"Warrant Officer","2":"3","3":"married","4":"military","5":"female","6":"110"},{"1":"Warrant Officer","2":"3","3":"married","4":"civilian","5":"male","6":"3790"},{"1":"Warrant Officer","2":"3","3":"married","4":"civilian","5":"female","6":"94"},{"1":"Warrant Officer","2":"4","3":"single","4":"nokids","5":"male","6":"116"},{"1":"Warrant Officer","2":"4","3":"single","4":"nokids","5":"female","6":"47"},{"1":"Warrant Officer","2":"4","3":"single","4":"kids","5":"male","6":"169"},{"1":"Warrant Officer","2":"4","3":"single","4":"kids","5":"female","6":"35"},{"1":"Warrant Officer","2":"4","3":"married","4":"military","5":"male","6":"117"},{"1":"Warrant Officer","2":"4","3":"married","4":"military","5":"female","6":"45"},{"1":"Warrant Officer","2":"4","3":"married","4":"civilian","5":"male","6":"2567"},{"1":"Warrant Officer","2":"4","3":"married","4":"civilian","5":"female","6":"71"},{"1":"Warrant Officer","2":"5","3":"single","4":"nokids","5":"male","6":"25"},{"1":"Warrant Officer","2":"5","3":"single","4":"nokids","5":"female","6":"12"},{"1":"Warrant Officer","2":"5","3":"single","4":"kids","5":"male","6":"24"},{"1":"Warrant Officer","2":"5","3":"single","4":"kids","5":"female","6":"2"},{"1":"Warrant Officer","2":"5","3":"married","4":"military","5":"male","6":"11"},{"1":"Warrant Officer","2":"5","3":"married","4":"military","5":"female","6":"5"},{"1":"Warrant Officer","2":"5","3":"married","4":"civilian","5":"male","6":"650"},{"1":"Warrant Officer","2":"5","3":"married","4":"civilian","5":"female","6":"13"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>This all looks like it works well. So now we will go on to creating a function with the steps, then applying it to multiple sheets.</p>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>We will call our new function <code>read_military</code>, and we will basically use the exact same commands as above. The big difference is that we will have a placeholder name (or argument) for the data sheet that will be passed to the new function.</p>
<p>Another difference is that when using <code>read_excel()</code> on a workbook with multiple sheets, we need to specify the sheetname of the sheet we wish to read in (we can also specify the sheet name). I then include the <code>mutate()</code> command to create a new column called <code>branch</code>, which comes from our sheet name.</p>
<p>Everything else will be pretty identical to reading a single sheet - <code>select(!starts_with("d"))</code> removes all columns that start with <code>"d"</code>. We also filter out the word “Total” from <code>payGrade_payLevel</code>. <code>pivot_longer()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>read_military<span class="ot">&lt;-</span><span class="cf">function</span>(sheet_name){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel</span>(<span class="st">"_data/ActiveDuty_MaritalStatus.xls"</span>, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">sheet =</span> sheet_name,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">skip=</span><span class="dv">9</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">col_names =</span> marital_cols</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>             )<span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"branch"</span><span class="ot">=</span>sheet_name) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">"d"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(payGrade_payLevel, <span class="st">"TOTAL"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>))<span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>)),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"Marital"</span>, <span class="st">"Other"</span>, <span class="st">"Gender"</span>),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"count"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(payGrade_payLevel, </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"payGrade"</span>, <span class="st">"payLevel"</span>),</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep=</span><span class="st">"-"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">payGrade =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"Enlisted"</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"O"</span> <span class="sc">~</span> <span class="st">"Officer"</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"Warrant Officer"</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p>We now have a function that is customized to read in the mmilitary active duty marital status sheets. We just need to use <code>purrr</code> - a package that is part of tidyverse but which may need to be installed and loaded on its own - to iterate through the list of sheets in the workbook.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>military_sheets<span class="ot">&lt;-</span><span class="fu">excel_sheets</span>(<span class="st">"_data/ActiveDuty_MaritalStatus.xls"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>military_sheets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "TotalDoD"    "AirForce"    "MarineCorps" "Navy"        "Army"       </code></pre>
</div>
</div>
<p>Now we have a list of sheet names to map with the function. Typically, a purrr::map function creates a list of data frames with each element in the original vector fed to the function as a single list element, as depicted below.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<p>
</p><p><img src="challenge8_solutions_files\figure-html\mermaid-figure-1.png" style="width:6.86in;height:4.52in"></p>
<p></p>
<p>Purrring Military Workbook</p>
</div>
</div>
</div>
<p>We are going to use <code>map_dfr()</code> to join the four elements of the list into a single dataframe. <code>map</code> is the generic <code>purrr</code> function, and adding on the <code>dfr</code> means that we want to turn all of the list elements created by <code>map</code> into a single datafame (df) that is joined by rows (r).</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
using <code>map_dfr</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are functions in <code>purrr</code> that automatically convert the list created by map into the dataframe shape that you want, but you need to be careful that the objects being mapped have the correct column names (or rows, if you are using <code>map_dfc()</code> to avoid errors. Plain <code>map</code> is the safe option, but you then have to manually join the data.)</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>military_all <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">excel_sheets</span>(<span class="st">"_data/ActiveDuty_MaritalStatus.xls"</span>)[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>],</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  read_military)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>military_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["payGrade"],"name":[1],"type":["chr"],"align":["left"]},{"label":["payLevel"],"name":[2],"type":["chr"],"align":["left"]},{"label":["branch"],"name":[3],"type":["chr"],"align":["left"]},{"label":["Marital"],"name":[4],"type":["chr"],"align":["left"]},{"label":["Other"],"name":[5],"type":["chr"],"align":["left"]},{"label":["Gender"],"name":[6],"type":["chr"],"align":["left"]},{"label":["count"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"Enlisted","2":"1","3":"AirForce","4":"single","5":"nokids","6":"male","7":"7721"},{"1":"Enlisted","2":"1","3":"AirForce","4":"single","5":"nokids","6":"female","7":"1550"},{"1":"Enlisted","2":"1","3":"AirForce","4":"single","5":"kids","6":"male","7":"27"},{"1":"Enlisted","2":"1","3":"AirForce","4":"single","5":"kids","6":"female","7":"5"},{"1":"Enlisted","2":"1","3":"AirForce","4":"married","5":"military","6":"male","7":"49"},{"1":"Enlisted","2":"1","3":"AirForce","4":"married","5":"military","6":"female","7":"27"},{"1":"Enlisted","2":"1","3":"AirForce","4":"married","5":"civilian","6":"male","7":"1064"},{"1":"Enlisted","2":"1","3":"AirForce","4":"married","5":"civilian","6":"female","7":"178"},{"1":"Enlisted","2":"2","3":"AirForce","4":"single","5":"nokids","6":"male","7":"4380"},{"1":"Enlisted","2":"2","3":"AirForce","4":"single","5":"nokids","6":"female","7":"1010"},{"1":"Enlisted","2":"2","3":"AirForce","4":"single","5":"kids","6":"male","7":"33"},{"1":"Enlisted","2":"2","3":"AirForce","4":"single","5":"kids","6":"female","7":"9"},{"1":"Enlisted","2":"2","3":"AirForce","4":"married","5":"military","6":"male","7":"97"},{"1":"Enlisted","2":"2","3":"AirForce","4":"married","5":"military","6":"female","7":"105"},{"1":"Enlisted","2":"2","3":"AirForce","4":"married","5":"civilian","6":"male","7":"802"},{"1":"Enlisted","2":"2","3":"AirForce","4":"married","5":"civilian","6":"female","7":"163"},{"1":"Enlisted","2":"3","3":"AirForce","4":"single","5":"nokids","6":"male","7":"29725"},{"1":"Enlisted","2":"3","3":"AirForce","4":"single","5":"nokids","6":"female","7":"7108"},{"1":"Enlisted","2":"3","3":"AirForce","4":"single","5":"kids","6":"male","7":"396"},{"1":"Enlisted","2":"3","3":"AirForce","4":"single","5":"kids","6":"female","7":"266"},{"1":"Enlisted","2":"3","3":"AirForce","4":"married","5":"military","6":"male","7":"1258"},{"1":"Enlisted","2":"3","3":"AirForce","4":"married","5":"military","6":"female","7":"1687"},{"1":"Enlisted","2":"3","3":"AirForce","4":"married","5":"civilian","6":"male","7":"10436"},{"1":"Enlisted","2":"3","3":"AirForce","4":"married","5":"civilian","6":"female","7":"1631"},{"1":"Enlisted","2":"4","3":"AirForce","4":"single","5":"nokids","6":"male","7":"20805"},{"1":"Enlisted","2":"4","3":"AirForce","4":"single","5":"nokids","6":"female","7":"4756"},{"1":"Enlisted","2":"4","3":"AirForce","4":"single","5":"kids","6":"male","7":"987"},{"1":"Enlisted","2":"4","3":"AirForce","4":"single","5":"kids","6":"female","7":"842"},{"1":"Enlisted","2":"4","3":"AirForce","4":"married","5":"military","6":"male","7":"3036"},{"1":"Enlisted","2":"4","3":"AirForce","4":"married","5":"military","6":"female","7":"3207"},{"1":"Enlisted","2":"4","3":"AirForce","4":"married","5":"civilian","6":"male","7":"15363"},{"1":"Enlisted","2":"4","3":"AirForce","4":"married","5":"civilian","6":"female","7":"1769"},{"1":"Enlisted","2":"5","3":"AirForce","4":"single","5":"nokids","6":"male","7":"14623"},{"1":"Enlisted","2":"5","3":"AirForce","4":"single","5":"nokids","6":"female","7":"4104"},{"1":"Enlisted","2":"5","3":"AirForce","4":"single","5":"kids","6":"male","7":"2755"},{"1":"Enlisted","2":"5","3":"AirForce","4":"single","5":"kids","6":"female","7":"2171"},{"1":"Enlisted","2":"5","3":"AirForce","4":"married","5":"military","6":"male","7":"6154"},{"1":"Enlisted","2":"5","3":"AirForce","4":"married","5":"military","6":"female","7":"5519"},{"1":"Enlisted","2":"5","3":"AirForce","4":"married","5":"civilian","6":"male","7":"31711"},{"1":"Enlisted","2":"5","3":"AirForce","4":"married","5":"civilian","6":"female","7":"2889"},{"1":"Enlisted","2":"6","3":"AirForce","4":"single","5":"nokids","6":"male","7":"3660"},{"1":"Enlisted","2":"6","3":"AirForce","4":"single","5":"nokids","6":"female","7":"1377"},{"1":"Enlisted","2":"6","3":"AirForce","4":"single","5":"kids","6":"male","7":"2446"},{"1":"Enlisted","2":"6","3":"AirForce","4":"single","5":"kids","6":"female","7":"1449"},{"1":"Enlisted","2":"6","3":"AirForce","4":"married","5":"military","6":"male","7":"3654"},{"1":"Enlisted","2":"6","3":"AirForce","4":"married","5":"military","6":"female","7":"3263"},{"1":"Enlisted","2":"6","3":"AirForce","4":"married","5":"civilian","6":"male","7":"23868"},{"1":"Enlisted","2":"6","3":"AirForce","4":"married","5":"civilian","6":"female","7":"2026"},{"1":"Enlisted","2":"7","3":"AirForce","4":"single","5":"nokids","6":"male","7":"1441"},{"1":"Enlisted","2":"7","3":"AirForce","4":"single","5":"nokids","6":"female","7":"617"},{"1":"Enlisted","2":"7","3":"AirForce","4":"single","5":"kids","6":"male","7":"1539"},{"1":"Enlisted","2":"7","3":"AirForce","4":"single","5":"kids","6":"female","7":"734"},{"1":"Enlisted","2":"7","3":"AirForce","4":"married","5":"military","6":"male","7":"2118"},{"1":"Enlisted","2":"7","3":"AirForce","4":"married","5":"military","6":"female","7":"1419"},{"1":"Enlisted","2":"7","3":"AirForce","4":"married","5":"civilian","6":"male","7":"17290"},{"1":"Enlisted","2":"7","3":"AirForce","4":"married","5":"civilian","6":"female","7":"1188"},{"1":"Enlisted","2":"8","3":"AirForce","4":"single","5":"nokids","6":"male","7":"182"},{"1":"Enlisted","2":"8","3":"AirForce","4":"single","5":"nokids","6":"female","7":"139"},{"1":"Enlisted","2":"8","3":"AirForce","4":"single","5":"kids","6":"male","7":"236"},{"1":"Enlisted","2":"8","3":"AirForce","4":"single","5":"kids","6":"female","7":"110"},{"1":"Enlisted","2":"8","3":"AirForce","4":"married","5":"military","6":"male","7":"505"},{"1":"Enlisted","2":"8","3":"AirForce","4":"married","5":"military","6":"female","7":"241"},{"1":"Enlisted","2":"8","3":"AirForce","4":"married","5":"civilian","6":"male","7":"3655"},{"1":"Enlisted","2":"8","3":"AirForce","4":"married","5":"civilian","6":"female","7":"228"},{"1":"Enlisted","2":"9","3":"AirForce","4":"single","5":"nokids","6":"male","7":"83"},{"1":"Enlisted","2":"9","3":"AirForce","4":"single","5":"nokids","6":"female","7":"48"},{"1":"Enlisted","2":"9","3":"AirForce","4":"single","5":"kids","6":"male","7":"106"},{"1":"Enlisted","2":"9","3":"AirForce","4":"single","5":"kids","6":"female","7":"39"},{"1":"Enlisted","2":"9","3":"AirForce","4":"married","5":"military","6":"male","7":"204"},{"1":"Enlisted","2":"9","3":"AirForce","4":"married","5":"military","6":"female","7":"73"},{"1":"Enlisted","2":"9","3":"AirForce","4":"married","5":"civilian","6":"male","7":"1975"},{"1":"Enlisted","2":"9","3":"AirForce","4":"married","5":"civilian","6":"female","7":"108"},{"1":"Officer","2":"1","3":"AirForce","4":"single","5":"nokids","6":"male","7":"3831"},{"1":"Officer","2":"1","3":"AirForce","4":"single","5":"nokids","6":"female","7":"1068"},{"1":"Officer","2":"1","3":"AirForce","4":"single","5":"kids","6":"male","7":"45"},{"1":"Officer","2":"1","3":"AirForce","4":"single","5":"kids","6":"female","7":"43"},{"1":"Officer","2":"1","3":"AirForce","4":"married","5":"military","6":"male","7":"182"},{"1":"Officer","2":"1","3":"AirForce","4":"married","5":"military","6":"female","7":"265"},{"1":"Officer","2":"1","3":"AirForce","4":"married","5":"civilian","6":"male","7":"1693"},{"1":"Officer","2":"1","3":"AirForce","4":"married","5":"civilian","6":"female","7":"211"},{"1":"Officer","2":"2","3":"AirForce","4":"single","5":"nokids","6":"male","7":"2710"},{"1":"Officer","2":"2","3":"AirForce","4":"single","5":"nokids","6":"female","7":"819"},{"1":"Officer","2":"2","3":"AirForce","4":"single","5":"kids","6":"male","7":"63"},{"1":"Officer","2":"2","3":"AirForce","4":"single","5":"kids","6":"female","7":"45"},{"1":"Officer","2":"2","3":"AirForce","4":"married","5":"military","6":"male","7":"381"},{"1":"Officer","2":"2","3":"AirForce","4":"married","5":"military","6":"female","7":"472"},{"1":"Officer","2":"2","3":"AirForce","4":"married","5":"civilian","6":"male","7":"2443"},{"1":"Officer","2":"2","3":"AirForce","4":"married","5":"civilian","6":"female","7":"310"},{"1":"Officer","2":"3","3":"AirForce","4":"single","5":"nokids","6":"male","7":"4035"},{"1":"Officer","2":"3","3":"AirForce","4":"single","5":"nokids","6":"female","7":"1642"},{"1":"Officer","2":"3","3":"AirForce","4":"single","5":"kids","6":"male","7":"338"},{"1":"Officer","2":"3","3":"AirForce","4":"single","5":"kids","6":"female","7":"295"},{"1":"Officer","2":"3","3":"AirForce","4":"married","5":"military","6":"male","7":"1378"},{"1":"Officer","2":"3","3":"AirForce","4":"married","5":"military","6":"female","7":"1256"},{"1":"Officer","2":"3","3":"AirForce","4":"married","5":"civilian","6":"male","7":"11841"},{"1":"Officer","2":"3","3":"AirForce","4":"married","5":"civilian","6":"female","7":"1436"},{"1":"Officer","2":"4","3":"AirForce","4":"single","5":"nokids","6":"male","7":"1077"},{"1":"Officer","2":"4","3":"AirForce","4":"single","5":"nokids","6":"female","7":"597"},{"1":"Officer","2":"4","3":"AirForce","4":"single","5":"kids","6":"male","7":"293"},{"1":"Officer","2":"4","3":"AirForce","4":"single","5":"kids","6":"female","7":"191"},{"1":"Officer","2":"4","3":"AirForce","4":"married","5":"military","6":"male","7":"969"},{"1":"Officer","2":"4","3":"AirForce","4":"married","5":"military","6":"female","7":"655"},{"1":"Officer","2":"4","3":"AirForce","4":"married","5":"civilian","6":"male","7":"9545"},{"1":"Officer","2":"4","3":"AirForce","4":"married","5":"civilian","6":"female","7":"995"},{"1":"Officer","2":"5","3":"AirForce","4":"single","5":"nokids","6":"male","7":"425"},{"1":"Officer","2":"5","3":"AirForce","4":"single","5":"nokids","6":"female","7":"300"},{"1":"Officer","2":"5","3":"AirForce","4":"single","5":"kids","6":"male","7":"212"},{"1":"Officer","2":"5","3":"AirForce","4":"single","5":"kids","6":"female","7":"94"},{"1":"Officer","2":"5","3":"AirForce","4":"married","5":"military","6":"male","7":"590"},{"1":"Officer","2":"5","3":"AirForce","4":"married","5":"military","6":"female","7":"321"},{"1":"Officer","2":"5","3":"AirForce","4":"married","5":"civilian","6":"male","7":"7608"},{"1":"Officer","2":"5","3":"AirForce","4":"married","5":"civilian","6":"female","7":"607"},{"1":"Officer","2":"6","3":"AirForce","4":"single","5":"nokids","6":"male","7":"101"},{"1":"Officer","2":"6","3":"AirForce","4":"single","5":"nokids","6":"female","7":"107"},{"1":"Officer","2":"6","3":"AirForce","4":"single","5":"kids","6":"male","7":"67"},{"1":"Officer","2":"6","3":"AirForce","4":"single","5":"kids","6":"female","7":"20"},{"1":"Officer","2":"6","3":"AirForce","4":"married","5":"military","6":"male","7":"174"},{"1":"Officer","2":"6","3":"AirForce","4":"married","5":"military","6":"female","7":"58"},{"1":"Officer","2":"6","3":"AirForce","4":"married","5":"civilian","6":"male","7":"3015"},{"1":"Officer","2":"6","3":"AirForce","4":"married","5":"civilian","6":"female","7":"230"},{"1":"Officer","2":"7","3":"AirForce","4":"single","5":"nokids","6":"male","7":"0"},{"1":"Officer","2":"7","3":"AirForce","4":"single","5":"nokids","6":"female","7":"2"},{"1":"Officer","2":"7","3":"AirForce","4":"single","5":"kids","6":"male","7":"1"},{"1":"Officer","2":"7","3":"AirForce","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"7","3":"AirForce","4":"married","5":"military","6":"male","7":"5"},{"1":"Officer","2":"7","3":"AirForce","4":"married","5":"military","6":"female","7":"5"},{"1":"Officer","2":"7","3":"AirForce","4":"married","5":"civilian","6":"male","7":"131"},{"1":"Officer","2":"7","3":"AirForce","4":"married","5":"civilian","6":"female","7":"5"},{"1":"Officer","2":"8","3":"AirForce","4":"single","5":"nokids","6":"male","7":"1"},{"1":"Officer","2":"8","3":"AirForce","4":"single","5":"nokids","6":"female","7":"3"},{"1":"Officer","2":"8","3":"AirForce","4":"single","5":"kids","6":"male","7":"0"},{"1":"Officer","2":"8","3":"AirForce","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"8","3":"AirForce","4":"married","5":"military","6":"male","7":"4"},{"1":"Officer","2":"8","3":"AirForce","4":"married","5":"military","6":"female","7":"1"},{"1":"Officer","2":"8","3":"AirForce","4":"married","5":"civilian","6":"male","7":"86"},{"1":"Officer","2":"8","3":"AirForce","4":"married","5":"civilian","6":"female","7":"7"},{"1":"Officer","2":"9","3":"AirForce","4":"single","5":"nokids","6":"male","7":"0"},{"1":"Officer","2":"9","3":"AirForce","4":"single","5":"nokids","6":"female","7":"0"},{"1":"Officer","2":"9","3":"AirForce","4":"single","5":"kids","6":"male","7":"0"},{"1":"Officer","2":"9","3":"AirForce","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"9","3":"AirForce","4":"married","5":"military","6":"male","7":"1"},{"1":"Officer","2":"9","3":"AirForce","4":"married","5":"military","6":"female","7":"0"},{"1":"Officer","2":"9","3":"AirForce","4":"married","5":"civilian","6":"male","7":"35"},{"1":"Officer","2":"9","3":"AirForce","4":"married","5":"civilian","6":"female","7":"1"},{"1":"Officer","2":"10","3":"AirForce","4":"single","5":"nokids","6":"male","7":"0"},{"1":"Officer","2":"10","3":"AirForce","4":"single","5":"nokids","6":"female","7":"0"},{"1":"Officer","2":"10","3":"AirForce","4":"single","5":"kids","6":"male","7":"0"},{"1":"Officer","2":"10","3":"AirForce","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"10","3":"AirForce","4":"married","5":"military","6":"male","7":"1"},{"1":"Officer","2":"10","3":"AirForce","4":"married","5":"military","6":"female","7":"0"},{"1":"Officer","2":"10","3":"AirForce","4":"married","5":"civilian","6":"male","7":"12"},{"1":"Officer","2":"10","3":"AirForce","4":"married","5":"civilian","6":"female","7":"0"},{"1":"Enlisted","2":"1","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"6232"},{"1":"Enlisted","2":"1","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"583"},{"1":"Enlisted","2":"1","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"54"},{"1":"Enlisted","2":"1","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"3"},{"1":"Enlisted","2":"1","3":"MarineCorps","4":"married","5":"military","6":"male","7":"20"},{"1":"Enlisted","2":"1","3":"MarineCorps","4":"married","5":"military","6":"female","7":"19"},{"1":"Enlisted","2":"1","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"611"},{"1":"Enlisted","2":"1","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"21"},{"1":"Enlisted","2":"2","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"15916"},{"1":"Enlisted","2":"2","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"1336"},{"1":"Enlisted","2":"2","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"190"},{"1":"Enlisted","2":"2","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"12"},{"1":"Enlisted","2":"2","3":"MarineCorps","4":"married","5":"military","6":"male","7":"98"},{"1":"Enlisted","2":"2","3":"MarineCorps","4":"married","5":"military","6":"female","7":"109"},{"1":"Enlisted","2":"2","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"2399"},{"1":"Enlisted","2":"2","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"96"},{"1":"Enlisted","2":"3","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"34868"},{"1":"Enlisted","2":"3","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"1864"},{"1":"Enlisted","2":"3","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"574"},{"1":"Enlisted","2":"3","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"167"},{"1":"Enlisted","2":"3","3":"MarineCorps","4":"married","5":"military","6":"male","7":"780"},{"1":"Enlisted","2":"3","3":"MarineCorps","4":"married","5":"military","6":"female","7":"928"},{"1":"Enlisted","2":"3","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"14643"},{"1":"Enlisted","2":"3","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"344"},{"1":"Enlisted","2":"4","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"17862"},{"1":"Enlisted","2":"4","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"1026"},{"1":"Enlisted","2":"4","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"527"},{"1":"Enlisted","2":"4","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"272"},{"1":"Enlisted","2":"4","3":"MarineCorps","4":"married","5":"military","6":"male","7":"1070"},{"1":"Enlisted","2":"4","3":"MarineCorps","4":"married","5":"military","6":"female","7":"944"},{"1":"Enlisted","2":"4","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"15599"},{"1":"Enlisted","2":"4","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"414"},{"1":"Enlisted","2":"5","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"7490"},{"1":"Enlisted","2":"5","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"590"},{"1":"Enlisted","2":"5","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"931"},{"1":"Enlisted","2":"5","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"338"},{"1":"Enlisted","2":"5","3":"MarineCorps","4":"married","5":"military","6":"male","7":"1199"},{"1":"Enlisted","2":"5","3":"MarineCorps","4":"married","5":"military","6":"female","7":"730"},{"1":"Enlisted","2":"5","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"17921"},{"1":"Enlisted","2":"5","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"344"},{"1":"Enlisted","2":"6","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"2051"},{"1":"Enlisted","2":"6","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"208"},{"1":"Enlisted","2":"6","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"1060"},{"1":"Enlisted","2":"6","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"226"},{"1":"Enlisted","2":"6","3":"MarineCorps","4":"married","5":"military","6":"male","7":"568"},{"1":"Enlisted","2":"6","3":"MarineCorps","4":"married","5":"military","6":"female","7":"341"},{"1":"Enlisted","2":"6","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"12005"},{"1":"Enlisted","2":"6","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"221"},{"1":"Enlisted","2":"7","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"565"},{"1":"Enlisted","2":"7","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"72"},{"1":"Enlisted","2":"7","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"622"},{"1":"Enlisted","2":"7","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"119"},{"1":"Enlisted","2":"7","3":"MarineCorps","4":"married","5":"military","6":"male","7":"308"},{"1":"Enlisted","2":"7","3":"MarineCorps","4":"married","5":"military","6":"female","7":"185"},{"1":"Enlisted","2":"7","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"6970"},{"1":"Enlisted","2":"7","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"120"},{"1":"Enlisted","2":"8","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"148"},{"1":"Enlisted","2":"8","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"21"},{"1":"Enlisted","2":"8","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"270"},{"1":"Enlisted","2":"8","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"42"},{"1":"Enlisted","2":"8","3":"MarineCorps","4":"married","5":"military","6":"male","7":"115"},{"1":"Enlisted","2":"8","3":"MarineCorps","4":"married","5":"military","6":"female","7":"66"},{"1":"Enlisted","2":"8","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"3268"},{"1":"Enlisted","2":"8","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"73"},{"1":"Enlisted","2":"9","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"68"},{"1":"Enlisted","2":"9","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"10"},{"1":"Enlisted","2":"9","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"106"},{"1":"Enlisted","2":"9","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"20"},{"1":"Enlisted","2":"9","3":"MarineCorps","4":"married","5":"military","6":"male","7":"42"},{"1":"Enlisted","2":"9","3":"MarineCorps","4":"married","5":"military","6":"female","7":"10"},{"1":"Enlisted","2":"9","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"1340"},{"1":"Enlisted","2":"9","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"21"},{"1":"Officer","2":"1","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"2227"},{"1":"Officer","2":"1","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"204"},{"1":"Officer","2":"1","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"26"},{"1":"Officer","2":"1","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"5"},{"1":"Officer","2":"1","3":"MarineCorps","4":"married","5":"military","6":"male","7":"35"},{"1":"Officer","2":"1","3":"MarineCorps","4":"married","5":"military","6":"female","7":"53"},{"1":"Officer","2":"1","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"1006"},{"1":"Officer","2":"1","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"23"},{"1":"Officer","2":"2","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"1509"},{"1":"Officer","2":"2","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"133"},{"1":"Officer","2":"2","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"29"},{"1":"Officer","2":"2","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"8"},{"1":"Officer","2":"2","3":"MarineCorps","4":"married","5":"military","6":"male","7":"81"},{"1":"Officer","2":"2","3":"MarineCorps","4":"married","5":"military","6":"female","7":"53"},{"1":"Officer","2":"2","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"1330"},{"1":"Officer","2":"2","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"20"},{"1":"Officer","2":"3","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"1510"},{"1":"Officer","2":"3","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"200"},{"1":"Officer","2":"3","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"110"},{"1":"Officer","2":"3","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"14"},{"1":"Officer","2":"3","3":"MarineCorps","4":"married","5":"military","6":"male","7":"189"},{"1":"Officer","2":"3","3":"MarineCorps","4":"married","5":"military","6":"female","7":"133"},{"1":"Officer","2":"3","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"3892"},{"1":"Officer","2":"3","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"52"},{"1":"Officer","2":"4","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"319"},{"1":"Officer","2":"4","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"62"},{"1":"Officer","2":"4","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"127"},{"1":"Officer","2":"4","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"12"},{"1":"Officer","2":"4","3":"MarineCorps","4":"married","5":"military","6":"male","7":"93"},{"1":"Officer","2":"4","3":"MarineCorps","4":"married","5":"military","6":"female","7":"42"},{"1":"Officer","2":"4","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"3121"},{"1":"Officer","2":"4","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"48"},{"1":"Officer","2":"5","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"76"},{"1":"Officer","2":"5","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"7"},{"1":"Officer","2":"5","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"55"},{"1":"Officer","2":"5","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"2"},{"1":"Officer","2":"5","3":"MarineCorps","4":"married","5":"military","6":"male","7":"37"},{"1":"Officer","2":"5","3":"MarineCorps","4":"married","5":"military","6":"female","7":"10"},{"1":"Officer","2":"5","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"1704"},{"1":"Officer","2":"5","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"20"},{"1":"Officer","2":"6","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"23"},{"1":"Officer","2":"6","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"7"},{"1":"Officer","2":"6","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"17"},{"1":"Officer","2":"6","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"1"},{"1":"Officer","2":"6","3":"MarineCorps","4":"married","5":"military","6":"male","7":"10"},{"1":"Officer","2":"6","3":"MarineCorps","4":"married","5":"military","6":"female","7":"2"},{"1":"Officer","2":"6","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"623"},{"1":"Officer","2":"6","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"12"},{"1":"Officer","2":"7","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"2"},{"1":"Officer","2":"7","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"1"},{"1":"Officer","2":"7","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"1"},{"1":"Officer","2":"7","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"7","3":"MarineCorps","4":"married","5":"military","6":"male","7":"1"},{"1":"Officer","2":"7","3":"MarineCorps","4":"married","5":"military","6":"female","7":"0"},{"1":"Officer","2":"7","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"36"},{"1":"Officer","2":"7","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"0"},{"1":"Officer","2":"8","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"0"},{"1":"Officer","2":"8","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"0"},{"1":"Officer","2":"8","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"0"},{"1":"Officer","2":"8","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"8","3":"MarineCorps","4":"married","5":"military","6":"male","7":"0"},{"1":"Officer","2":"8","3":"MarineCorps","4":"married","5":"military","6":"female","7":"0"},{"1":"Officer","2":"8","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"23"},{"1":"Officer","2":"8","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"1"},{"1":"Officer","2":"9","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"0"},{"1":"Officer","2":"9","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"0"},{"1":"Officer","2":"9","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"0"},{"1":"Officer","2":"9","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"9","3":"MarineCorps","4":"married","5":"military","6":"male","7":"0"},{"1":"Officer","2":"9","3":"MarineCorps","4":"married","5":"military","6":"female","7":"0"},{"1":"Officer","2":"9","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"16"},{"1":"Officer","2":"9","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"0"},{"1":"Officer","2":"10","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"1"},{"1":"Officer","2":"10","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"0"},{"1":"Officer","2":"10","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"0"},{"1":"Officer","2":"10","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"10","3":"MarineCorps","4":"married","5":"military","6":"male","7":"0"},{"1":"Officer","2":"10","3":"MarineCorps","4":"married","5":"military","6":"female","7":"0"},{"1":"Officer","2":"10","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"3"},{"1":"Officer","2":"10","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"0"},{"1":"Warrant Officer","2":"1","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"26"},{"1":"Warrant Officer","2":"1","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"3"},{"1":"Warrant Officer","2":"1","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"20"},{"1":"Warrant Officer","2":"1","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"7"},{"1":"Warrant Officer","2":"1","3":"MarineCorps","4":"married","5":"military","6":"male","7":"25"},{"1":"Warrant Officer","2":"1","3":"MarineCorps","4":"married","5":"military","6":"female","7":"12"},{"1":"Warrant Officer","2":"1","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"386"},{"1":"Warrant Officer","2":"1","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"5"},{"1":"Warrant Officer","2":"2","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"30"},{"1":"Warrant Officer","2":"2","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"3"},{"1":"Warrant Officer","2":"2","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"38"},{"1":"Warrant Officer","2":"2","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"2"},{"1":"Warrant Officer","2":"2","3":"MarineCorps","4":"married","5":"military","6":"male","7":"26"},{"1":"Warrant Officer","2":"2","3":"MarineCorps","4":"married","5":"military","6":"female","7":"17"},{"1":"Warrant Officer","2":"2","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"607"},{"1":"Warrant Officer","2":"2","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"6"},{"1":"Warrant Officer","2":"3","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"17"},{"1":"Warrant Officer","2":"3","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"5"},{"1":"Warrant Officer","2":"3","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"30"},{"1":"Warrant Officer","2":"3","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"10"},{"1":"Warrant Officer","2":"3","3":"MarineCorps","4":"married","5":"military","6":"male","7":"16"},{"1":"Warrant Officer","2":"3","3":"MarineCorps","4":"married","5":"military","6":"female","7":"16"},{"1":"Warrant Officer","2":"3","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"390"},{"1":"Warrant Officer","2":"3","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"12"},{"1":"Warrant Officer","2":"4","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"6"},{"1":"Warrant Officer","2":"4","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"0"},{"1":"Warrant Officer","2":"4","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"17"},{"1":"Warrant Officer","2":"4","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"2"},{"1":"Warrant Officer","2":"4","3":"MarineCorps","4":"married","5":"military","6":"male","7":"6"},{"1":"Warrant Officer","2":"4","3":"MarineCorps","4":"married","5":"military","6":"female","7":"5"},{"1":"Warrant Officer","2":"4","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"250"},{"1":"Warrant Officer","2":"4","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"3"},{"1":"Warrant Officer","2":"5","3":"MarineCorps","4":"single","5":"nokids","6":"male","7":"3"},{"1":"Warrant Officer","2":"5","3":"MarineCorps","4":"single","5":"nokids","6":"female","7":"3"},{"1":"Warrant Officer","2":"5","3":"MarineCorps","4":"single","5":"kids","6":"male","7":"3"},{"1":"Warrant Officer","2":"5","3":"MarineCorps","4":"single","5":"kids","6":"female","7":"1"},{"1":"Warrant Officer","2":"5","3":"MarineCorps","4":"married","5":"military","6":"male","7":"0"},{"1":"Warrant Officer","2":"5","3":"MarineCorps","4":"married","5":"military","6":"female","7":"1"},{"1":"Warrant Officer","2":"5","3":"MarineCorps","4":"married","5":"civilian","6":"male","7":"90"},{"1":"Warrant Officer","2":"5","3":"MarineCorps","4":"married","5":"civilian","6":"female","7":"2"},{"1":"Enlisted","2":"1","3":"Navy","4":"single","5":"nokids","6":"male","7":"7820"},{"1":"Enlisted","2":"1","3":"Navy","4":"single","5":"nokids","6":"female","7":"2275"},{"1":"Enlisted","2":"1","3":"Navy","4":"single","5":"kids","6":"male","7":"117"},{"1":"Enlisted","2":"1","3":"Navy","4":"single","5":"kids","6":"female","7":"34"},{"1":"Enlisted","2":"1","3":"Navy","4":"married","5":"military","6":"male","7":"30"},{"1":"Enlisted","2":"1","3":"Navy","4":"married","5":"military","6":"female","7":"57"},{"1":"Enlisted","2":"1","3":"Navy","4":"married","5":"civilian","6":"male","7":"806"},{"1":"Enlisted","2":"1","3":"Navy","4":"married","5":"civilian","6":"female","7":"162"},{"1":"Enlisted","2":"2","3":"Navy","4":"single","5":"nokids","6":"male","7":"11198"},{"1":"Enlisted","2":"2","3":"Navy","4":"single","5":"nokids","6":"female","7":"2718"},{"1":"Enlisted","2":"2","3":"Navy","4":"single","5":"kids","6":"male","7":"237"},{"1":"Enlisted","2":"2","3":"Navy","4":"single","5":"kids","6":"female","7":"87"},{"1":"Enlisted","2":"2","3":"Navy","4":"married","5":"military","6":"male","7":"113"},{"1":"Enlisted","2":"2","3":"Navy","4":"married","5":"military","6":"female","7":"164"},{"1":"Enlisted","2":"2","3":"Navy","4":"married","5":"civilian","6":"male","7":"2474"},{"1":"Enlisted","2":"2","3":"Navy","4":"married","5":"civilian","6":"female","7":"388"},{"1":"Enlisted","2":"3","3":"Navy","4":"single","5":"nokids","6":"male","7":"28163"},{"1":"Enlisted","2":"3","3":"Navy","4":"single","5":"nokids","6":"female","7":"6396"},{"1":"Enlisted","2":"3","3":"Navy","4":"single","5":"kids","6":"male","7":"681"},{"1":"Enlisted","2":"3","3":"Navy","4":"single","5":"kids","6":"female","7":"788"},{"1":"Enlisted","2":"3","3":"Navy","4":"married","5":"military","6":"male","7":"861"},{"1":"Enlisted","2":"3","3":"Navy","4":"married","5":"military","6":"female","7":"1288"},{"1":"Enlisted","2":"3","3":"Navy","4":"married","5":"civilian","6":"male","7":"11297"},{"1":"Enlisted","2":"3","3":"Navy","4":"married","5":"civilian","6":"female","7":"1791"},{"1":"Enlisted","2":"4","3":"Navy","4":"single","5":"nokids","6":"male","7":"23285"},{"1":"Enlisted","2":"4","3":"Navy","4":"single","5":"nokids","6":"female","7":"4266"},{"1":"Enlisted","2":"4","3":"Navy","4":"single","5":"kids","6":"male","7":"967"},{"1":"Enlisted","2":"4","3":"Navy","4":"single","5":"kids","6":"female","7":"949"},{"1":"Enlisted","2":"4","3":"Navy","4":"married","5":"military","6":"male","7":"1526"},{"1":"Enlisted","2":"4","3":"Navy","4":"married","5":"military","6":"female","7":"1691"},{"1":"Enlisted","2":"4","3":"Navy","4":"married","5":"civilian","6":"male","7":"16277"},{"1":"Enlisted","2":"4","3":"Navy","4":"married","5":"civilian","6":"female","7":"1768"},{"1":"Enlisted","2":"5","3":"Navy","4":"single","5":"nokids","6":"male","7":"18856"},{"1":"Enlisted","2":"5","3":"Navy","4":"single","5":"nokids","6":"female","7":"3649"},{"1":"Enlisted","2":"5","3":"Navy","4":"single","5":"kids","6":"male","7":"2837"},{"1":"Enlisted","2":"5","3":"Navy","4":"single","5":"kids","6":"female","7":"1787"},{"1":"Enlisted","2":"5","3":"Navy","4":"married","5":"military","6":"male","7":"2191"},{"1":"Enlisted","2":"5","3":"Navy","4":"married","5":"military","6":"female","7":"2099"},{"1":"Enlisted","2":"5","3":"Navy","4":"married","5":"civilian","6":"male","7":"31491"},{"1":"Enlisted","2":"5","3":"Navy","4":"married","5":"civilian","6":"female","7":"2272"},{"1":"Enlisted","2":"6","3":"Navy","4":"single","5":"nokids","6":"male","7":"5917"},{"1":"Enlisted","2":"6","3":"Navy","4":"single","5":"nokids","6":"female","7":"1429"},{"1":"Enlisted","2":"6","3":"Navy","4":"single","5":"kids","6":"male","7":"2725"},{"1":"Enlisted","2":"6","3":"Navy","4":"single","5":"kids","6":"female","7":"1284"},{"1":"Enlisted","2":"6","3":"Navy","4":"married","5":"military","6":"male","7":"1654"},{"1":"Enlisted","2":"6","3":"Navy","4":"married","5":"military","6":"female","7":"1461"},{"1":"Enlisted","2":"6","3":"Navy","4":"married","5":"civilian","6":"male","7":"30404"},{"1":"Enlisted","2":"6","3":"Navy","4":"married","5":"civilian","6":"female","7":"1561"},{"1":"Enlisted","2":"7","3":"Navy","4":"single","5":"nokids","6":"male","7":"1294"},{"1":"Enlisted","2":"7","3":"Navy","4":"single","5":"nokids","6":"female","7":"395"},{"1":"Enlisted","2":"7","3":"Navy","4":"single","5":"kids","6":"male","7":"1371"},{"1":"Enlisted","2":"7","3":"Navy","4":"single","5":"kids","6":"female","7":"382"},{"1":"Enlisted","2":"7","3":"Navy","4":"married","5":"military","6":"male","7":"759"},{"1":"Enlisted","2":"7","3":"Navy","4":"married","5":"military","6":"female","7":"506"},{"1":"Enlisted","2":"7","3":"Navy","4":"married","5":"civilian","6":"male","7":"16449"},{"1":"Enlisted","2":"7","3":"Navy","4":"married","5":"civilian","6":"female","7":"527"},{"1":"Enlisted","2":"8","3":"Navy","4":"single","5":"nokids","6":"male","7":"219"},{"1":"Enlisted","2":"8","3":"Navy","4":"single","5":"nokids","6":"female","7":"84"},{"1":"Enlisted","2":"8","3":"Navy","4":"single","5":"kids","6":"male","7":"329"},{"1":"Enlisted","2":"8","3":"Navy","4":"single","5":"kids","6":"female","7":"70"},{"1":"Enlisted","2":"8","3":"Navy","4":"married","5":"military","6":"male","7":"186"},{"1":"Enlisted","2":"8","3":"Navy","4":"married","5":"military","6":"female","7":"66"},{"1":"Enlisted","2":"8","3":"Navy","4":"married","5":"civilian","6":"male","7":"4935"},{"1":"Enlisted","2":"8","3":"Navy","4":"married","5":"civilian","6":"female","7":"146"},{"1":"Enlisted","2":"9","3":"Navy","4":"single","5":"nokids","6":"male","7":"96"},{"1":"Enlisted","2":"9","3":"Navy","4":"single","5":"nokids","6":"female","7":"56"},{"1":"Enlisted","2":"9","3":"Navy","4":"single","5":"kids","6":"male","7":"118"},{"1":"Enlisted","2":"9","3":"Navy","4":"single","5":"kids","6":"female","7":"21"},{"1":"Enlisted","2":"9","3":"Navy","4":"married","5":"military","6":"male","7":"54"},{"1":"Enlisted","2":"9","3":"Navy","4":"married","5":"military","6":"female","7":"16"},{"1":"Enlisted","2":"9","3":"Navy","4":"married","5":"civilian","6":"male","7":"2171"},{"1":"Enlisted","2":"9","3":"Navy","4":"married","5":"civilian","6":"female","7":"57"},{"1":"Officer","2":"1","3":"Navy","4":"single","5":"nokids","6":"male","7":"3529"},{"1":"Officer","2":"1","3":"Navy","4":"single","5":"nokids","6":"female","7":"911"},{"1":"Officer","2":"1","3":"Navy","4":"single","5":"kids","6":"male","7":"83"},{"1":"Officer","2":"1","3":"Navy","4":"single","5":"kids","6":"female","7":"50"},{"1":"Officer","2":"1","3":"Navy","4":"married","5":"military","6":"male","7":"108"},{"1":"Officer","2":"1","3":"Navy","4":"married","5":"military","6":"female","7":"158"},{"1":"Officer","2":"1","3":"Navy","4":"married","5":"civilian","6":"male","7":"1864"},{"1":"Officer","2":"1","3":"Navy","4":"married","5":"civilian","6":"female","7":"201"},{"1":"Officer","2":"2","3":"Navy","4":"single","5":"nokids","6":"male","7":"2358"},{"1":"Officer","2":"2","3":"Navy","4":"single","5":"nokids","6":"female","7":"664"},{"1":"Officer","2":"2","3":"Navy","4":"single","5":"kids","6":"male","7":"98"},{"1":"Officer","2":"2","3":"Navy","4":"single","5":"kids","6":"female","7":"54"},{"1":"Officer","2":"2","3":"Navy","4":"married","5":"military","6":"male","7":"163"},{"1":"Officer","2":"2","3":"Navy","4":"married","5":"military","6":"female","7":"220"},{"1":"Officer","2":"2","3":"Navy","4":"married","5":"civilian","6":"male","7":"2519"},{"1":"Officer","2":"2","3":"Navy","4":"married","5":"civilian","6":"female","7":"263"},{"1":"Officer","2":"3","3":"Navy","4":"single","5":"nokids","6":"male","7":"3263"},{"1":"Officer","2":"3","3":"Navy","4":"single","5":"nokids","6":"female","7":"1177"},{"1":"Officer","2":"3","3":"Navy","4":"single","5":"kids","6":"male","7":"338"},{"1":"Officer","2":"3","3":"Navy","4":"single","5":"kids","6":"female","7":"158"},{"1":"Officer","2":"3","3":"Navy","4":"married","5":"military","6":"male","7":"450"},{"1":"Officer","2":"3","3":"Navy","4":"married","5":"military","6":"female","7":"556"},{"1":"Officer","2":"3","3":"Navy","4":"married","5":"civilian","6":"male","7":"9436"},{"1":"Officer","2":"3","3":"Navy","4":"married","5":"civilian","6":"female","7":"806"},{"1":"Officer","2":"4","3":"Navy","4":"single","5":"nokids","6":"male","7":"862"},{"1":"Officer","2":"4","3":"Navy","4":"single","5":"nokids","6":"female","7":"380"},{"1":"Officer","2":"4","3":"Navy","4":"single","5":"kids","6":"male","7":"274"},{"1":"Officer","2":"4","3":"Navy","4":"single","5":"kids","6":"female","7":"108"},{"1":"Officer","2":"4","3":"Navy","4":"married","5":"military","6":"male","7":"282"},{"1":"Officer","2":"4","3":"Navy","4":"married","5":"military","6":"female","7":"310"},{"1":"Officer","2":"4","3":"Navy","4":"married","5":"civilian","6":"male","7":"7413"},{"1":"Officer","2":"4","3":"Navy","4":"married","5":"civilian","6":"female","7":"569"},{"1":"Officer","2":"5","3":"Navy","4":"single","5":"nokids","6":"male","7":"344"},{"1":"Officer","2":"5","3":"Navy","4":"single","5":"nokids","6":"female","7":"209"},{"1":"Officer","2":"5","3":"Navy","4":"single","5":"kids","6":"male","7":"168"},{"1":"Officer","2":"5","3":"Navy","4":"single","5":"kids","6":"female","7":"43"},{"1":"Officer","2":"5","3":"Navy","4":"married","5":"military","6":"male","7":"147"},{"1":"Officer","2":"5","3":"Navy","4":"married","5":"military","6":"female","7":"179"},{"1":"Officer","2":"5","3":"Navy","4":"married","5":"civilian","6":"male","7":"5395"},{"1":"Officer","2":"5","3":"Navy","4":"married","5":"civilian","6":"female","7":"415"},{"1":"Officer","2":"6","3":"Navy","4":"single","5":"nokids","6":"male","7":"99"},{"1":"Officer","2":"6","3":"Navy","4":"single","5":"nokids","6":"female","7":"112"},{"1":"Officer","2":"6","3":"Navy","4":"single","5":"kids","6":"male","7":"74"},{"1":"Officer","2":"6","3":"Navy","4":"single","5":"kids","6":"female","7":"31"},{"1":"Officer","2":"6","3":"Navy","4":"married","5":"military","6":"male","7":"58"},{"1":"Officer","2":"6","3":"Navy","4":"married","5":"military","6":"female","7":"48"},{"1":"Officer","2":"6","3":"Navy","4":"married","5":"civilian","6":"male","7":"2700"},{"1":"Officer","2":"6","3":"Navy","4":"married","5":"civilian","6":"female","7":"215"},{"1":"Officer","2":"7","3":"Navy","4":"single","5":"nokids","6":"male","7":"1"},{"1":"Officer","2":"7","3":"Navy","4":"single","5":"nokids","6":"female","7":"0"},{"1":"Officer","2":"7","3":"Navy","4":"single","5":"kids","6":"male","7":"2"},{"1":"Officer","2":"7","3":"Navy","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"7","3":"Navy","4":"married","5":"military","6":"male","7":"1"},{"1":"Officer","2":"7","3":"Navy","4":"married","5":"military","6":"female","7":"0"},{"1":"Officer","2":"7","3":"Navy","4":"married","5":"civilian","6":"male","7":"107"},{"1":"Officer","2":"7","3":"Navy","4":"married","5":"civilian","6":"female","7":"9"},{"1":"Officer","2":"8","3":"Navy","4":"single","5":"nokids","6":"male","7":"2"},{"1":"Officer","2":"8","3":"Navy","4":"single","5":"nokids","6":"female","7":"3"},{"1":"Officer","2":"8","3":"Navy","4":"single","5":"kids","6":"male","7":"0"},{"1":"Officer","2":"8","3":"Navy","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"8","3":"Navy","4":"married","5":"military","6":"male","7":"1"},{"1":"Officer","2":"8","3":"Navy","4":"married","5":"military","6":"female","7":"0"},{"1":"Officer","2":"8","3":"Navy","4":"married","5":"civilian","6":"male","7":"64"},{"1":"Officer","2":"8","3":"Navy","4":"married","5":"civilian","6":"female","7":"4"},{"1":"Officer","2":"9","3":"Navy","4":"single","5":"nokids","6":"male","7":"0"},{"1":"Officer","2":"9","3":"Navy","4":"single","5":"nokids","6":"female","7":"1"},{"1":"Officer","2":"9","3":"Navy","4":"single","5":"kids","6":"male","7":"1"},{"1":"Officer","2":"9","3":"Navy","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"9","3":"Navy","4":"married","5":"military","6":"male","7":"0"},{"1":"Officer","2":"9","3":"Navy","4":"married","5":"military","6":"female","7":"0"},{"1":"Officer","2":"9","3":"Navy","4":"married","5":"civilian","6":"male","7":"41"},{"1":"Officer","2":"9","3":"Navy","4":"married","5":"civilian","6":"female","7":"0"},{"1":"Officer","2":"10","3":"Navy","4":"single","5":"nokids","6":"male","7":"0"},{"1":"Officer","2":"10","3":"Navy","4":"single","5":"nokids","6":"female","7":"0"},{"1":"Officer","2":"10","3":"Navy","4":"single","5":"kids","6":"male","7":"0"},{"1":"Officer","2":"10","3":"Navy","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"10","3":"Navy","4":"married","5":"military","6":"male","7":"0"},{"1":"Officer","2":"10","3":"Navy","4":"married","5":"military","6":"female","7":"0"},{"1":"Officer","2":"10","3":"Navy","4":"married","5":"civilian","6":"male","7":"10"},{"1":"Officer","2":"10","3":"Navy","4":"married","5":"civilian","6":"female","7":"0"},{"1":"Warrant Officer","2":"2","3":"Navy","4":"single","5":"nokids","6":"male","7":"19"},{"1":"Warrant Officer","2":"2","3":"Navy","4":"single","5":"nokids","6":"female","7":"10"},{"1":"Warrant Officer","2":"2","3":"Navy","4":"single","5":"kids","6":"male","7":"27"},{"1":"Warrant Officer","2":"2","3":"Navy","4":"single","5":"kids","6":"female","7":"4"},{"1":"Warrant Officer","2":"2","3":"Navy","4":"married","5":"military","6":"male","7":"22"},{"1":"Warrant Officer","2":"2","3":"Navy","4":"married","5":"military","6":"female","7":"6"},{"1":"Warrant Officer","2":"2","3":"Navy","4":"married","5":"civilian","6":"male","7":"418"},{"1":"Warrant Officer","2":"2","3":"Navy","4":"married","5":"civilian","6":"female","7":"6"},{"1":"Warrant Officer","2":"3","3":"Navy","4":"single","5":"nokids","6":"male","7":"13"},{"1":"Warrant Officer","2":"3","3":"Navy","4":"single","5":"nokids","6":"female","7":"14"},{"1":"Warrant Officer","2":"3","3":"Navy","4":"single","5":"kids","6":"male","7":"33"},{"1":"Warrant Officer","2":"3","3":"Navy","4":"single","5":"kids","6":"female","7":"6"},{"1":"Warrant Officer","2":"3","3":"Navy","4":"married","5":"military","6":"male","7":"21"},{"1":"Warrant Officer","2":"3","3":"Navy","4":"married","5":"military","6":"female","7":"6"},{"1":"Warrant Officer","2":"3","3":"Navy","4":"married","5":"civilian","6":"male","7":"578"},{"1":"Warrant Officer","2":"3","3":"Navy","4":"married","5":"civilian","6":"female","7":"10"},{"1":"Warrant Officer","2":"4","3":"Navy","4":"single","5":"nokids","6":"male","7":"9"},{"1":"Warrant Officer","2":"4","3":"Navy","4":"single","5":"nokids","6":"female","7":"8"},{"1":"Warrant Officer","2":"4","3":"Navy","4":"single","5":"kids","6":"male","7":"25"},{"1":"Warrant Officer","2":"4","3":"Navy","4":"single","5":"kids","6":"female","7":"3"},{"1":"Warrant Officer","2":"4","3":"Navy","4":"married","5":"military","6":"male","7":"11"},{"1":"Warrant Officer","2":"4","3":"Navy","4":"married","5":"military","6":"female","7":"1"},{"1":"Warrant Officer","2":"4","3":"Navy","4":"married","5":"civilian","6":"male","7":"350"},{"1":"Warrant Officer","2":"4","3":"Navy","4":"married","5":"civilian","6":"female","7":"4"},{"1":"Warrant Officer","2":"5","3":"Navy","4":"single","5":"nokids","6":"male","7":"2"},{"1":"Warrant Officer","2":"5","3":"Navy","4":"single","5":"nokids","6":"female","7":"0"},{"1":"Warrant Officer","2":"5","3":"Navy","4":"single","5":"kids","6":"male","7":"1"},{"1":"Warrant Officer","2":"5","3":"Navy","4":"single","5":"kids","6":"female","7":"0"},{"1":"Warrant Officer","2":"5","3":"Navy","4":"married","5":"military","6":"male","7":"0"},{"1":"Warrant Officer","2":"5","3":"Navy","4":"married","5":"military","6":"female","7":"0"},{"1":"Warrant Officer","2":"5","3":"Navy","4":"married","5":"civilian","6":"male","7":"56"},{"1":"Warrant Officer","2":"5","3":"Navy","4":"married","5":"civilian","6":"female","7":"1"},{"1":"Enlisted","2":"1","3":"Army","4":"single","5":"nokids","6":"male","7":"9456"},{"1":"Enlisted","2":"1","3":"Army","4":"single","5":"nokids","6":"female","7":"1309"},{"1":"Enlisted","2":"1","3":"Army","4":"single","5":"kids","6":"male","7":"365"},{"1":"Enlisted","2":"1","3":"Army","4":"single","5":"kids","6":"female","7":"80"},{"1":"Enlisted","2":"1","3":"Army","4":"married","5":"military","6":"male","7":"40"},{"1":"Enlisted","2":"1","3":"Army","4":"married","5":"military","6":"female","7":"38"},{"1":"Enlisted","2":"1","3":"Army","4":"married","5":"civilian","6":"male","7":"2579"},{"1":"Enlisted","2":"1","3":"Army","4":"married","5":"civilian","6":"female","7":"358"},{"1":"Enlisted","2":"2","3":"Army","4":"single","5":"nokids","6":"male","7":"21600"},{"1":"Enlisted","2":"2","3":"Army","4":"single","5":"nokids","6":"female","7":"3324"},{"1":"Enlisted","2":"2","3":"Army","4":"single","5":"kids","6":"male","7":"997"},{"1":"Enlisted","2":"2","3":"Army","4":"single","5":"kids","6":"female","7":"167"},{"1":"Enlisted","2":"2","3":"Army","4":"married","5":"military","6":"male","7":"130"},{"1":"Enlisted","2":"2","3":"Army","4":"married","5":"military","6":"female","7":"201"},{"1":"Enlisted","2":"2","3":"Army","4":"married","5":"civilian","6":"male","7":"6808"},{"1":"Enlisted","2":"2","3":"Army","4":"married","5":"civilian","6":"female","7":"1035"},{"1":"Enlisted","2":"3","3":"Army","4":"single","5":"nokids","6":"male","7":"38335"},{"1":"Enlisted","2":"3","3":"Army","4":"single","5":"nokids","6":"female","7":"5651"},{"1":"Enlisted","2":"3","3":"Army","4":"single","5":"kids","6":"male","7":"2613"},{"1":"Enlisted","2":"3","3":"Army","4":"single","5":"kids","6":"female","7":"699"},{"1":"Enlisted","2":"3","3":"Army","4":"married","5":"military","6":"male","7":"680"},{"1":"Enlisted","2":"3","3":"Army","4":"married","5":"military","6":"female","7":"999"},{"1":"Enlisted","2":"3","3":"Army","4":"married","5":"civilian","6":"male","7":"18419"},{"1":"Enlisted","2":"3","3":"Army","4":"married","5":"civilian","6":"female","7":"2875"},{"1":"Enlisted","2":"4","3":"Army","4":"single","5":"nokids","6":"male","7":"50758"},{"1":"Enlisted","2":"4","3":"Army","4":"single","5":"nokids","6":"female","7":"6333"},{"1":"Enlisted","2":"4","3":"Army","4":"single","5":"kids","6":"male","7":"7010"},{"1":"Enlisted","2":"4","3":"Army","4":"single","5":"kids","6":"female","7":"2599"},{"1":"Enlisted","2":"4","3":"Army","4":"married","5":"military","6":"male","7":"3029"},{"1":"Enlisted","2":"4","3":"Army","4":"married","5":"military","6":"female","7":"3936"},{"1":"Enlisted","2":"4","3":"Army","4":"married","5":"civilian","6":"male","7":"58317"},{"1":"Enlisted","2":"4","3":"Army","4":"married","5":"civilian","6":"female","7":"6010"},{"1":"Enlisted","2":"5","3":"Army","4":"single","5":"nokids","6":"male","7":"17020"},{"1":"Enlisted","2":"5","3":"Army","4":"single","5":"nokids","6":"female","7":"2678"},{"1":"Enlisted","2":"5","3":"Army","4":"single","5":"kids","6":"male","7":"4414"},{"1":"Enlisted","2":"5","3":"Army","4":"single","5":"kids","6":"female","7":"2280"},{"1":"Enlisted","2":"5","3":"Army","4":"married","5":"military","6":"male","7":"2915"},{"1":"Enlisted","2":"5","3":"Army","4":"married","5":"military","6":"female","7":"2769"},{"1":"Enlisted","2":"5","3":"Army","4":"married","5":"civilian","6":"male","7":"49821"},{"1":"Enlisted","2":"5","3":"Army","4":"married","5":"civilian","6":"female","7":"3087"},{"1":"Enlisted","2":"6","3":"Army","4":"single","5":"nokids","6":"male","7":"7497"},{"1":"Enlisted","2":"6","3":"Army","4":"single","5":"nokids","6":"female","7":"1640"},{"1":"Enlisted","2":"6","3":"Army","4":"single","5":"kids","6":"male","7":"4138"},{"1":"Enlisted","2":"6","3":"Army","4":"single","5":"kids","6":"female","7":"2003"},{"1":"Enlisted","2":"6","3":"Army","4":"married","5":"military","6":"male","7":"2598"},{"1":"Enlisted","2":"6","3":"Army","4":"married","5":"military","6":"female","7":"1896"},{"1":"Enlisted","2":"6","3":"Army","4":"married","5":"civilian","6":"male","7":"44045"},{"1":"Enlisted","2":"6","3":"Army","4":"married","5":"civilian","6":"female","7":"2019"},{"1":"Enlisted","2":"7","3":"Army","4":"single","5":"nokids","6":"male","7":"2146"},{"1":"Enlisted","2":"7","3":"Army","4":"single","5":"nokids","6":"female","7":"829"},{"1":"Enlisted","2":"7","3":"Army","4":"single","5":"kids","6":"male","7":"2998"},{"1":"Enlisted","2":"7","3":"Army","4":"single","5":"kids","6":"female","7":"1350"},{"1":"Enlisted","2":"7","3":"Army","4":"married","5":"military","6":"male","7":"1880"},{"1":"Enlisted","2":"7","3":"Army","4":"married","5":"military","6":"female","7":"1181"},{"1":"Enlisted","2":"7","3":"Army","4":"married","5":"civilian","6":"male","7":"29292"},{"1":"Enlisted","2":"7","3":"Army","4":"married","5":"civilian","6":"female","7":"1371"},{"1":"Enlisted","2":"8","3":"Army","4":"single","5":"nokids","6":"male","7":"460"},{"1":"Enlisted","2":"8","3":"Army","4":"single","5":"nokids","6":"female","7":"194"},{"1":"Enlisted","2":"8","3":"Army","4":"single","5":"kids","6":"male","7":"951"},{"1":"Enlisted","2":"8","3":"Army","4":"single","5":"kids","6":"female","7":"291"},{"1":"Enlisted","2":"8","3":"Army","4":"married","5":"military","6":"male","7":"617"},{"1":"Enlisted","2":"8","3":"Army","4":"married","5":"military","6":"female","7":"278"},{"1":"Enlisted","2":"8","3":"Army","4":"married","5":"civilian","6":"male","7":"9221"},{"1":"Enlisted","2":"8","3":"Army","4":"married","5":"civilian","6":"female","7":"373"},{"1":"Enlisted","2":"9","3":"Army","4":"single","5":"nokids","6":"male","7":"134"},{"1":"Enlisted","2":"9","3":"Army","4":"single","5":"nokids","6":"female","7":"88"},{"1":"Enlisted","2":"9","3":"Army","4":"single","5":"kids","6":"male","7":"249"},{"1":"Enlisted","2":"9","3":"Army","4":"single","5":"kids","6":"female","7":"64"},{"1":"Enlisted","2":"9","3":"Army","4":"married","5":"military","6":"male","7":"158"},{"1":"Enlisted","2":"9","3":"Army","4":"married","5":"military","6":"female","7":"51"},{"1":"Enlisted","2":"9","3":"Army","4":"married","5":"civilian","6":"male","7":"2729"},{"1":"Enlisted","2":"9","3":"Army","4":"married","5":"civilian","6":"female","7":"105"},{"1":"Officer","2":"1","3":"Army","4":"single","5":"nokids","6":"male","7":"3908"},{"1":"Officer","2":"1","3":"Army","4":"single","5":"nokids","6":"female","7":"898"},{"1":"Officer","2":"1","3":"Army","4":"single","5":"kids","6":"male","7":"248"},{"1":"Officer","2":"1","3":"Army","4":"single","5":"kids","6":"female","7":"131"},{"1":"Officer","2":"1","3":"Army","4":"married","5":"military","6":"male","7":"101"},{"1":"Officer","2":"1","3":"Army","4":"married","5":"military","6":"female","7":"193"},{"1":"Officer","2":"1","3":"Army","4":"married","5":"civilian","6":"male","7":"2396"},{"1":"Officer","2":"1","3":"Army","4":"married","5":"civilian","6":"female","7":"393"},{"1":"Officer","2":"2","3":"Army","4":"single","5":"nokids","6":"male","7":"4452"},{"1":"Officer","2":"2","3":"Army","4":"single","5":"nokids","6":"female","7":"1099"},{"1":"Officer","2":"2","3":"Army","4":"single","5":"kids","6":"male","7":"236"},{"1":"Officer","2":"2","3":"Army","4":"single","5":"kids","6":"female","7":"192"},{"1":"Officer","2":"2","3":"Army","4":"married","5":"military","6":"male","7":"285"},{"1":"Officer","2":"2","3":"Army","4":"married","5":"military","6":"female","7":"449"},{"1":"Officer","2":"2","3":"Army","4":"married","5":"civilian","6":"male","7":"3778"},{"1":"Officer","2":"2","3":"Army","4":"married","5":"civilian","6":"female","7":"503"},{"1":"Officer","2":"3","3":"Army","4":"single","5":"nokids","6":"male","7":"5743"},{"1":"Officer","2":"3","3":"Army","4":"single","5":"nokids","6":"female","7":"2037"},{"1":"Officer","2":"3","3":"Army","4":"single","5":"kids","6":"male","7":"656"},{"1":"Officer","2":"3","3":"Army","4":"single","5":"kids","6":"female","7":"473"},{"1":"Officer","2":"3","3":"Army","4":"married","5":"military","6":"male","7":"1000"},{"1":"Officer","2":"3","3":"Army","4":"married","5":"military","6":"female","7":"1229"},{"1":"Officer","2":"3","3":"Army","4":"married","5":"civilian","6":"male","7":"13794"},{"1":"Officer","2":"3","3":"Army","4":"married","5":"civilian","6":"female","7":"1592"},{"1":"Officer","2":"4","3":"Army","4":"single","5":"nokids","6":"male","7":"1222"},{"1":"Officer","2":"4","3":"Army","4":"single","5":"nokids","6":"female","7":"681"},{"1":"Officer","2":"4","3":"Army","4":"single","5":"kids","6":"male","7":"496"},{"1":"Officer","2":"4","3":"Army","4":"single","5":"kids","6":"female","7":"223"},{"1":"Officer","2":"4","3":"Army","4":"married","5":"military","6":"male","7":"614"},{"1":"Officer","2":"4","3":"Army","4":"married","5":"military","6":"female","7":"632"},{"1":"Officer","2":"4","3":"Army","4":"married","5":"civilian","6":"male","7":"11785"},{"1":"Officer","2":"4","3":"Army","4":"married","5":"civilian","6":"female","7":"804"},{"1":"Officer","2":"5","3":"Army","4":"single","5":"nokids","6":"male","7":"399"},{"1":"Officer","2":"5","3":"Army","4":"single","5":"nokids","6":"female","7":"294"},{"1":"Officer","2":"5","3":"Army","4":"single","5":"kids","6":"male","7":"294"},{"1":"Officer","2":"5","3":"Army","4":"single","5":"kids","6":"female","7":"128"},{"1":"Officer","2":"5","3":"Army","4":"married","5":"military","6":"male","7":"298"},{"1":"Officer","2":"5","3":"Army","4":"married","5":"military","6":"female","7":"296"},{"1":"Officer","2":"5","3":"Army","4":"married","5":"civilian","6":"male","7":"7589"},{"1":"Officer","2":"5","3":"Army","4":"married","5":"civilian","6":"female","7":"536"},{"1":"Officer","2":"6","3":"Army","4":"single","5":"nokids","6":"male","7":"130"},{"1":"Officer","2":"6","3":"Army","4":"single","5":"nokids","6":"female","7":"123"},{"1":"Officer","2":"6","3":"Army","4":"single","5":"kids","6":"male","7":"103"},{"1":"Officer","2":"6","3":"Army","4":"single","5":"kids","6":"female","7":"42"},{"1":"Officer","2":"6","3":"Army","4":"married","5":"military","6":"male","7":"122"},{"1":"Officer","2":"6","3":"Army","4":"married","5":"military","6":"female","7":"74"},{"1":"Officer","2":"6","3":"Army","4":"married","5":"civilian","6":"male","7":"3666"},{"1":"Officer","2":"6","3":"Army","4":"married","5":"civilian","6":"female","7":"258"},{"1":"Officer","2":"7","3":"Army","4":"single","5":"nokids","6":"male","7":"2"},{"1":"Officer","2":"7","3":"Army","4":"single","5":"nokids","6":"female","7":"4"},{"1":"Officer","2":"7","3":"Army","4":"single","5":"kids","6":"male","7":"3"},{"1":"Officer","2":"7","3":"Army","4":"single","5":"kids","6":"female","7":"1"},{"1":"Officer","2":"7","3":"Army","4":"married","5":"military","6":"male","7":"2"},{"1":"Officer","2":"7","3":"Army","4":"married","5":"military","6":"female","7":"1"},{"1":"Officer","2":"7","3":"Army","4":"married","5":"civilian","6":"male","7":"136"},{"1":"Officer","2":"7","3":"Army","4":"married","5":"civilian","6":"female","7":"4"},{"1":"Officer","2":"8","3":"Army","4":"single","5":"nokids","6":"male","7":"1"},{"1":"Officer","2":"8","3":"Army","4":"single","5":"nokids","6":"female","7":"1"},{"1":"Officer","2":"8","3":"Army","4":"single","5":"kids","6":"male","7":"0"},{"1":"Officer","2":"8","3":"Army","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"8","3":"Army","4":"married","5":"military","6":"male","7":"2"},{"1":"Officer","2":"8","3":"Army","4":"married","5":"military","6":"female","7":"1"},{"1":"Officer","2":"8","3":"Army","4":"married","5":"civilian","6":"male","7":"99"},{"1":"Officer","2":"8","3":"Army","4":"married","5":"civilian","6":"female","7":"4"},{"1":"Officer","2":"9","3":"Army","4":"single","5":"nokids","6":"male","7":"1"},{"1":"Officer","2":"9","3":"Army","4":"single","5":"nokids","6":"female","7":"0"},{"1":"Officer","2":"9","3":"Army","4":"single","5":"kids","6":"male","7":"0"},{"1":"Officer","2":"9","3":"Army","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"9","3":"Army","4":"married","5":"military","6":"male","7":"0"},{"1":"Officer","2":"9","3":"Army","4":"married","5":"military","6":"female","7":"1"},{"1":"Officer","2":"9","3":"Army","4":"married","5":"civilian","6":"male","7":"52"},{"1":"Officer","2":"9","3":"Army","4":"married","5":"civilian","6":"female","7":"0"},{"1":"Officer","2":"10","3":"Army","4":"single","5":"nokids","6":"male","7":"0"},{"1":"Officer","2":"10","3":"Army","4":"single","5":"nokids","6":"female","7":"0"},{"1":"Officer","2":"10","3":"Army","4":"single","5":"kids","6":"male","7":"0"},{"1":"Officer","2":"10","3":"Army","4":"single","5":"kids","6":"female","7":"0"},{"1":"Officer","2":"10","3":"Army","4":"married","5":"military","6":"male","7":"0"},{"1":"Officer","2":"10","3":"Army","4":"married","5":"military","6":"female","7":"1"},{"1":"Officer","2":"10","3":"Army","4":"married","5":"civilian","6":"male","7":"10"},{"1":"Officer","2":"10","3":"Army","4":"married","5":"civilian","6":"female","7":"0"},{"1":"Warrant Officer","2":"1","3":"Army","4":"single","5":"nokids","6":"male","7":"328"},{"1":"Warrant Officer","2":"1","3":"Army","4":"single","5":"nokids","6":"female","7":"65"},{"1":"Warrant Officer","2":"1","3":"Army","4":"single","5":"kids","6":"male","7":"140"},{"1":"Warrant Officer","2":"1","3":"Army","4":"single","5":"kids","6":"female","7":"74"},{"1":"Warrant Officer","2":"1","3":"Army","4":"married","5":"military","6":"male","7":"88"},{"1":"Warrant Officer","2":"1","3":"Army","4":"married","5":"military","6":"female","7":"95"},{"1":"Warrant Officer","2":"1","3":"Army","4":"married","5":"civilian","6":"male","7":"1985"},{"1":"Warrant Officer","2":"1","3":"Army","4":"married","5":"civilian","6":"female","7":"92"},{"1":"Warrant Officer","2":"2","3":"Army","4":"single","5":"nokids","6":"male","7":"609"},{"1":"Warrant Officer","2":"2","3":"Army","4":"single","5":"nokids","6":"female","7":"138"},{"1":"Warrant Officer","2":"2","3":"Army","4":"single","5":"kids","6":"male","7":"293"},{"1":"Warrant Officer","2":"2","3":"Army","4":"single","5":"kids","6":"female","7":"137"},{"1":"Warrant Officer","2":"2","3":"Army","4":"married","5":"military","6":"male","7":"247"},{"1":"Warrant Officer","2":"2","3":"Army","4":"married","5":"military","6":"female","7":"181"},{"1":"Warrant Officer","2":"2","3":"Army","4":"married","5":"civilian","6":"male","7":"4139"},{"1":"Warrant Officer","2":"2","3":"Army","4":"married","5":"civilian","6":"female","7":"122"},{"1":"Warrant Officer","2":"3","3":"Army","4":"single","5":"nokids","6":"male","7":"191"},{"1":"Warrant Officer","2":"3","3":"Army","4":"single","5":"nokids","6":"female","7":"58"},{"1":"Warrant Officer","2":"3","3":"Army","4":"single","5":"kids","6":"male","7":"220"},{"1":"Warrant Officer","2":"3","3":"Army","4":"single","5":"kids","6":"female","7":"72"},{"1":"Warrant Officer","2":"3","3":"Army","4":"married","5":"military","6":"male","7":"141"},{"1":"Warrant Officer","2":"3","3":"Army","4":"married","5":"military","6":"female","7":"88"},{"1":"Warrant Officer","2":"3","3":"Army","4":"married","5":"civilian","6":"male","7":"2822"},{"1":"Warrant Officer","2":"3","3":"Army","4":"married","5":"civilian","6":"female","7":"72"},{"1":"Warrant Officer","2":"4","3":"Army","4":"single","5":"nokids","6":"male","7":"101"},{"1":"Warrant Officer","2":"4","3":"Army","4":"single","5":"nokids","6":"female","7":"39"},{"1":"Warrant Officer","2":"4","3":"Army","4":"single","5":"kids","6":"male","7":"127"},{"1":"Warrant Officer","2":"4","3":"Army","4":"single","5":"kids","6":"female","7":"30"},{"1":"Warrant Officer","2":"4","3":"Army","4":"married","5":"military","6":"male","7":"100"},{"1":"Warrant Officer","2":"4","3":"Army","4":"married","5":"military","6":"female","7":"39"},{"1":"Warrant Officer","2":"4","3":"Army","4":"married","5":"civilian","6":"male","7":"1967"},{"1":"Warrant Officer","2":"4","3":"Army","4":"married","5":"civilian","6":"female","7":"64"},{"1":"Warrant Officer","2":"5","3":"Army","4":"single","5":"nokids","6":"male","7":"20"},{"1":"Warrant Officer","2":"5","3":"Army","4":"single","5":"nokids","6":"female","7":"9"},{"1":"Warrant Officer","2":"5","3":"Army","4":"single","5":"kids","6":"male","7":"20"},{"1":"Warrant Officer","2":"5","3":"Army","4":"single","5":"kids","6":"female","7":"1"},{"1":"Warrant Officer","2":"5","3":"Army","4":"married","5":"military","6":"male","7":"11"},{"1":"Warrant Officer","2":"5","3":"Army","4":"married","5":"military","6":"female","7":"4"},{"1":"Warrant Officer","2":"5","3":"Army","4":"married","5":"civilian","6":"male","7":"504"},{"1":"Warrant Officer","2":"5","3":"Army","4":"married","5":"civilian","6":"female","7":"10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane page-columns page-full" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>The FAOSTAT sheets are excerpts of the <a href="https://www.fao.org/faostat/en/#home">FAOSTAT database</a> provided by the <a href="https://www.fao.org/home/en">Food and Agriculture Association</a>, an agency of the United Nations. There are two approaches we could use to joining these data. In this section, we are going to join livestock estimates from a single file to regional codes for the countries.</p>
<p>The file <em>birds.csv</em> that includes estimates of the stock of five different types of poultry (Chickens, Ducks, Geese and guinea fowls, Turkeys, and Pigeons/Others) in 248 areas for 58 years between 1961-2018. Because we know (from challenge 1) that several of those areas include aggregated data (e.g., ) we are going to remove the aggregations and replace the case level aggregations with the correct grouping variables from the file “FAOSTAT_country_groups.csv”, downloaded from <a href="https://www.fao.org/faostat/en/#definitions">Country Region definitions</a> provided by the FAO. As a reminder, I am going to split the original birds data into country level and aggregated data, and then list the aggregated groups we found in Challenge 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>birds_orig<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"_data/birds.csv"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>birds_agg<span class="ot">&lt;-</span>birds_orig<span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flag<span class="sc">==</span><span class="st">"A"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>birds<span class="ot">&lt;-</span>birds_orig<span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flag<span class="sc">!=</span><span class="st">"A"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(birds_agg<span class="sc">$</span>Area)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "World"                     "Africa"                   
 [3] "Eastern Africa"            "Middle Africa"            
 [5] "Northern Africa"           "Southern Africa"          
 [7] "Western Africa"            "Americas"                 
 [9] "Northern America"          "Central America"          
[11] "Caribbean"                 "South America"            
[13] "Asia"                      "Central Asia"             
[15] "Eastern Asia"              "Southern Asia"            
[17] "South-eastern Asia"        "Western Asia"             
[19] "Europe"                    "Eastern Europe"           
[21] "Northern Europe"           "Southern Europe"          
[23] "Western Europe"            "Oceania"                  
[25] "Australia and New Zealand" "Melanesia"                
[27] "Micronesia"                "Polynesia"                </code></pre>
</div>
</div>
<p>With the FAO regional information, we can find out which countries are in which regions:</p>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fao_regions_orig <span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"_data/FAOSTAT_country_groups.csv"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="ot">&lt;-</span>fao_regions_orig<span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Country Group</span><span class="st">`</span>, Country)<span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">country_group =</span> <span class="st">`</span><span class="at">Country Group</span><span class="st">`</span>)<span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_group <span class="sc">==</span> <span class="st">"Polynesia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display column-page">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country_group"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Country"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"Polynesia","2":"American Samoa"},{"1":"Polynesia","2":"Cook Islands"},{"1":"Polynesia","2":"French Polynesia"},{"1":"Polynesia","2":"Niue"},{"1":"Polynesia","2":"Pitcairn"},{"1":"Polynesia","2":"Polynesia, unspecified"},{"1":"Polynesia","2":"Samoa"},{"1":"Polynesia","2":"Tokelau"},{"1":"Polynesia","2":"Tonga"},{"1":"Polynesia","2":"Tuvalu"},{"1":"Polynesia","2":"Wake Island"},{"1":"Polynesia","2":"Wallis and Futuna Islands"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Clearly, some of the groups might overlap. For example, one group is called World and clearly overlaps with all other groups. So, before we join, lets remove the World group and then inspect the country-region pairings to ensure there are no other overlaps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>())<span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>half <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(<span class="fu">nrow</span>(temp)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">list</span>(temp[half,],  </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">matrix</span>(<span class="fu">numeric</span>(), <span class="at">nrow=</span><span class="dv">0</span>, <span class="at">ncol=</span><span class="dv">1</span>),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>           temp[<span class="sc">-</span>half,]), </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">caption =</span> <span class="st">"Countries in Country Groups"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size=</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="kable_wrapper table" style="font-size: 12px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">Countries in Country Groups</caption>
<tbody>
  <tr>
   <td> 

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> country_group </th>
   <th style="text-align:right;"> n </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> World </td>
   <td style="text-align:right;"> 277 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Non-Annex I countries </td>
   <td style="text-align:right;"> 161 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Net Food Importing Developing Countries </td>
   <td style="text-align:right;"> 81 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Annex I countries </td>
   <td style="text-align:right;"> 78 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> High-income economies </td>
   <td style="text-align:right;"> 64 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Africa </td>
   <td style="text-align:right;"> 63 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Europe </td>
   <td style="text-align:right;"> 63 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Americas </td>
   <td style="text-align:right;"> 61 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Small Island Developing States </td>
   <td style="text-align:right;"> 58 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Upper-middle-income economies </td>
   <td style="text-align:right;"> 56 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Low Income Food Deficit Countries </td>
   <td style="text-align:right;"> 55 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Asia </td>
   <td style="text-align:right;"> 54 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sub-Saharan Africa </td>
   <td style="text-align:right;"> 53 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Latin America and the Caribbean </td>
   <td style="text-align:right;"> 52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Least Developed Countries </td>
   <td style="text-align:right;"> 51 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sub-Saharan Africa (including Sudan) </td>
   <td style="text-align:right;"> 49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Lower-middle-income economies </td>
   <td style="text-align:right;"> 46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Northern America and Europe </td>
   <td style="text-align:right;"> 44 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OECD </td>
   <td style="text-align:right;"> 36 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oceania </td>
   <td style="text-align:right;"> 35 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Low income economies </td>
   <td style="text-align:right;"> 34 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Land Locked Developing Countries </td>
   <td style="text-align:right;"> 32 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Caribbean </td>
   <td style="text-align:right;"> 30 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> European Union (27) </td>
   <td style="text-align:right;"> 30 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Western Asia and Northern Africa </td>
   <td style="text-align:right;"> 24 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Eastern Africa </td>
   <td style="text-align:right;"> 23 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Eastern Asia and South-eastern Asia </td>
   <td style="text-align:right;"> 20 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Southern Europe </td>
   <td style="text-align:right;"> 20 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Western Asia </td>
   <td style="text-align:right;"> 20 </td>
  </tr>
</tbody>
</table>

 </td>
   <td> 

<table>
<tbody>
  <tr>

  </tr>
</tbody>
</table>

 </td>
   <td> 

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> country_group </th>
   <th style="text-align:right;"> n </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Northern Europe </td>
   <td style="text-align:right;"> 18 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oceania excluding Australia and New Zealand </td>
   <td style="text-align:right;"> 18 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Western Africa </td>
   <td style="text-align:right;"> 18 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> South America </td>
   <td style="text-align:right;"> 17 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Central Asia and Southern Asia </td>
   <td style="text-align:right;"> 14 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> North and Central America </td>
   <td style="text-align:right;"> 14 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Western Asia (exc. Armenia, Azerbaijan, Cyprus, Israel and Georgia) </td>
   <td style="text-align:right;"> 13 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Eastern Europe </td>
   <td style="text-align:right;"> 12 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Polynesia </td>
   <td style="text-align:right;"> 12 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> South-eastern Asia </td>
   <td style="text-align:right;"> 11 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Western Europe </td>
   <td style="text-align:right;"> 11 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Micronesia </td>
   <td style="text-align:right;"> 10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Eastern Asia </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Middle Africa </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Southern Asia </td>
   <td style="text-align:right;"> 9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Caucasus and Central Asia </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Central America </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Northern Africa </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Southern Asia (excluding India) </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Australia and New Zealand </td>
   <td style="text-align:right;"> 6 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Eastern Asia (excluding Japan) </td>
   <td style="text-align:right;"> 6 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Northern Africa (excluding Sudan) </td>
   <td style="text-align:right;"> 6 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Northern America </td>
   <td style="text-align:right;"> 6 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Central Asia </td>
   <td style="text-align:right;"> 5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Melanesia </td>
   <td style="text-align:right;"> 5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Southern Africa </td>
   <td style="text-align:right;"> 5 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Eastern Asia (excluding China) </td>
   <td style="text-align:right;"> 3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Eastern Asia (excluding Japan and China) </td>
   <td style="text-align:right;"> 3 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Antarctic Region </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
</tbody>
</table>

 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Unfortunately, we can see that many regions must overlap - which is super annoying. We need to essentially extract the country-level or regional groupings - of which there seem to be up to 7 or 8 - potentially nested or perhaps not - country grouping categories - to fully disentangle the various aggregations contained in the original data. The demonstration below quickly identifies four major grouping categories to extract and confirms that there are approximately 277 countries (or less) in each grouping category. More detailed work could be used to nest sub-regions within regions (e.g., Eastern Europe would nest within Europe, and so on.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())<span class="sc">/</span><span class="dv">277</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["n"],"name":[1],"type":["dbl"],"align":["right"]}],"data":[{"1":"7.01444"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[aA]nnex"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country_group"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"Annex I countries","2":"78"},{"1":"Non-Annex I countries","2":"161"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[aA]nnex"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["n"],"name":[1],"type":["int"],"align":["right"]}],"data":[{"1":"239"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[iI]ncome"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country_group"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"High-income economies","2":"64"},{"1":"Low income economies","2":"34"},{"1":"Low Income Food Deficit Countries","2":"55"},{"1":"Lower-middle-income economies","2":"46"},{"1":"Upper-middle-income economies","2":"56"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[iI]ncome"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["n"],"name":[1],"type":["int"],"align":["right"]}],"data":[{"1":"255"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[Dd]evelop|OECD"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["country_group"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"Land Locked Developing Countries","2":"32"},{"1":"Least Developed Countries","2":"51"},{"1":"Net Food Importing Developing Countries","2":"81"},{"1":"OECD","2":"36"},{"1":"Small Island Developing States","2":"58"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[Dd]evelop|OECD"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["n"],"name":[1],"type":["int"],"align":["right"]}],"data":[{"1":"258"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>major_regions<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Africa"</span>, <span class="st">"Asia"</span>, <span class="st">"Europe"</span>, <span class="st">"Americas"</span>, </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Oceania"</span>, <span class="st">"Antarctic Region"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_group <span class="sc">%in%</span> major_regions)<span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["n"],"name":[1],"type":["int"],"align":["right"]}],"data":[{"1":"277"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>We now use the <code>unite</code> command to create four new categorical variables corresponding to the four country groupings we have identified that contain most or all of the 277 countries included in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fao_regions_wide<span class="ot">&lt;-</span>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_group<span class="sc">!=</span><span class="st">"World"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>country_group, <span class="at">values_from =</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_annex"</span>, <span class="fu">contains</span>(<span class="st">"Annex"</span>), </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_major_region"</span>, <span class="fu">any_of</span>(major_regions), </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_income"</span>, <span class="fu">contains</span>(<span class="st">"Income"</span>)<span class="sc">|</span><span class="fu">contains</span>(<span class="st">"income"</span>),</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_develop"</span>, <span class="fu">contains</span>(<span class="st">"Develop"</span>)<span class="sc">|</span><span class="fu">contains</span>(<span class="st">"OECD"</span>),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Country, <span class="fu">starts_with</span>(<span class="st">"gp"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="join-to-livestock-data" class="level3">
<h3 class="anchored" data-anchor-id="join-to-livestock-data">Join to livestock data</h3>
<p>Now that we have countries and four regional breakdown indicators, we can join this data to our original livestock data by countryname. I am going to do a left_join, as each case includes a country, and we want to match countries to join the four regional indicators. Because the <em>Country</em> variable is described as <em>Area</em> in the original birds data, we want to explicitly set the two key fields for the join.</p>
<p>We should end up with the same number of rows in the “birds” data as we started off with. An <code>inner_join</code> would also work in this case, would effectively omit from the left-hand side data any aggregated cases left in by mistake (it would only keep rows where “Area” matched one of the “Country” values.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(birds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13716</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>birds <span class="ot">&lt;-</span> <span class="fu">left_join</span>(birds, fao_regions_wide,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Area"</span> <span class="ot">=</span> <span class="st">"Country"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, you can summarize across countries grouped by income, development status, major region, or Annex/non-Annex.</p>
</section>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>The FAOSTAT sheets are excerpts of the <a href="https://www.fao.org/faostat/en/#home">FAOSTAT database</a> provided by the <a href="https://www.fao.org/home/en">Food and Agriculture Association</a>, an agency of the United Nations. There are two approaches we could use to joining these data. In this section, we are going to join livestock estimates from multiple “faostat…” files.</p>
<p>We have already seen that the file <em>birds.csv</em> includes estimates of the stock of five different types of poultry (Chickens, Ducks, Geese and guinea fowls, Turkeys, and Pigeons/Others) in 248 areas for 58 years between 1961-2018. What about the other “FAOSTAT_*” files?</p>
<p>Lets read them into a single list, and see what we find. First, lets write a function to just read in the file and then print out the column names.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
list.files()
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are base R functions that allow you to easily interact with the underlying system, just like you would at the command line or in the terminal. One of my favorites is <code>list.files()</code>, which does exactly what it says on the tin! The pattern matching used in the terminal may vary slightly depending on your operating system.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>read_faostat<span class="ot">&lt;-</span><span class="cf">function</span>(fn){</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  fao<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">str_c</span>(<span class="st">"_data"</span>, fn, <span class="at">sep=</span><span class="st">"/"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">colnames</span>(fao))</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>fao_files<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="at">path=</span><span class="st">"_data"</span>, <span class="at">pattern=</span><span class="st">"FAOSTAT*"</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>fao_files[<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="st">"birds.csv"</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(fao_files, read_faostat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "Domain"           "Area"             "Element"          "Item"            
[5] "Year"             "Unit"             "Value"            "Flag"            
[9] "Flag Description"

[[2]]
[1] "Domain"           "Area"             "Element"          "Item"            
[5] "Year"             "Unit"             "Value"            "Flag"            
[9] "Flag Description"

[[3]]
[1] "Domain"           "Area"             "Element"          "Item"            
[5] "Year"             "Unit"             "Value"            "Flag"            
[9] "Flag Description"

[[4]]
[1] "Domain"           "Area"             "Element"          "Item"            
[5] "Year"             "Unit"             "Value"            "Flag"            
[9] "Flag Description"</code></pre>
</div>
</div>
<p>We can see from this that the column names are identical in the four datasets, which makes them easy to merge. Additionally, we suspect from the <em>birds</em> dataset that the <em>Domain</em> variable will uniquely identify the dataset, lets see if we are correct by modifying our <code>read_faostat</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>read_faostat<span class="ot">&lt;-</span><span class="cf">function</span>(fn){</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  fao<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">str_c</span>(<span class="st">"_data"</span>, fn, <span class="at">sep=</span><span class="st">"/"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Domain =</span> <span class="fu">unique</span>(fao<span class="sc">$</span>Domain),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">Elements =</span> <span class="fu">unique</span>(fao<span class="sc">$</span>Element),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">Items =</span> <span class="fu">unique</span>(fao<span class="sc">$</span>Item),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">obs =</span> <span class="fu">nrow</span>(fao)))</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(fao_files, read_faostat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[[1]]$Domain
[1] "Livestock Primary"

[[1]]$Elements
[1] "Milk Animals" "Yield"        "Production"  

[[1]]$Items
[1] "Milk, whole fresh cow"

[[1]]$obs
[1] 36449


[[2]]
[[2]]$Domain
[1] "Live Animals"

[[2]]$Elements
[1] "Stocks"

[[2]]$Items
[1] "Chickens"               "Ducks"                  "Geese and guinea fowls"
[4] "Turkeys"                "Pigeons, other birds"  

[[2]]$obs
[1] 30977


[[3]]
[[3]]$Domain
[1] "Livestock Primary"

[[3]]$Elements
[1] "Laying"     "Yield"      "Production"

[[3]]$Items
[1] "Eggs, hen, in shell"

[[3]]$obs
[1] 38170


[[4]]
[[4]]$Domain
[1] "Live Animals"

[[4]]$Elements
[1] "Stocks"

[[4]]$Items
[1] "Asses"     "Camels"    "Cattle"    "Goats"     "Horses"    "Mules"    
[7] "Sheep"     "Buffaloes" "Pigs"     

[[4]]$obs
[1] 82116</code></pre>
</div>
</div>
<p>What an easy way to learn a lot about the data quickly. Sure enough, we can now merge the data back together and have way too much information in the same R object :-) This time, we will modify the <code>read_faostat</code> function to only read in the data, and then use <code>purrr::map_dfr()</code> to join.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>read_faostat<span class="ot">&lt;-</span><span class="cf">function</span>(fn){</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  fao<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">str_c</span>(<span class="st">"_data"</span>, fn, <span class="at">sep=</span><span class="st">"/"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fao)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>faostat<span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(fao_files, read_faostat)<span class="sc">%&gt;%</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(fao_regions_wide, </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">by=</span><span class="fu">c</span>(<span class="st">"Area"</span> <span class="ot">=</span> <span class="st">"Country"</span>))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(faostat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Domain"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Area"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Element"],"name":[3],"type":["chr"],"align":["left"]},{"label":["Item"],"name":[4],"type":["chr"],"align":["left"]},{"label":["Year"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Unit"],"name":[6],"type":["chr"],"align":["left"]},{"label":["Value"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Flag"],"name":[8],"type":["chr"],"align":["left"]},{"label":["Flag Description"],"name":[9],"type":["chr"],"align":["left"]},{"label":["gp_major_region"],"name":[10],"type":["chr"],"align":["left"]},{"label":["gp_annex"],"name":[11],"type":["chr"],"align":["left"]},{"label":["gp_income"],"name":[12],"type":["chr"],"align":["left"]},{"label":["gp_develop"],"name":[13],"type":["chr"],"align":["left"]}],"data":[{"1":"Livestock Primary","2":"Afghanistan","3":"Milk Animals","4":"Milk, whole fresh cow","5":"1961","6":"Head","7":"700000","8":"F","9":"FAO estimate","10":"Asia","11":"Non-Annex I countries","12":"Low income economiesLow Income Food Deficit Countries","13":"Land Locked Developing CountriesLeast Developed CountriesNet Food Importing Developing Countries"},{"1":"Livestock Primary","2":"Afghanistan","3":"Yield","4":"Milk, whole fresh cow","5":"1961","6":"hg/An","7":"5000","8":"Fc","9":"Calculated data","10":"Asia","11":"Non-Annex I countries","12":"Low income economiesLow Income Food Deficit Countries","13":"Land Locked Developing CountriesLeast Developed CountriesNet Food Importing Developing Countries"},{"1":"Livestock Primary","2":"Afghanistan","3":"Production","4":"Milk, whole fresh cow","5":"1961","6":"tonnes","7":"350000","8":"F","9":"FAO estimate","10":"Asia","11":"Non-Annex I countries","12":"Low income economiesLow Income Food Deficit Countries","13":"Land Locked Developing CountriesLeast Developed CountriesNet Food Importing Developing Countries"},{"1":"Livestock Primary","2":"Afghanistan","3":"Milk Animals","4":"Milk, whole fresh cow","5":"1962","6":"Head","7":"700000","8":"F","9":"FAO estimate","10":"Asia","11":"Non-Annex I countries","12":"Low income economiesLow Income Food Deficit Countries","13":"Land Locked Developing CountriesLeast Developed CountriesNet Food Importing Developing Countries"},{"1":"Livestock Primary","2":"Afghanistan","3":"Yield","4":"Milk, whole fresh cow","5":"1962","6":"hg/An","7":"5000","8":"Fc","9":"Calculated data","10":"Asia","11":"Non-Annex I countries","12":"Low income economiesLow Income Food Deficit Countries","13":"Land Locked Developing CountriesLeast Developed CountriesNet Food Importing Developing Countries"},{"1":"Livestock Primary","2":"Afghanistan","3":"Production","4":"Milk, whole fresh cow","5":"1962","6":"tonnes","7":"350000","8":"F","9":"FAO estimate","10":"Asia","11":"Non-Annex I countries","12":"Low income economiesLow Income Food Deficit Countries","13":"Land Locked Developing CountriesLeast Developed CountriesNet Food Importing Developing Countries"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="DACSS/DACSS_601_August2022_v2" data-repo-id="R_kgDOH1g84A" data-category="Announcements" data-category-id="DIC_kwDOH1g84M4CQ6Pq" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb30" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Challenge 8 Solutions"</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Meredith Rolfe"</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Data wrangling: joining data"</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "08/26/2022"</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: paged</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: false</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">    css: styles.css</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co">    mermaid-format: png</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - challenge_8</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co">  - activeduty</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co">  - snl</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">  - faostat</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co">  </span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">warning=</span><span class="cn">FALSE</span>,</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">message=</span><span class="cn">FALSE</span>)</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## Challenge Overview</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>1)  read in multiple data sets, and describe the data set using both words and any supporting information (e.g., tables, etc)</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>2)  tidy data (as needed, including sanity checks)</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>3)  mutate variables as needed (including sanity checks)</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>4)  join two or more data sets and analyze some aspect of the joined data</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>:::{.panel-tabset}</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a><span class="fu">## Military Marriages</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>The excel workbook "ActiveDuty_MaritalStatus.xls" contains tabulations of total number of active duty military members classified by marital and family status, for each of the branches of military as well as the military overall. The sheet is a typical government table, so lets figure out what information is actually available! After that, we will clean a single sheet from the workbook, and use that effort to create a generic function that can be used to iterate through all sheets in the workbook to read them and then join them together into a single dataset.</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>:::{.panel-tabset}</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a><span class="fu">### Find Information available</span></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>Lets first look at an example sheet from the workbook.</span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a><span class="al">![Total DOD Active Duty Marital Sheet](solution_images/dod_marital.png)</span></span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a>We can see a few things from this example sheet. First, we will need to skip 8 or 9 rows - the data first appears in row 10. Second, the tabular cells represent count *values* that capture the number of employees falling into subcategories created by 6 distinct grouping values:</span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a>  1) Pay Grade Type: Enlisted/Officer/Warrant Officer</span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a>  2) Pay Grade Level: 1-10 (fewer for non-Enlisted)</span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>  3) Marital status: Married/Single</span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>  4) Parent: Kids/noKids (Single only)</span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a>  5) Spouse affiliation: Civilian/Military (Married only)</span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>  6) Gender: Male/Female</span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>Our goal is to recover cases that have these 6 (or really 5, if we collapse parent and spouse variables as we don't have complete information) grouping variables to identify the *case* and the single value (count of active duty employees who fall into each of the resulting subcategories.)</span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a>Looking back at the original excel sheet, we can see that we will need to not just skip the top rows, we will also need to delete several columns, and also rename variables in order to make it easy to separate out the three pieces of information contained in the column names. First, I create a vector with column names (to make it easier to reuse later when I pivot to tidy data) then I read in the data and inspect it to see if the columns worked as intended.</span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a>marital_cols <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"d"</span>, <span class="st">"payGrade_payLevel"</span>,</span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a>            <span class="st">"single_nokids_male"</span>, <span class="st">"single_nokids_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a>            <span class="st">"single_kids_male"</span>, <span class="st">"single_kids_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a>            <span class="st">"married_military_male"</span>, <span class="st">"married_military_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a>            <span class="st">"married_civilian_male"</span>, <span class="st">"married_civilian_female"</span>, <span class="st">"d"</span>,</span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rep</span>(<span class="st">"d"</span>, <span class="dv">3</span>))</span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(<span class="st">"_data/ActiveDuty_MaritalStatus.xls"</span>, </span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a>           <span class="at">skip=</span><span class="dv">8</span>,</span>
<span id="cb30-80"><a href="#cb30-80" aria-hidden="true" tabindex="-1"></a>           <span class="at">col_names =</span> marital_cols</span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-83"><a href="#cb30-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-84"><a href="#cb30-84" aria-hidden="true" tabindex="-1"></a>I can see that the variable names worked well, so this time I will read in the data and omit the original header row, and also filter out the various "TOTAL" rows that we don't need to keep.</span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a><span class="fu">### Read in single sheet</span></span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb30-89"><a href="#cb30-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-90"><a href="#cb30-90" aria-hidden="true" tabindex="-1"></a>military<span class="ot">&lt;-</span><span class="fu">read_excel</span>(<span class="st">"_data/ActiveDuty_MaritalStatus.xls"</span>, </span>
<span id="cb30-91"><a href="#cb30-91" aria-hidden="true" tabindex="-1"></a>           <span class="at">skip=</span><span class="dv">9</span>,</span>
<span id="cb30-92"><a href="#cb30-92" aria-hidden="true" tabindex="-1"></a>           <span class="at">col_names =</span> marital_cols</span>
<span id="cb30-93"><a href="#cb30-93" aria-hidden="true" tabindex="-1"></a>           )<span class="sc">%&gt;%</span></span>
<span id="cb30-94"><a href="#cb30-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">"d"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb30-95"><a href="#cb30-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(payGrade_payLevel, <span class="st">"TOTAL"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>))</span>
<span id="cb30-96"><a href="#cb30-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-97"><a href="#cb30-97" aria-hidden="true" tabindex="-1"></a>military</span>
<span id="cb30-98"><a href="#cb30-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-99"><a href="#cb30-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-100"><a href="#cb30-100" aria-hidden="true" tabindex="-1"></a>It looks like this worked well! Now we just need to pivot_longer with 3 columns, then separate out the information in the <span class="in">`payGrade_payLevel`</span> variable and do a quick mutate to make paygrade easier to remember.</span>
<span id="cb30-101"><a href="#cb30-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-104"><a href="#cb30-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-105"><a href="#cb30-105" aria-hidden="true" tabindex="-1"></a>military_long <span class="ot">&lt;-</span>military <span class="sc">%&gt;%</span></span>
<span id="cb30-106"><a href="#cb30-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb30-107"><a href="#cb30-107" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"Marital"</span>, <span class="st">"Other"</span>, <span class="st">"Gender"</span>),</span>
<span id="cb30-108"><a href="#cb30-108" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb30-109"><a href="#cb30-109" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"count"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb30-110"><a href="#cb30-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(payGrade_payLevel, </span>
<span id="cb30-111"><a href="#cb30-111" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"payGrade"</span>, <span class="st">"payLevel"</span>),</span>
<span id="cb30-112"><a href="#cb30-112" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep=</span><span class="st">"-"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb30-113"><a href="#cb30-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">payGrade =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-114"><a href="#cb30-114" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"Enlisted"</span>,</span>
<span id="cb30-115"><a href="#cb30-115" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"O"</span> <span class="sc">~</span> <span class="st">"Officer"</span>,</span>
<span id="cb30-116"><a href="#cb30-116" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"Warrant Officer"</span></span>
<span id="cb30-117"><a href="#cb30-117" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb30-118"><a href="#cb30-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-119"><a href="#cb30-119" aria-hidden="true" tabindex="-1"></a>military_long</span>
<span id="cb30-120"><a href="#cb30-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-121"><a href="#cb30-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-122"><a href="#cb30-122" aria-hidden="true" tabindex="-1"></a>This all looks like it works well. So now we will go on to creating a function with the steps, then applying it to multiple sheets.</span>
<span id="cb30-123"><a href="#cb30-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-124"><a href="#cb30-124" aria-hidden="true" tabindex="-1"></a><span class="fu">### Create data reading function</span></span>
<span id="cb30-125"><a href="#cb30-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-126"><a href="#cb30-126" aria-hidden="true" tabindex="-1"></a>We will call our new function <span class="in">`read_military`</span>, and we will basically use the exact same commands as above. The big difference is that we will have a placeholder name (or argument) for the data sheet that will be passed to the new function.</span>
<span id="cb30-127"><a href="#cb30-127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-128"><a href="#cb30-128" aria-hidden="true" tabindex="-1"></a>Another difference is that when using <span class="in">`read_excel()`</span> on a workbook with multiple sheets, we need to specify the sheetname of the sheet we wish to read in (we can also specify the sheet name). I then include the <span class="in">`mutate()`</span> command to create a new column called <span class="in">`branch`</span>, which comes from our sheet name.</span>
<span id="cb30-129"><a href="#cb30-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-130"><a href="#cb30-130" aria-hidden="true" tabindex="-1"></a>Everything else will be pretty identical to reading a single sheet - <span class="in">`select(!starts_with("d"))`</span> removes all columns that start with <span class="in">`"d"`</span>. We also filter out the word "Total" from <span class="in">`payGrade_payLevel`</span>. <span class="in">`pivot_longer()`</span>  </span>
<span id="cb30-131"><a href="#cb30-131" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-134"><a href="#cb30-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-135"><a href="#cb30-135" aria-hidden="true" tabindex="-1"></a>read_military<span class="ot">&lt;-</span><span class="cf">function</span>(sheet_name){</span>
<span id="cb30-136"><a href="#cb30-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel</span>(<span class="st">"_data/ActiveDuty_MaritalStatus.xls"</span>, </span>
<span id="cb30-137"><a href="#cb30-137" aria-hidden="true" tabindex="-1"></a>             <span class="at">sheet =</span> sheet_name,</span>
<span id="cb30-138"><a href="#cb30-138" aria-hidden="true" tabindex="-1"></a>             <span class="at">skip=</span><span class="dv">9</span>,</span>
<span id="cb30-139"><a href="#cb30-139" aria-hidden="true" tabindex="-1"></a>             <span class="at">col_names =</span> marital_cols</span>
<span id="cb30-140"><a href="#cb30-140" aria-hidden="true" tabindex="-1"></a>             )<span class="sc">%&gt;%</span></span>
<span id="cb30-141"><a href="#cb30-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"branch"</span><span class="ot">=</span>sheet_name) <span class="sc">%&gt;%</span></span>
<span id="cb30-142"><a href="#cb30-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">starts_with</span>(<span class="st">"d"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb30-143"><a href="#cb30-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(payGrade_payLevel, <span class="st">"TOTAL"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>))<span class="sc">%&gt;%</span></span>
<span id="cb30-144"><a href="#cb30-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>)),</span>
<span id="cb30-145"><a href="#cb30-145" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"Marital"</span>, <span class="st">"Other"</span>, <span class="st">"Gender"</span>),</span>
<span id="cb30-146"><a href="#cb30-146" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb30-147"><a href="#cb30-147" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"count"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb30-148"><a href="#cb30-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(payGrade_payLevel, </span>
<span id="cb30-149"><a href="#cb30-149" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"payGrade"</span>, <span class="st">"payLevel"</span>),</span>
<span id="cb30-150"><a href="#cb30-150" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep=</span><span class="st">"-"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb30-151"><a href="#cb30-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">payGrade =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-152"><a href="#cb30-152" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"E"</span> <span class="sc">~</span> <span class="st">"Enlisted"</span>,</span>
<span id="cb30-153"><a href="#cb30-153" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"O"</span> <span class="sc">~</span> <span class="st">"Officer"</span>,</span>
<span id="cb30-154"><a href="#cb30-154" aria-hidden="true" tabindex="-1"></a>    payGrade <span class="sc">==</span> <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"Warrant Officer"</span></span>
<span id="cb30-155"><a href="#cb30-155" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb30-156"><a href="#cb30-156" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-157"><a href="#cb30-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-158"><a href="#cb30-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-159"><a href="#cb30-159" aria-hidden="true" tabindex="-1"></a><span class="fu">### Purrr to join</span></span>
<span id="cb30-160"><a href="#cb30-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-161"><a href="#cb30-161" aria-hidden="true" tabindex="-1"></a>We now have a function that is customized to read in the mmilitary active duty marital status sheets. We just need to use <span class="in">`purrr`</span> - a package that is part of tidyverse but which may need to be installed and loaded on its own - to iterate through the list of sheets in the workbook.</span>
<span id="cb30-162"><a href="#cb30-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-165"><a href="#cb30-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-166"><a href="#cb30-166" aria-hidden="true" tabindex="-1"></a>military_sheets<span class="ot">&lt;-</span><span class="fu">excel_sheets</span>(<span class="st">"_data/ActiveDuty_MaritalStatus.xls"</span>)</span>
<span id="cb30-167"><a href="#cb30-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-168"><a href="#cb30-168" aria-hidden="true" tabindex="-1"></a>military_sheets</span>
<span id="cb30-169"><a href="#cb30-169" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-170"><a href="#cb30-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-171"><a href="#cb30-171" aria-hidden="true" tabindex="-1"></a>Now we have a list of sheet names to map with the function. Typically, a purrr::map function creates a list of data frames with each element in the original vector fed to the function as a single list element, as depicted below.</span>
<span id="cb30-172"><a href="#cb30-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-175"><a href="#cb30-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb30-176"><a href="#cb30-176" aria-hidden="true" tabindex="-1"></a>%%| fig<span class="ot">-c</span>ap: Purrring Military Workbook</span>
<span id="cb30-177"><a href="#cb30-177" aria-hidden="true" tabindex="-1"></a>flowchart LR</span>
<span id="cb30-178"><a href="#cb30-178" aria-hidden="true" tabindex="-1"></a>  subgraph Excel</span>
<span id="cb30-179"><a href="#cb30-179" aria-hidden="true" tabindex="-1"></a>    A[Airforce] --&gt; E{Read military}</span>
<span id="cb30-180"><a href="#cb30-180" aria-hidden="true" tabindex="-1"></a>    B[MarineCorp] --&gt; E</span>
<span id="cb30-181"><a href="#cb30-181" aria-hidden="true" tabindex="-1"></a>    C[Navy] --&gt; E</span>
<span id="cb30-182"><a href="#cb30-182" aria-hidden="true" tabindex="-1"></a>    D[Army] --&gt; E</span>
<span id="cb30-183"><a href="#cb30-183" aria-hidden="true" tabindex="-1"></a>  end</span>
<span id="cb30-184"><a href="#cb30-184" aria-hidden="true" tabindex="-1"></a>  subgraph R.List</span>
<span id="cb30-185"><a href="#cb30-185" aria-hidden="true" tabindex="-1"></a>    E --&gt; F(<span class="ot">"</span><span class="st">list[[1]], branch==airforce</span><span class="ot">"</span>)</span>
<span id="cb30-186"><a href="#cb30-186" aria-hidden="true" tabindex="-1"></a>    E --&gt; G(<span class="ot">"</span><span class="st">list[[2]], branch==marines</span><span class="ot">"</span>)</span>
<span id="cb30-187"><a href="#cb30-187" aria-hidden="true" tabindex="-1"></a>    E --&gt; H(<span class="ot">"</span><span class="st">list[[3]], branch==navy</span><span class="ot">"</span>)</span>
<span id="cb30-188"><a href="#cb30-188" aria-hidden="true" tabindex="-1"></a>    E --&gt; I(<span class="ot">"</span><span class="st">list[[4]], branch==army</span><span class="ot">"</span>)</span>
<span id="cb30-189"><a href="#cb30-189" aria-hidden="true" tabindex="-1"></a>  end</span>
<span id="cb30-190"><a href="#cb30-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-191"><a href="#cb30-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-192"><a href="#cb30-192" aria-hidden="true" tabindex="-1"></a>We are going to use <span class="in">`map_dfr()`</span> to join the four elements of the list into a single dataframe. <span class="in">`map`</span> is the generic <span class="in">`purrr`</span> function, and adding on the <span class="in">`dfr`</span> means that we want to turn all of the list elements created by <span class="in">`map`</span> into a single datafame (df) that is joined by rows (r). </span>
<span id="cb30-193"><a href="#cb30-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-194"><a href="#cb30-194" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb30-195"><a href="#cb30-195" aria-hidden="true" tabindex="-1"></a><span class="fu">## using `map_dfr`</span></span>
<span id="cb30-196"><a href="#cb30-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-197"><a href="#cb30-197" aria-hidden="true" tabindex="-1"></a>There are functions in <span class="in">`purrr`</span> that automatically convert the list created by map into the dataframe shape that you want, but you need to be careful that the objects being mapped have the correct column names (or rows, if you are using <span class="in">`map_dfc()`</span> to avoid errors. Plain <span class="in">`map`</span> is the safe option, but you then have to manually join the data.)</span>
<span id="cb30-198"><a href="#cb30-198" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb30-199"><a href="#cb30-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-202"><a href="#cb30-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-203"><a href="#cb30-203" aria-hidden="true" tabindex="-1"></a>military_all <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(</span>
<span id="cb30-204"><a href="#cb30-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">excel_sheets</span>(<span class="st">"_data/ActiveDuty_MaritalStatus.xls"</span>)[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>],</span>
<span id="cb30-205"><a href="#cb30-205" aria-hidden="true" tabindex="-1"></a>  read_military)</span>
<span id="cb30-206"><a href="#cb30-206" aria-hidden="true" tabindex="-1"></a>military_all</span>
<span id="cb30-207"><a href="#cb30-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-208"><a href="#cb30-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-209"><a href="#cb30-209" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb30-210"><a href="#cb30-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-211"><a href="#cb30-211" aria-hidden="true" tabindex="-1"></a><span class="fu">## FAOstat Regions</span></span>
<span id="cb30-212"><a href="#cb30-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-213"><a href="#cb30-213" aria-hidden="true" tabindex="-1"></a>The FAOSTAT sheets are excerpts of the <span class="co">[</span><span class="ot">FAOSTAT database</span><span class="co">](https://www.fao.org/faostat/en/#home)</span> provided by the <span class="co">[</span><span class="ot">Food and Agriculture Association</span><span class="co">](https://www.fao.org/home/en)</span>, an agency of the United Nations. There are two approaches we could use to joining these data. In this section, we are going to join livestock estimates from a single file to regional codes for the countries. </span>
<span id="cb30-214"><a href="#cb30-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-215"><a href="#cb30-215" aria-hidden="true" tabindex="-1"></a>The file *birds.csv* that includes estimates of the stock of five different types of poultry (Chickens, Ducks, Geese and guinea fowls, Turkeys, and Pigeons/Others) in 248 areas for 58 years between 1961-2018. Because we know (from challenge 1) that several of those areas include aggregated data (e.g., ) we are going to remove the aggregations and replace the case level aggregations with the correct grouping variables from the file "FAOSTAT_country_groups.csv", downloaded from <span class="co">[</span><span class="ot">Country Region definitions</span><span class="co">](https://www.fao.org/faostat/en/#definitions)</span> provided by the FAO. As a reminder, I am going to split the original birds data into country level and aggregated data, and then list the aggregated groups we found in Challenge 1.</span>
<span id="cb30-216"><a href="#cb30-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-219"><a href="#cb30-219" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-220"><a href="#cb30-220" aria-hidden="true" tabindex="-1"></a>birds_orig<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"_data/birds.csv"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb30-221"><a href="#cb30-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb30-222"><a href="#cb30-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-223"><a href="#cb30-223" aria-hidden="true" tabindex="-1"></a>birds_agg<span class="ot">&lt;-</span>birds_orig<span class="sc">%&gt;%</span></span>
<span id="cb30-224"><a href="#cb30-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flag<span class="sc">==</span><span class="st">"A"</span>)</span>
<span id="cb30-225"><a href="#cb30-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-226"><a href="#cb30-226" aria-hidden="true" tabindex="-1"></a>birds<span class="ot">&lt;-</span>birds_orig<span class="sc">%&gt;%</span></span>
<span id="cb30-227"><a href="#cb30-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Flag<span class="sc">!=</span><span class="st">"A"</span>)</span>
<span id="cb30-228"><a href="#cb30-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-229"><a href="#cb30-229" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(birds_agg<span class="sc">$</span>Area)</span>
<span id="cb30-230"><a href="#cb30-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-231"><a href="#cb30-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-232"><a href="#cb30-232" aria-hidden="true" tabindex="-1"></a>With the FAO regional information, we can find out which countries are in which regions:</span>
<span id="cb30-233"><a href="#cb30-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-236"><a href="#cb30-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-237"><a href="#cb30-237" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb30-238"><a href="#cb30-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-239"><a href="#cb30-239" aria-hidden="true" tabindex="-1"></a>fao_regions_orig <span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"_data/FAOSTAT_country_groups.csv"</span>)</span>
<span id="cb30-240"><a href="#cb30-240" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="ot">&lt;-</span>fao_regions_orig<span class="sc">%&gt;%</span></span>
<span id="cb30-241"><a href="#cb30-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Country Group</span><span class="st">`</span>, Country)<span class="sc">%&gt;%</span></span>
<span id="cb30-242"><a href="#cb30-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">country_group =</span> <span class="st">`</span><span class="at">Country Group</span><span class="st">`</span>)<span class="sc">%&gt;%</span></span>
<span id="cb30-243"><a href="#cb30-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb30-244"><a href="#cb30-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-245"><a href="#cb30-245" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb30-246"><a href="#cb30-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_group <span class="sc">==</span> <span class="st">"Polynesia"</span>)</span>
<span id="cb30-247"><a href="#cb30-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-248"><a href="#cb30-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-249"><a href="#cb30-249" aria-hidden="true" tabindex="-1"></a>Clearly, some of the groups might overlap. For example, one group is called World and clearly overlaps with all other groups. So, before we join, lets remove the World group and then inspect the country-region pairings to ensure there are no other overlaps.</span>
<span id="cb30-250"><a href="#cb30-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-253"><a href="#cb30-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-254"><a href="#cb30-254" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb30-255"><a href="#cb30-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb30-256"><a href="#cb30-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>())<span class="sc">%&gt;%</span></span>
<span id="cb30-257"><a href="#cb30-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb30-258"><a href="#cb30-258" aria-hidden="true" tabindex="-1"></a>half <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(<span class="fu">nrow</span>(temp)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb30-259"><a href="#cb30-259" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">list</span>(temp[half,],  </span>
<span id="cb30-260"><a href="#cb30-260" aria-hidden="true" tabindex="-1"></a>           <span class="fu">matrix</span>(<span class="fu">numeric</span>(), <span class="at">nrow=</span><span class="dv">0</span>, <span class="at">ncol=</span><span class="dv">1</span>),</span>
<span id="cb30-261"><a href="#cb30-261" aria-hidden="true" tabindex="-1"></a>           temp[<span class="sc">-</span>half,]), </span>
<span id="cb30-262"><a href="#cb30-262" aria-hidden="true" tabindex="-1"></a>           <span class="at">caption =</span> <span class="st">"Countries in Country Groups"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb30-263"><a href="#cb30-263" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size=</span><span class="dv">12</span>)</span>
<span id="cb30-264"><a href="#cb30-264" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-265"><a href="#cb30-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-266"><a href="#cb30-266" aria-hidden="true" tabindex="-1"></a>Unfortunately, we can see that many regions must overlap - which is super annoying. We need to essentially extract the country-level or regional groupings - of which there seem to be up to 7 or 8 - potentially nested or perhaps not - country grouping categories - to fully disentangle the various aggregations contained in the original data. The demonstration below quickly identifies four major grouping categories to extract and confirms that there are approximately 277 countries (or less) in each grouping category. More detailed work could be used to nest sub-regions within regions (e.g., Eastern Europe would nest within Europe, and so on.)</span>
<span id="cb30-267"><a href="#cb30-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-270"><a href="#cb30-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-271"><a href="#cb30-271" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb30-272"><a href="#cb30-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())<span class="sc">/</span><span class="dv">277</span></span>
<span id="cb30-273"><a href="#cb30-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-274"><a href="#cb30-274" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb30-275"><a href="#cb30-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[aA]nnex"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb30-276"><a href="#cb30-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb30-277"><a href="#cb30-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb30-278"><a href="#cb30-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-279"><a href="#cb30-279" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb30-280"><a href="#cb30-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[aA]nnex"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb30-281"><a href="#cb30-281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb30-282"><a href="#cb30-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-283"><a href="#cb30-283" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb30-284"><a href="#cb30-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[iI]ncome"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb30-285"><a href="#cb30-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb30-286"><a href="#cb30-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb30-287"><a href="#cb30-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-288"><a href="#cb30-288" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb30-289"><a href="#cb30-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[iI]ncome"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb30-290"><a href="#cb30-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb30-291"><a href="#cb30-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-292"><a href="#cb30-292" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb30-293"><a href="#cb30-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[Dd]evelop|OECD"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb30-294"><a href="#cb30-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_group)<span class="sc">%&gt;%</span></span>
<span id="cb30-295"><a href="#cb30-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb30-296"><a href="#cb30-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-297"><a href="#cb30-297" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb30-298"><a href="#cb30-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(country_group, <span class="st">"[Dd]evelop|OECD"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb30-299"><a href="#cb30-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb30-300"><a href="#cb30-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-301"><a href="#cb30-301" aria-hidden="true" tabindex="-1"></a>major_regions<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"Africa"</span>, <span class="st">"Asia"</span>, <span class="st">"Europe"</span>, <span class="st">"Americas"</span>, </span>
<span id="cb30-302"><a href="#cb30-302" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Oceania"</span>, <span class="st">"Antarctic Region"</span>)</span>
<span id="cb30-303"><a href="#cb30-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-304"><a href="#cb30-304" aria-hidden="true" tabindex="-1"></a>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb30-305"><a href="#cb30-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_group <span class="sc">%in%</span> major_regions)<span class="sc">%&gt;%</span></span>
<span id="cb30-306"><a href="#cb30-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>())</span>
<span id="cb30-307"><a href="#cb30-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-308"><a href="#cb30-308" aria-hidden="true" tabindex="-1"></a>We now use the <span class="in">`unite`</span> command to create four new categorical variables corresponding to the four country groupings we have identified that contain most or all of the 277 countries included in the data.</span>
<span id="cb30-309"><a href="#cb30-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-312"><a href="#cb30-312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-313"><a href="#cb30-313" aria-hidden="true" tabindex="-1"></a>fao_regions_wide<span class="ot">&lt;-</span>fao_regions<span class="sc">%&gt;%</span></span>
<span id="cb30-314"><a href="#cb30-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_group<span class="sc">!=</span><span class="st">"World"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb30-315"><a href="#cb30-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>country_group, <span class="at">values_from =</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb30-316"><a href="#cb30-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_annex"</span>, <span class="fu">contains</span>(<span class="st">"Annex"</span>), </span>
<span id="cb30-317"><a href="#cb30-317" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb30-318"><a href="#cb30-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_major_region"</span>, <span class="fu">any_of</span>(major_regions), </span>
<span id="cb30-319"><a href="#cb30-319" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb30-320"><a href="#cb30-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_income"</span>, <span class="fu">contains</span>(<span class="st">"Income"</span>)<span class="sc">|</span><span class="fu">contains</span>(<span class="st">"income"</span>),</span>
<span id="cb30-321"><a href="#cb30-321" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb30-322"><a href="#cb30-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(<span class="st">"gp_develop"</span>, <span class="fu">contains</span>(<span class="st">"Develop"</span>)<span class="sc">|</span><span class="fu">contains</span>(<span class="st">"OECD"</span>),</span>
<span id="cb30-323"><a href="#cb30-323" aria-hidden="true" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">""</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">remove=</span><span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb30-324"><a href="#cb30-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Country, <span class="fu">starts_with</span>(<span class="st">"gp"</span>))</span>
<span id="cb30-325"><a href="#cb30-325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-326"><a href="#cb30-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-327"><a href="#cb30-327" aria-hidden="true" tabindex="-1"></a><span class="fu">### Join to livestock data</span></span>
<span id="cb30-328"><a href="#cb30-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-329"><a href="#cb30-329" aria-hidden="true" tabindex="-1"></a>Now that we have countries and four regional breakdown indicators, we can join this data to our original livestock data by countryname. I am going to do a left_join, as each case includes a country, and we want to match countries to join the four regional indicators. Because the *Country* variable is described as *Area* in the original birds data, we want to explicitly set the two key fields for the join.</span>
<span id="cb30-330"><a href="#cb30-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-331"><a href="#cb30-331" aria-hidden="true" tabindex="-1"></a>We should end up with the same number of rows in the "birds" data as we started off with. An <span class="in">`inner_join`</span> would also work in this case, would effectively omit from the left-hand side data any aggregated cases left in by mistake (it would only keep rows where "Area" matched one of the "Country" values.)</span>
<span id="cb30-332"><a href="#cb30-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-335"><a href="#cb30-335" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-336"><a href="#cb30-336" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(birds)</span>
<span id="cb30-337"><a href="#cb30-337" aria-hidden="true" tabindex="-1"></a>birds <span class="ot">&lt;-</span> <span class="fu">left_join</span>(birds, fao_regions_wide,</span>
<span id="cb30-338"><a href="#cb30-338" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Area"</span> <span class="ot">=</span> <span class="st">"Country"</span>))</span>
<span id="cb30-339"><a href="#cb30-339" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-340"><a href="#cb30-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-341"><a href="#cb30-341" aria-hidden="true" tabindex="-1"></a>Now, you can summarize across countries grouped by income, development status, major region, or Annex/non-Annex.</span>
<span id="cb30-342"><a href="#cb30-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-343"><a href="#cb30-343" aria-hidden="true" tabindex="-1"></a><span class="fu">## FAOstat: Regions</span></span>
<span id="cb30-344"><a href="#cb30-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-345"><a href="#cb30-345" aria-hidden="true" tabindex="-1"></a>The FAOSTAT sheets are excerpts of the <span class="co">[</span><span class="ot">FAOSTAT database</span><span class="co">](https://www.fao.org/faostat/en/#home)</span> provided by the <span class="co">[</span><span class="ot">Food and Agriculture Association</span><span class="co">](https://www.fao.org/home/en)</span>, an agency of the United Nations. There are two approaches we could use to joining these data. In this section, we are going to join livestock estimates from multiple "faostat..." files. </span>
<span id="cb30-346"><a href="#cb30-346" aria-hidden="true" tabindex="-1"></a>                                                            </span>
<span id="cb30-347"><a href="#cb30-347" aria-hidden="true" tabindex="-1"></a>We have already seen that the file *birds.csv* includes estimates of the stock of five different types of poultry (Chickens, Ducks, Geese and guinea fowls, Turkeys, and Pigeons/Others) in 248 areas for 58 years between 1961-2018. What about the other "FAOSTAT_<span class="sc">\*</span>" files? </span>
<span id="cb30-348"><a href="#cb30-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-349"><a href="#cb30-349" aria-hidden="true" tabindex="-1"></a>Lets read them into a single list, and see what we find. First, lets write a function to just read in the file and then print out the column names.</span>
<span id="cb30-350"><a href="#cb30-350" aria-hidden="true" tabindex="-1"></a>                                                          </span>
<span id="cb30-351"><a href="#cb30-351" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb30-352"><a href="#cb30-352" aria-hidden="true" tabindex="-1"></a><span class="fu">## list.files()</span></span>
<span id="cb30-353"><a href="#cb30-353" aria-hidden="true" tabindex="-1"></a>                                                          </span>
<span id="cb30-354"><a href="#cb30-354" aria-hidden="true" tabindex="-1"></a>There are base R functions that allow you to easily interact with the underlying system, just like you would at the command line or in the terminal. One of my favorites is <span class="in">`list.files()`</span>, which does exactly what it says on the tin! The pattern matching used in the terminal may vary slightly depending on your operating system.</span>
<span id="cb30-355"><a href="#cb30-355" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb30-356"><a href="#cb30-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-359"><a href="#cb30-359" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-360"><a href="#cb30-360" aria-hidden="true" tabindex="-1"></a>read_faostat<span class="ot">&lt;-</span><span class="cf">function</span>(fn){</span>
<span id="cb30-361"><a href="#cb30-361" aria-hidden="true" tabindex="-1"></a>  fao<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">str_c</span>(<span class="st">"_data"</span>, fn, <span class="at">sep=</span><span class="st">"/"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb30-362"><a href="#cb30-362" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb30-363"><a href="#cb30-363" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-364"><a href="#cb30-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">colnames</span>(fao))</span>
<span id="cb30-365"><a href="#cb30-365" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-366"><a href="#cb30-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-367"><a href="#cb30-367" aria-hidden="true" tabindex="-1"></a>fao_files<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="at">path=</span><span class="st">"_data"</span>, <span class="at">pattern=</span><span class="st">"FAOSTAT*"</span>)</span>
<span id="cb30-368"><a href="#cb30-368" aria-hidden="true" tabindex="-1"></a>fao_files[<span class="dv">2</span>]<span class="ot">&lt;-</span><span class="st">"birds.csv"</span></span>
<span id="cb30-369"><a href="#cb30-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-370"><a href="#cb30-370" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(fao_files, read_faostat)</span>
<span id="cb30-371"><a href="#cb30-371" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-372"><a href="#cb30-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-373"><a href="#cb30-373" aria-hidden="true" tabindex="-1"></a>We can see from this that the column names are identical in the four datasets, which makes them easy to merge. Additionally, we suspect from the *birds* dataset that the *Domain* variable will uniquely identify the dataset, lets see if we are correct by modifying our <span class="in">`read_faostat`</span> function.</span>
<span id="cb30-374"><a href="#cb30-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-377"><a href="#cb30-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-378"><a href="#cb30-378" aria-hidden="true" tabindex="-1"></a>read_faostat<span class="ot">&lt;-</span><span class="cf">function</span>(fn){</span>
<span id="cb30-379"><a href="#cb30-379" aria-hidden="true" tabindex="-1"></a>  fao<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">str_c</span>(<span class="st">"_data"</span>, fn, <span class="at">sep=</span><span class="st">"/"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb30-380"><a href="#cb30-380" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb30-381"><a href="#cb30-381" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-382"><a href="#cb30-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Domain =</span> <span class="fu">unique</span>(fao<span class="sc">$</span>Domain),</span>
<span id="cb30-383"><a href="#cb30-383" aria-hidden="true" tabindex="-1"></a>              <span class="at">Elements =</span> <span class="fu">unique</span>(fao<span class="sc">$</span>Element),</span>
<span id="cb30-384"><a href="#cb30-384" aria-hidden="true" tabindex="-1"></a>              <span class="at">Items =</span> <span class="fu">unique</span>(fao<span class="sc">$</span>Item),</span>
<span id="cb30-385"><a href="#cb30-385" aria-hidden="true" tabindex="-1"></a>              <span class="at">obs =</span> <span class="fu">nrow</span>(fao)))</span>
<span id="cb30-386"><a href="#cb30-386" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-387"><a href="#cb30-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-388"><a href="#cb30-388" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(fao_files, read_faostat)</span>
<span id="cb30-389"><a href="#cb30-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-390"><a href="#cb30-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-391"><a href="#cb30-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-392"><a href="#cb30-392" aria-hidden="true" tabindex="-1"></a>What an easy way to learn a lot about the data quickly. Sure enough, we can now merge the data back together and have way too much information in the same R object :-) This time, we will modify the <span class="in">`read_faostat`</span> function to only read in the data, and then use <span class="in">`purrr::map_dfr()`</span> to join.</span>
<span id="cb30-393"><a href="#cb30-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-396"><a href="#cb30-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-397"><a href="#cb30-397" aria-hidden="true" tabindex="-1"></a>read_faostat<span class="ot">&lt;-</span><span class="cf">function</span>(fn){</span>
<span id="cb30-398"><a href="#cb30-398" aria-hidden="true" tabindex="-1"></a>  fao<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">str_c</span>(<span class="st">"_data"</span>, fn, <span class="at">sep=</span><span class="st">"/"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb30-399"><a href="#cb30-399" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"Code"</span>))</span>
<span id="cb30-400"><a href="#cb30-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(fao)</span>
<span id="cb30-401"><a href="#cb30-401" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-402"><a href="#cb30-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-403"><a href="#cb30-403" aria-hidden="true" tabindex="-1"></a>faostat<span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(fao_files, read_faostat)<span class="sc">%&gt;%</span></span>
<span id="cb30-404"><a href="#cb30-404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(fao_regions_wide, </span>
<span id="cb30-405"><a href="#cb30-405" aria-hidden="true" tabindex="-1"></a>             <span class="at">by=</span><span class="fu">c</span>(<span class="st">"Area"</span> <span class="ot">=</span> <span class="st">"Country"</span>))</span>
<span id="cb30-406"><a href="#cb30-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-407"><a href="#cb30-407" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(faostat)</span>
<span id="cb30-408"><a href="#cb30-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-409"><a href="#cb30-409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-410"><a href="#cb30-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-411"><a href="#cb30-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-412"><a href="#cb30-412" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>