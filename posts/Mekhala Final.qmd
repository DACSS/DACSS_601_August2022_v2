---
title: "Migration in Bangalore"
author: "Mekhala Kumar"
description: "Final Project"
date: "08/27/2022"
format:
  html:
    toc: true
    code-copy: true
    code-tools: true
categories:
  - final
  - migration
---

```{r}
#| label: setup
#| warning: false
#| message: false

library(tidyverse)
library(readxl)
library(ggplot2)

knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
```

## Read in data
### Briefly describe the data
The data being used is Indian Census Data for the year 2011 and district of Bangalore. There are several tables in the Census such as population, languages spoken, education and migration.\
For this project, I am using the population data and one of the migration tables (D3). The Indian Census has two definitions of migrations: 1)a person who lives in area other than their place of birth and 2)a person who changed their place of residence. The D3 Census table uses the second definition, it also includes information about the number of years they have resided in the area and reason why they migrated. 

```{r}
#Removing unnecessary rows and renaming columns
mig3 <- read_excel("_data/DS-2900-D03-MDDS.XLSX",skip=5,col_names = c("tab_name","state_code","dist_code","area","res","res_time","last_res","last_res_type","tot_p","tot_m","tot_f","work_p","work_m","work_f","busi_t","busi_m","busi_f","educ_t","educ_m","educ_f","mar_t","mar_m","mar_f","after_birth_t","after_birth_m","after_birth_f","with_hh_t","with_hh_m","with_hh_f","others_p","others_m","others_f"))%>%filter(area=="Bangalore")
dim(mig3)
print(summarytools::dfSummary(mig3,
                        varnumbers = FALSE,
                        plain.ascii  = FALSE, 
                        style        = "grid", 
                        graph.magnif = 0.70, 
                        valid.col    = FALSE),
      method = 'render',
      table.classes = 'table-condensed')
tail(mig3)

pop <- read_excel("_data/A-1_NO_OF_VILLAGES_TOWNS_HOUSEHOLDS_POPULATION_AND_AREA (1).xlsx",skip=4,col_names=c("state_code","dist_code","sub_dist_code","type_of_region","name","reg_type","num_village_inhabit","num_village_uninhabit","num_town","num_hh","pop_t","pop_m","pop_f","area_region","pop_density"))%>%filter(name=="Bangalore")


#things to be removed- all durations of residence, total in the total, rural, urban column? not sure
#stuff that are aggregates- place of enum-res, 
#keep the specifics or remove them?
#how to print more values in summarytools
```





## Tidy Data

In the last_res( last place of residence variable), place of enumeration refers to the district where the person's details were recorded. The state of enumeration is the state that the information was recorded. Since it can be confusing to understand, the values are being renamed as intrastate, intradistict, interdistrict and interstate to give an indication of the type of migration that was undertaken. 
Recode was used because only certain observations needed to be changed and using case_When() instead would result in the unchanged values being saved as NA.

Moreover, the reasons for migration in the dataset were present as various columns which needed to be pivoted in order to be in the tidy data format.21 columns of reasons for migration were pivoted and before doing the same, the new total number of rows and columns were calculated. 
```{r}
#recoding values
mig3<-mutate(mig3,last_residence=recode(last_res,`Within the state of enumeration but outside the place of enumeration`= "Intrastate",
         	`Elsewhere in the district of enumeration`= "Intradistrict",
        `In other districts of the state of enumeration` = "Interdistrict",
        `States in India beyond the state of enumeration`= "Interstate"))
mig3<-mig3%>%select(tab_name,state_code,dist_code,area,res,res_time,last_res,last_residence,everything())
mig3=subset(mig3,select=-c(7))
dim(mig3)
#pivoting data

#sanity check
#original rows=1875
#original columns=32
#number of columns to pivot=21

#expected rows
rows=1875*21
print("Expected number of rows:")
rows
# expected columns 
col=(32-21)+2
print("Expected number of columns:")
col

mig3<-pivot_longer(mig3, 12:32, names_to = "Reason for Migration", values_to = "Number of People")
dim(mig3)

```



```{r}
table(mig3$res_time)
table(mig3$last_residence)
table(mig3$last_res_type)

#why did it change after this
residence_time_temp <- unique(mig3$res_time)
residence_time_temp
mig3<-mig3%>%
  mutate(res_time2 = factor(res_time, 
                       levels=residence_time_temp[c(1,2,3,4,5)]))%>%
  select(-res_time)
rm(residence_time_temp)

table(mig3$res_time2)

last_residence_temp <- unique(mig3$last_residence)
last_residence_temp

last_res_type_temp <- unique(mig3$last_res_type)
last_res_type_temp
```

## Join Data




